<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="robots" content="noindex"><meta><title>标签: series - 叹为观止</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="叹为观止"><meta name="msapplication-TileImage" content="/img/favicon.svg"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="叹为观止"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="PowerShell, 中文博客, 互联网, 效率党, 同步控, 工程师, 脚本爱好者, 崇尚优雅的程序设计"><meta property="og:type" content="blog"><meta property="og:title" content="叹为观止"><meta property="og:url" content="http://blog.vichamp.com/"><meta property="og:site_name" content="叹为观止"><meta property="og:description" content="PowerShell, 中文博客, 互联网, 效率党, 同步控, 工程师, 脚本爱好者, 崇尚优雅的程序设计"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="http://blog.vichamp.com/img/og_image.png"><meta property="article:author" content="Victor Woo"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="http://blog.vichamp.com/img/og_image.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://blog.vichamp.com"},"headline":"叹为观止","image":["http://blog.vichamp.com/img/og_image.png"],"author":{"@type":"Person","name":"Victor Woo"},"publisher":{"@type":"Organization","name":"叹为观止","logo":{"@type":"ImageObject","url":"http://blog.vichamp.com/img/logo.svg"}},"description":"PowerShell, 中文博客, 互联网, 效率党, 同步控, 工程师, 脚本爱好者, 崇尚优雅的程序设计"}</script><link rel="icon" href="/img/favicon.svg"><link rel="stylesheet" href="https://at.alicdn.com/t/font_XXXXXXXX.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.font.im/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><script>var _hmt = _hmt || [];
        (function() {
            var hm = document.createElement("script");
            hm.src = "//hm.baidu.com/hm.js?2ab798f8c30efc389bf38ada82e7e1c6";
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
        })();</script><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><!--!--><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!--!--><!--!--><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }

          const $tabMenu = document.querySelector(`a[href="${location.hash}"]`);
          if (!$tabMenu) {
            return;
          }

          const $tabMenuContainer = $tabMenu.parentElement.parentElement;
          Array.from($tabMenuContainer.children).forEach($menu => $menu.classList.remove('is-active'));
          Array.from($tabMenuContainer.querySelectorAll('a'))
              .map($menu => document.getElementById($menu.getAttribute("href").substring(1)))
              .forEach($content => $content.classList.add('is-hidden'));

          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
          const $activeTab = document.querySelector(location.hash);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.3.0"></head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/logo.svg" alt="叹为观止" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">主页</a><a class="navbar-item" href="/archives">归档</a><a class="navbar-item" href="/categories">分类</a><a class="navbar-item" href="/tags">标签</a><a class="navbar-item" href="/about">关于</a><a class="navbar-item" href="/2013/09/09/index">PowerShell技能索引</a><a class="navbar-item" target="_blank" rel="noopener" href="http://url.cn/Jq5bta">加入QQ群☆</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a><a class="navbar-item search" title="搜索" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-8-widescreen"><div class="card"><div class="card-content"><nav class="breadcrumb" aria-label="breadcrumbs"><ul><li><a href="/tags">标签</a></li><li class="is-active"><a href="#" aria-current="page">series</a></li></ul></nav></div></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2025-02-28T00:00:00.000Z" title="2025/2/28 08:00:00">2025-02-28</time>发表</span><span class="level-item"><time dateTime="2025-03-25T07:49:53.586Z" title="2025/3/25 15:49:53">2025-03-25</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/powershell/">powershell</a><span> / </span><a class="link-muted" href="/categories/powershell/tip/">tip</a></span><span class="level-item">15 分钟读完 (大约2188个字)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2025/02/28/powershell-infrastructure-as-code/">PowerShell 技能连载 - 基础设施即代码实践</a></h1><div class="content"><p>在现代IT运维领域，基础设施即代码(Infrastructure as Code, IaC)已成为标准实践。本文将介绍如何使用PowerShell实现高效的IaC解决方案。</p>
<p>首先，让我们创建一个基础环境配置定义函数：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建环境配置定义函数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">New-InfrastructureDefinition</span></span> &#123;</span><br><span class="line">    <span class="keyword">param</span>(</span><br><span class="line">        [<span class="type">Parameter</span>(<span class="type">Mandatory</span>)]</span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$EnvironmentName</span>,</span><br><span class="line">        </span><br><span class="line">        [<span class="type">Parameter</span>(<span class="type">Mandatory</span>)]</span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$OutputPath</span>,</span><br><span class="line">        </span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$Description</span> = <span class="string">&quot;&quot;</span>,</span><br><span class="line">        </span><br><span class="line">        [<span class="type">ValidateSet</span>(<span class="string">&quot;Development&quot;</span>, <span class="string">&quot;Testing&quot;</span>, <span class="string">&quot;Staging&quot;</span>, <span class="string">&quot;Production&quot;</span>)]</span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$EnvironmentType</span> = <span class="string">&quot;Development&quot;</span>,</span><br><span class="line">        </span><br><span class="line">        [<span class="type">switch</span>]<span class="variable">$Force</span></span><br><span class="line">    )</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment"># 创建基础环境配置对象</span></span><br><span class="line">        <span class="variable">$infrastructureDefinition</span> = [<span class="type">PSCustomObject</span>]<span class="selector-tag">@</span>&#123;</span><br><span class="line">            EnvironmentName = <span class="variable">$EnvironmentName</span></span><br><span class="line">            EnvironmentType = <span class="variable">$EnvironmentType</span></span><br><span class="line">            Description = <span class="variable">$Description</span></span><br><span class="line">            CreatedBy = <span class="variable">$env:USERNAME</span></span><br><span class="line">            CreatedOn = <span class="built_in">Get-Date</span></span><br><span class="line">            Version = <span class="string">&quot;1.0&quot;</span></span><br><span class="line">            Resources = <span class="selector-tag">@</span>&#123;</span><br><span class="line">                VirtualMachines = <span class="selector-tag">@</span>()</span><br><span class="line">                NetworkResources = <span class="selector-tag">@</span>()</span><br><span class="line">                StorageResources = <span class="selector-tag">@</span>()</span><br><span class="line">                SecurityResources = <span class="selector-tag">@</span>()</span><br><span class="line">                DatabaseResources = <span class="selector-tag">@</span>()</span><br><span class="line">                ApplicationResources = <span class="selector-tag">@</span>()</span><br><span class="line">            &#125;</span><br><span class="line">            Dependencies = <span class="selector-tag">@</span>&#123;&#125;</span><br><span class="line">            DeploymentOrder = <span class="selector-tag">@</span>()</span><br><span class="line">            State = <span class="string">&quot;Draft&quot;</span></span><br><span class="line">            Metadata = <span class="selector-tag">@</span>&#123;&#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 创建JSON定义文件</span></span><br><span class="line">        <span class="variable">$definitionFile</span> = <span class="built_in">Join-Path</span> <span class="literal">-Path</span> <span class="variable">$OutputPath</span> <span class="literal">-ChildPath</span> <span class="string">&quot;<span class="variable">$EnvironmentName</span>.json&quot;</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> ((<span class="built_in">Test-Path</span> <span class="literal">-Path</span> <span class="variable">$definitionFile</span>) <span class="operator">-and</span> (<span class="operator">-not</span> <span class="variable">$Force</span>)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="string">&quot;定义文件 &#x27;<span class="variable">$definitionFile</span>&#x27; 已存在。使用 -Force 参数覆盖现有文件。&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 创建输出目录（如果不存在）</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="operator">-not</span> (<span class="built_in">Test-Path</span> <span class="literal">-Path</span> <span class="variable">$OutputPath</span>)) &#123;</span><br><span class="line">            <span class="built_in">New-Item</span> <span class="literal">-Path</span> <span class="variable">$OutputPath</span> <span class="literal">-ItemType</span> Directory <span class="literal">-Force</span> | <span class="built_in">Out-Null</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 保存定义</span></span><br><span class="line">        <span class="variable">$infrastructureDefinition</span> | <span class="built_in">ConvertTo-Json</span> <span class="literal">-Depth</span> <span class="number">10</span> | <span class="built_in">Out-File</span> <span class="literal">-FilePath</span> <span class="variable">$definitionFile</span> <span class="literal">-Encoding</span> UTF8</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">&quot;已创建基础设施定义: <span class="variable">$definitionFile</span>&quot;</span> <span class="literal">-ForegroundColor</span> Green</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$infrastructureDefinition</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> &#123;</span><br><span class="line">        <span class="built_in">Write-Error</span> <span class="string">&quot;创建基础设施定义时出错: <span class="variable">$_</span>&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>接下来，添加虚拟机资源定义：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 添加虚拟机资源定义</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Add-VMResource</span></span> &#123;</span><br><span class="line">    <span class="keyword">param</span>(</span><br><span class="line">        [<span class="type">Parameter</span>(<span class="type">Mandatory</span>, <span class="type">ValueFromPipeline</span>)]</span><br><span class="line">        [<span class="type">PSObject</span>]<span class="variable">$InfrastructureDefinition</span>,</span><br><span class="line">        </span><br><span class="line">        [<span class="type">Parameter</span>(<span class="type">Mandatory</span>)]</span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$VMName</span>,</span><br><span class="line">        </span><br><span class="line">        [<span class="type">Parameter</span>(<span class="type">Mandatory</span>)]</span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$Size</span>,</span><br><span class="line">        </span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$OSType</span> = <span class="string">&quot;Windows&quot;</span>,</span><br><span class="line">        </span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$OSVersion</span> = <span class="string">&quot;2022-Datacenter&quot;</span>,</span><br><span class="line">        </span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$NetworkName</span>,</span><br><span class="line">        </span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$SubnetName</span>,</span><br><span class="line">        </span><br><span class="line">        [<span class="built_in">hashtable</span>]<span class="variable">$Tags</span> = <span class="selector-tag">@</span>&#123;&#125;,</span><br><span class="line">        </span><br><span class="line">        [<span class="built_in">string</span>[]]<span class="variable">$DependsOn</span> = <span class="selector-tag">@</span>(),</span><br><span class="line">        </span><br><span class="line">        [<span class="built_in">hashtable</span>]<span class="variable">$Properties</span> = <span class="selector-tag">@</span>&#123;&#125;,</span><br><span class="line">        </span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$OutputPath</span></span><br><span class="line">    )</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">process</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment"># 创建VM定义</span></span><br><span class="line">            <span class="variable">$vmResource</span> = [<span class="type">PSCustomObject</span>]<span class="selector-tag">@</span>&#123;</span><br><span class="line">                Name = <span class="variable">$VMName</span></span><br><span class="line">                ResourceType = <span class="string">&quot;VirtualMachine&quot;</span></span><br><span class="line">                Size = <span class="variable">$Size</span></span><br><span class="line">                OSType = <span class="variable">$OSType</span></span><br><span class="line">                OSVersion = <span class="variable">$OSVersion</span></span><br><span class="line">                NetworkName = <span class="variable">$NetworkName</span></span><br><span class="line">                SubnetName = <span class="variable">$SubnetName</span></span><br><span class="line">                Tags = <span class="variable">$Tags</span></span><br><span class="line">                Properties = <span class="variable">$Properties</span></span><br><span class="line">                DependsOn = <span class="variable">$DependsOn</span></span><br><span class="line">                ResourceId = [<span class="type">guid</span>]::NewGuid().ToString()</span><br><span class="line">                CreatedOn = <span class="built_in">Get-Date</span></span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 添加到定义中</span></span><br><span class="line">            <span class="variable">$InfrastructureDefinition</span>.Resources.VirtualMachines += <span class="variable">$vmResource</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 添加依赖关系</span></span><br><span class="line">            <span class="keyword">foreach</span> (<span class="variable">$dependency</span> <span class="keyword">in</span> <span class="variable">$DependsOn</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="operator">-not</span> <span class="variable">$InfrastructureDefinition</span>.Dependencies.ContainsKey(<span class="variable">$VMName</span>)) &#123;</span><br><span class="line">                    <span class="variable">$InfrastructureDefinition</span>.Dependencies[<span class="variable">$VMName</span>] = <span class="selector-tag">@</span>()</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="variable">$InfrastructureDefinition</span>.Dependencies[<span class="variable">$VMName</span>] += <span class="variable">$dependency</span></span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 如果提供了输出路径，更新定义文件</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="variable">$OutputPath</span>) &#123;</span><br><span class="line">                <span class="variable">$definitionFile</span> = <span class="built_in">Join-Path</span> <span class="literal">-Path</span> <span class="variable">$OutputPath</span> <span class="literal">-ChildPath</span> <span class="string">&quot;<span class="variable">$</span>(<span class="variable">$InfrastructureDefinition</span>.EnvironmentName).json&quot;</span></span><br><span class="line">                <span class="variable">$InfrastructureDefinition</span> | <span class="built_in">ConvertTo-Json</span> <span class="literal">-Depth</span> <span class="number">10</span> | <span class="built_in">Out-File</span> <span class="literal">-FilePath</span> <span class="variable">$definitionFile</span> <span class="literal">-Encoding</span> UTF8</span><br><span class="line">                <span class="built_in">Write-Host</span> <span class="string">&quot;已更新基础设施定义: <span class="variable">$definitionFile</span>&quot;</span> <span class="literal">-ForegroundColor</span> Green</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">return</span> <span class="variable">$InfrastructureDefinition</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span> &#123;</span><br><span class="line">            <span class="built_in">Write-Error</span> <span class="string">&quot;添加虚拟机资源定义时出错: <span class="variable">$_</span>&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>添加网络资源定义：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 添加网络资源定义</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Add-NetworkResource</span></span> &#123;</span><br><span class="line">    <span class="keyword">param</span>(</span><br><span class="line">        [<span class="type">Parameter</span>(<span class="type">Mandatory</span>, <span class="type">ValueFromPipeline</span>)]</span><br><span class="line">        [<span class="type">PSObject</span>]<span class="variable">$InfrastructureDefinition</span>,</span><br><span class="line">        </span><br><span class="line">        [<span class="type">Parameter</span>(<span class="type">Mandatory</span>)]</span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$NetworkName</span>,</span><br><span class="line">        </span><br><span class="line">        [<span class="type">Parameter</span>(<span class="type">Mandatory</span>)]</span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$AddressSpace</span>,</span><br><span class="line">        </span><br><span class="line">        [<span class="type">Parameter</span>(<span class="type">Mandatory</span>)]</span><br><span class="line">        [<span class="type">PSObject</span>[]]<span class="variable">$Subnets</span>,</span><br><span class="line">        </span><br><span class="line">        [<span class="built_in">bool</span>]<span class="variable">$EnableDnsSupport</span> = <span class="variable">$true</span>,</span><br><span class="line">        </span><br><span class="line">        [<span class="built_in">hashtable</span>]<span class="variable">$Tags</span> = <span class="selector-tag">@</span>&#123;&#125;,</span><br><span class="line">        </span><br><span class="line">        [<span class="built_in">string</span>[]]<span class="variable">$DependsOn</span> = <span class="selector-tag">@</span>(),</span><br><span class="line">        </span><br><span class="line">        [<span class="built_in">hashtable</span>]<span class="variable">$Properties</span> = <span class="selector-tag">@</span>&#123;&#125;,</span><br><span class="line">        </span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$OutputPath</span></span><br><span class="line">    )</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">process</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment"># 创建网络定义</span></span><br><span class="line">            <span class="variable">$networkResource</span> = [<span class="type">PSCustomObject</span>]<span class="selector-tag">@</span>&#123;</span><br><span class="line">                Name = <span class="variable">$NetworkName</span></span><br><span class="line">                ResourceType = <span class="string">&quot;VirtualNetwork&quot;</span></span><br><span class="line">                AddressSpace = <span class="variable">$AddressSpace</span></span><br><span class="line">                Subnets = <span class="variable">$Subnets</span></span><br><span class="line">                EnableDnsSupport = <span class="variable">$EnableDnsSupport</span></span><br><span class="line">                Tags = <span class="variable">$Tags</span></span><br><span class="line">                Properties = <span class="variable">$Properties</span></span><br><span class="line">                DependsOn = <span class="variable">$DependsOn</span></span><br><span class="line">                ResourceId = [<span class="type">guid</span>]::NewGuid().ToString()</span><br><span class="line">                CreatedOn = <span class="built_in">Get-Date</span></span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 添加到定义中</span></span><br><span class="line">            <span class="variable">$InfrastructureDefinition</span>.Resources.NetworkResources += <span class="variable">$networkResource</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 添加依赖关系</span></span><br><span class="line">            <span class="keyword">foreach</span> (<span class="variable">$dependency</span> <span class="keyword">in</span> <span class="variable">$DependsOn</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="operator">-not</span> <span class="variable">$InfrastructureDefinition</span>.Dependencies.ContainsKey(<span class="variable">$NetworkName</span>)) &#123;</span><br><span class="line">                    <span class="variable">$InfrastructureDefinition</span>.Dependencies[<span class="variable">$NetworkName</span>] = <span class="selector-tag">@</span>()</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="variable">$InfrastructureDefinition</span>.Dependencies[<span class="variable">$NetworkName</span>] += <span class="variable">$dependency</span></span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 如果提供了输出路径，更新定义文件</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="variable">$OutputPath</span>) &#123;</span><br><span class="line">                <span class="variable">$definitionFile</span> = <span class="built_in">Join-Path</span> <span class="literal">-Path</span> <span class="variable">$OutputPath</span> <span class="literal">-ChildPath</span> <span class="string">&quot;<span class="variable">$</span>(<span class="variable">$InfrastructureDefinition</span>.EnvironmentName).json&quot;</span></span><br><span class="line">                <span class="variable">$InfrastructureDefinition</span> | <span class="built_in">ConvertTo-Json</span> <span class="literal">-Depth</span> <span class="number">10</span> | <span class="built_in">Out-File</span> <span class="literal">-FilePath</span> <span class="variable">$definitionFile</span> <span class="literal">-Encoding</span> UTF8</span><br><span class="line">                <span class="built_in">Write-Host</span> <span class="string">&quot;已更新基础设施定义: <span class="variable">$definitionFile</span>&quot;</span> <span class="literal">-ForegroundColor</span> Green</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">return</span> <span class="variable">$InfrastructureDefinition</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span> &#123;</span><br><span class="line">            <span class="built_in">Write-Error</span> <span class="string">&quot;添加网络资源定义时出错: <span class="variable">$_</span>&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>生成部署顺序：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 生成资源部署顺序</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Set-DeploymentOrder</span></span> &#123;</span><br><span class="line">    <span class="keyword">param</span>(</span><br><span class="line">        [<span class="type">Parameter</span>(<span class="type">Mandatory</span>, <span class="type">ValueFromPipeline</span>)]</span><br><span class="line">        [<span class="type">PSObject</span>]<span class="variable">$InfrastructureDefinition</span>,</span><br><span class="line">        </span><br><span class="line">        [<span class="type">switch</span>]<span class="variable">$Validate</span>,</span><br><span class="line">        </span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$OutputPath</span></span><br><span class="line">    )</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">process</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment"># 创建依赖图</span></span><br><span class="line">            <span class="variable">$dependencyGraph</span> = <span class="selector-tag">@</span>&#123;&#125;</span><br><span class="line">            <span class="variable">$resourceList</span> = <span class="selector-tag">@</span>()</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 收集所有资源</span></span><br><span class="line">            <span class="keyword">foreach</span> (<span class="variable">$vmResource</span> <span class="keyword">in</span> <span class="variable">$InfrastructureDefinition</span>.Resources.VirtualMachines) &#123;</span><br><span class="line">                <span class="variable">$resourceList</span> += <span class="variable">$vmResource</span>.Name</span><br><span class="line">                <span class="variable">$dependencyGraph</span>[<span class="variable">$vmResource</span><span class="type">.Name</span>] = <span class="variable">$vmResource</span>.DependsOn</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">foreach</span> (<span class="variable">$netResource</span> <span class="keyword">in</span> <span class="variable">$InfrastructureDefinition</span>.Resources.NetworkResources) &#123;</span><br><span class="line">                <span class="variable">$resourceList</span> += <span class="variable">$netResource</span>.Name</span><br><span class="line">                <span class="variable">$dependencyGraph</span>[<span class="variable">$netResource</span><span class="type">.Name</span>] = <span class="variable">$netResource</span>.DependsOn</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 添加其他资源类型...</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 检测循环依赖</span></span><br><span class="line">            <span class="variable">$visited</span> = <span class="selector-tag">@</span>&#123;&#125;</span><br><span class="line">            <span class="variable">$recStack</span> = <span class="selector-tag">@</span>&#123;&#125;</span><br><span class="line">            </span><br><span class="line">            <span class="function"><span class="keyword">function</span> <span class="title">Test-CyclicDependency</span></span> &#123;</span><br><span class="line">                <span class="keyword">param</span>([<span class="built_in">string</span>]<span class="variable">$Node</span>)</span><br><span class="line">                </span><br><span class="line">                <span class="variable">$visited</span>[<span class="variable">$Node</span>] = <span class="variable">$true</span></span><br><span class="line">                <span class="variable">$recStack</span>[<span class="variable">$Node</span>] = <span class="variable">$true</span></span><br><span class="line">                </span><br><span class="line">                <span class="keyword">foreach</span> (<span class="variable">$neighbor</span> <span class="keyword">in</span> <span class="variable">$dependencyGraph</span>[<span class="variable">$Node</span>]) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (<span class="operator">-not</span> <span class="variable">$visited</span>.ContainsKey(<span class="variable">$neighbor</span>)) &#123;</span><br><span class="line">                        <span class="keyword">if</span> (<span class="built_in">Test-CyclicDependency</span> <span class="literal">-Node</span> <span class="variable">$neighbor</span>) &#123;</span><br><span class="line">                            <span class="keyword">return</span> <span class="variable">$true</span></span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">elseif</span> (<span class="variable">$recStack</span>.ContainsKey(<span class="variable">$neighbor</span>)) &#123;</span><br><span class="line">                        <span class="keyword">return</span> <span class="variable">$true</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                </span><br><span class="line">                <span class="variable">$recStack</span>.Remove(<span class="variable">$Node</span>)</span><br><span class="line">                <span class="keyword">return</span> <span class="variable">$false</span></span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">foreach</span> (<span class="variable">$resource</span> <span class="keyword">in</span> <span class="variable">$resourceList</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="operator">-not</span> <span class="variable">$visited</span>.ContainsKey(<span class="variable">$resource</span>)) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (<span class="built_in">Test-CyclicDependency</span> <span class="literal">-Node</span> <span class="variable">$resource</span>) &#123;</span><br><span class="line">                        <span class="keyword">throw</span> <span class="string">&quot;检测到循环依赖关系。无法确定部署顺序。&quot;</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 拓扑排序</span></span><br><span class="line">            <span class="variable">$visited</span> = <span class="selector-tag">@</span>&#123;&#125;</span><br><span class="line">            <span class="variable">$deploymentOrder</span> = [<span class="type">System.Collections.ArrayList</span>]::new()</span><br><span class="line">            </span><br><span class="line">            <span class="function"><span class="keyword">function</span> <span class="title">Sort-Topology</span></span> &#123;</span><br><span class="line">                <span class="keyword">param</span>([<span class="built_in">string</span>]<span class="variable">$Node</span>)</span><br><span class="line">                </span><br><span class="line">                <span class="variable">$visited</span>[<span class="variable">$Node</span>] = <span class="variable">$true</span></span><br><span class="line">                </span><br><span class="line">                <span class="keyword">foreach</span> (<span class="variable">$neighbor</span> <span class="keyword">in</span> <span class="variable">$dependencyGraph</span>[<span class="variable">$Node</span>]) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (<span class="operator">-not</span> <span class="variable">$visited</span>.ContainsKey(<span class="variable">$neighbor</span>)) &#123;</span><br><span class="line">                        <span class="built_in">Sort-Topology</span> <span class="literal">-Node</span> <span class="variable">$neighbor</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                </span><br><span class="line">                <span class="variable">$deploymentOrder</span>.Add(<span class="variable">$Node</span>) | <span class="built_in">Out-Null</span></span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">foreach</span> (<span class="variable">$resource</span> <span class="keyword">in</span> <span class="variable">$resourceList</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="operator">-not</span> <span class="variable">$visited</span>.ContainsKey(<span class="variable">$resource</span>)) &#123;</span><br><span class="line">                    <span class="built_in">Sort-Topology</span> <span class="literal">-Node</span> <span class="variable">$resource</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 反转列表，因为我们需要先部署没有依赖的资源</span></span><br><span class="line">            [<span class="built_in">Array</span>]::Reverse(<span class="variable">$deploymentOrder</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 更新部署顺序</span></span><br><span class="line">            <span class="variable">$InfrastructureDefinition</span>.DeploymentOrder = <span class="variable">$deploymentOrder</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 验证部署顺序</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="variable">$Validate</span>) &#123;</span><br><span class="line">                <span class="built_in">Write-Host</span> <span class="string">&quot;验证部署顺序...&quot;</span> <span class="literal">-ForegroundColor</span> Yellow</span><br><span class="line">                <span class="variable">$deploymentSet</span> = <span class="selector-tag">@</span>&#123;&#125;</span><br><span class="line">                <span class="variable">$isValid</span> = <span class="variable">$true</span></span><br><span class="line">                </span><br><span class="line">                <span class="keyword">foreach</span> (<span class="variable">$resource</span> <span class="keyword">in</span> <span class="variable">$deploymentOrder</span>) &#123;</span><br><span class="line">                    <span class="keyword">foreach</span> (<span class="variable">$dependency</span> <span class="keyword">in</span> <span class="variable">$dependencyGraph</span>[<span class="variable">$resource</span>]) &#123;</span><br><span class="line">                        <span class="keyword">if</span> (<span class="operator">-not</span> <span class="variable">$deploymentSet</span>.ContainsKey(<span class="variable">$dependency</span>)) &#123;</span><br><span class="line">                            <span class="built_in">Write-Host</span> <span class="string">&quot;错误: 资源 &#x27;<span class="variable">$resource</span>&#x27; 依赖于 &#x27;<span class="variable">$dependency</span>&#x27;，但该资源尚未部署。&quot;</span> <span class="literal">-ForegroundColor</span> Red</span><br><span class="line">                            <span class="variable">$isValid</span> = <span class="variable">$false</span></span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="variable">$deploymentSet</span>[<span class="variable">$resource</span>] = <span class="variable">$true</span></span><br><span class="line">                &#125;</span><br><span class="line">                </span><br><span class="line">                <span class="keyword">if</span> (<span class="variable">$isValid</span>) &#123;</span><br><span class="line">                    <span class="built_in">Write-Host</span> <span class="string">&quot;部署顺序有效。&quot;</span> <span class="literal">-ForegroundColor</span> Green</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="string">&quot;部署顺序无效。请检查资源依赖关系。&quot;</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 如果提供了输出路径，更新定义文件</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="variable">$OutputPath</span>) &#123;</span><br><span class="line">                <span class="variable">$definitionFile</span> = <span class="built_in">Join-Path</span> <span class="literal">-Path</span> <span class="variable">$OutputPath</span> <span class="literal">-ChildPath</span> <span class="string">&quot;<span class="variable">$</span>(<span class="variable">$InfrastructureDefinition</span>.EnvironmentName).json&quot;</span></span><br><span class="line">                <span class="variable">$InfrastructureDefinition</span> | <span class="built_in">ConvertTo-Json</span> <span class="literal">-Depth</span> <span class="number">10</span> | <span class="built_in">Out-File</span> <span class="literal">-FilePath</span> <span class="variable">$definitionFile</span> <span class="literal">-Encoding</span> UTF8</span><br><span class="line">                <span class="built_in">Write-Host</span> <span class="string">&quot;已更新基础设施定义: <span class="variable">$definitionFile</span>&quot;</span> <span class="literal">-ForegroundColor</span> Green</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">return</span> <span class="variable">$InfrastructureDefinition</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span> &#123;</span><br><span class="line">            <span class="built_in">Write-Error</span> <span class="string">&quot;生成部署顺序时出错: <span class="variable">$_</span>&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>部署基础设施资源：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 部署基础设施资源</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Deploy-InfrastructureResource</span></span> &#123;</span><br><span class="line">    <span class="keyword">param</span>(</span><br><span class="line">        [<span class="type">Parameter</span>(<span class="type">Mandatory</span>)]</span><br><span class="line">        [<span class="type">PSObject</span>]<span class="variable">$Resource</span>,</span><br><span class="line">        </span><br><span class="line">        [<span class="type">Parameter</span>(<span class="type">Mandatory</span>)]</span><br><span class="line">        [<span class="type">PSObject</span>]<span class="variable">$InfrastructureDefinition</span>,</span><br><span class="line">        </span><br><span class="line">        [<span class="type">switch</span>]<span class="variable">$WhatIf</span>,</span><br><span class="line">        </span><br><span class="line">        [<span class="type">PSObject</span>]<span class="variable">$DeploymentContext</span> = <span class="selector-tag">@</span>&#123;&#125;</span><br><span class="line">    )</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="variable">$resourceName</span> = <span class="variable">$Resource</span>.Name</span><br><span class="line">        <span class="variable">$resourceType</span> = <span class="variable">$Resource</span>.ResourceType</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">&quot;开始部署资源: <span class="variable">$resourceName</span> (类型: <span class="variable">$resourceType</span>)&quot;</span> <span class="literal">-ForegroundColor</span> Cyan</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">switch</span> (<span class="variable">$resourceType</span>) &#123;</span><br><span class="line">            <span class="string">&quot;VirtualMachine&quot;</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="variable">$WhatIf</span>) &#123;</span><br><span class="line">                    <span class="built_in">Write-Host</span> <span class="string">&quot;[WhatIf] 将创建虚拟机 &#x27;<span class="variable">$resourceName</span>&#x27; (大小: <span class="variable">$</span>(<span class="variable">$Resource</span>.Size), OS: <span class="variable">$</span>(<span class="variable">$Resource</span>.OSType)-<span class="variable">$</span>(<span class="variable">$Resource</span>.OSVersion))&quot;</span> <span class="literal">-ForegroundColor</span> Yellow</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="comment"># 这里是虚拟机部署的实际代码</span></span><br><span class="line">                    <span class="comment"># 示例: 使用 Azure PowerShell 模块创建虚拟机</span></span><br><span class="line">                    <span class="built_in">Write-Host</span> <span class="string">&quot;正在创建虚拟机 &#x27;<span class="variable">$resourceName</span>&#x27;...&quot;</span> <span class="literal">-ForegroundColor</span> White</span><br><span class="line">                    </span><br><span class="line">                    <span class="comment"># 模拟部署</span></span><br><span class="line">                    <span class="built_in">Start-Sleep</span> <span class="literal">-Seconds</span> <span class="number">2</span></span><br><span class="line">                    </span><br><span class="line">                    <span class="comment"># 返回部署结果</span></span><br><span class="line">                    <span class="variable">$deploymentResult</span> = [<span class="type">PSCustomObject</span>]<span class="selector-tag">@</span>&#123;</span><br><span class="line">                        ResourceName = <span class="variable">$resourceName</span></span><br><span class="line">                        ResourceType = <span class="variable">$resourceType</span></span><br><span class="line">                        Status = <span class="string">&quot;Success&quot;</span></span><br><span class="line">                        DeploymentId = [<span class="type">guid</span>]::NewGuid().ToString()</span><br><span class="line">                        DeploymentTime = <span class="built_in">Get-Date</span></span><br><span class="line">                        Properties = <span class="selector-tag">@</span>&#123;</span><br><span class="line">                            IPAddress = <span class="string">&quot;10.0.0.<span class="variable">$</span>((Get-Random -Minimum 2 -Maximum 255))&quot;</span></span><br><span class="line">                            FQDN = <span class="string">&quot;<span class="variable">$resourceName</span>.example.com&quot;</span></span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    </span><br><span class="line">                    <span class="built_in">Write-Host</span> <span class="string">&quot;虚拟机 &#x27;<span class="variable">$resourceName</span>&#x27; 部署成功&quot;</span> <span class="literal">-ForegroundColor</span> Green</span><br><span class="line">                    <span class="keyword">return</span> <span class="variable">$deploymentResult</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="string">&quot;VirtualNetwork&quot;</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="variable">$WhatIf</span>) &#123;</span><br><span class="line">                    <span class="built_in">Write-Host</span> <span class="string">&quot;[WhatIf] 将创建虚拟网络 &#x27;<span class="variable">$resourceName</span>&#x27; (地址空间: <span class="variable">$</span>(<span class="variable">$Resource</span>.AddressSpace))&quot;</span> <span class="literal">-ForegroundColor</span> Yellow</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="comment"># 这里是虚拟网络部署的实际代码</span></span><br><span class="line">                    <span class="built_in">Write-Host</span> <span class="string">&quot;正在创建虚拟网络 &#x27;<span class="variable">$resourceName</span>&#x27;...&quot;</span> <span class="literal">-ForegroundColor</span> White</span><br><span class="line">                    </span><br><span class="line">                    <span class="comment"># 模拟部署</span></span><br><span class="line">                    <span class="built_in">Start-Sleep</span> <span class="literal">-Seconds</span> <span class="number">1</span></span><br><span class="line">                    </span><br><span class="line">                    <span class="comment"># 返回部署结果</span></span><br><span class="line">                    <span class="variable">$deploymentResult</span> = [<span class="type">PSCustomObject</span>]<span class="selector-tag">@</span>&#123;</span><br><span class="line">                        ResourceName = <span class="variable">$resourceName</span></span><br><span class="line">                        ResourceType = <span class="variable">$resourceType</span></span><br><span class="line">                        Status = <span class="string">&quot;Success&quot;</span></span><br><span class="line">                        DeploymentId = [<span class="type">guid</span>]::NewGuid().ToString()</span><br><span class="line">                        DeploymentTime = <span class="built_in">Get-Date</span></span><br><span class="line">                        Properties = <span class="selector-tag">@</span>&#123;</span><br><span class="line">                            AddressSpace = <span class="variable">$Resource</span>.AddressSpace</span><br><span class="line">                            SubnetCount = <span class="variable">$Resource</span>.Subnets.Count</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    </span><br><span class="line">                    <span class="built_in">Write-Host</span> <span class="string">&quot;虚拟网络 &#x27;<span class="variable">$resourceName</span>&#x27; 部署成功&quot;</span> <span class="literal">-ForegroundColor</span> Green</span><br><span class="line">                    <span class="keyword">return</span> <span class="variable">$deploymentResult</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            default &#123;</span><br><span class="line">                <span class="built_in">Write-Warning</span> <span class="string">&quot;不支持的资源类型: <span class="variable">$resourceType</span>&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$WhatIf</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> [<span class="type">PSCustomObject</span>]<span class="selector-tag">@</span>&#123;</span><br><span class="line">                ResourceName = <span class="variable">$resourceName</span></span><br><span class="line">                ResourceType = <span class="variable">$resourceType</span></span><br><span class="line">                Status = <span class="string">&quot;WhatIf&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> &#123;</span><br><span class="line">        <span class="built_in">Write-Error</span> <span class="string">&quot;部署资源 &#x27;<span class="variable">$resourceName</span>&#x27; 时出错: <span class="variable">$_</span>&quot;</span></span><br><span class="line">        <span class="keyword">return</span> [<span class="type">PSCustomObject</span>]<span class="selector-tag">@</span>&#123;</span><br><span class="line">            ResourceName = <span class="variable">$resourceName</span></span><br><span class="line">            ResourceType = <span class="variable">$resourceType</span></span><br><span class="line">            Status = <span class="string">&quot;Failed&quot;</span></span><br><span class="line">            Error = <span class="variable">$_</span>.ToString()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>执行完整基础设施部署：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 部署完整基础设施</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Deploy-Infrastructure</span></span> &#123;</span><br><span class="line">    <span class="keyword">param</span>(</span><br><span class="line">        [<span class="type">Parameter</span>(<span class="type">Mandatory</span>)]</span><br><span class="line">        [<span class="type">PSObject</span>]<span class="variable">$InfrastructureDefinition</span>,</span><br><span class="line">        </span><br><span class="line">        [<span class="type">switch</span>]<span class="variable">$WhatIf</span>,</span><br><span class="line">        </span><br><span class="line">        [<span class="type">switch</span>]<span class="variable">$Force</span>,</span><br><span class="line">        </span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$DeploymentLogPath</span>,</span><br><span class="line">        </span><br><span class="line">        [<span class="type">scriptblock</span>]<span class="variable">$OnSuccessAction</span>,</span><br><span class="line">        </span><br><span class="line">        [<span class="type">scriptblock</span>]<span class="variable">$OnFailureAction</span></span><br><span class="line">    )</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="variable">$environmentName</span> = <span class="variable">$InfrastructureDefinition</span>.EnvironmentName</span><br><span class="line">        <span class="variable">$deploymentResults</span> = <span class="selector-tag">@</span>()</span><br><span class="line">        <span class="variable">$deploymentContext</span> = <span class="selector-tag">@</span>&#123;&#125;</span><br><span class="line">        <span class="variable">$deploymentStart</span> = <span class="built_in">Get-Date</span></span><br><span class="line">        <span class="variable">$deploymentSuccess</span> = <span class="variable">$true</span></span><br><span class="line">        </span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">&quot;开始部署环境: <span class="variable">$environmentName</span>&quot;</span> <span class="literal">-ForegroundColor</span> Cyan</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 检查是否有部署顺序</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$InfrastructureDefinition</span>.DeploymentOrder.Count <span class="operator">-eq</span> <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="built_in">Write-Warning</span> <span class="string">&quot;部署顺序为空。正在尝试生成部署顺序...&quot;</span></span><br><span class="line">            <span class="variable">$InfrastructureDefinition</span> = <span class="built_in">Set-DeploymentOrder</span> <span class="literal">-InfrastructureDefinition</span> <span class="variable">$InfrastructureDefinition</span> <span class="literal">-Validate</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 创建资源映射</span></span><br><span class="line">        <span class="variable">$resourceMap</span> = <span class="selector-tag">@</span>&#123;&#125;</span><br><span class="line">        <span class="keyword">foreach</span> (<span class="variable">$vmResource</span> <span class="keyword">in</span> <span class="variable">$InfrastructureDefinition</span>.Resources.VirtualMachines) &#123;</span><br><span class="line">            <span class="variable">$resourceMap</span>[<span class="variable">$vmResource</span><span class="type">.Name</span>] = <span class="variable">$vmResource</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">foreach</span> (<span class="variable">$netResource</span> <span class="keyword">in</span> <span class="variable">$InfrastructureDefinition</span>.Resources.NetworkResources) &#123;</span><br><span class="line">            <span class="variable">$resourceMap</span>[<span class="variable">$netResource</span><span class="type">.Name</span>] = <span class="variable">$netResource</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 按照部署顺序部署资源</span></span><br><span class="line">        <span class="keyword">foreach</span> (<span class="variable">$resourceName</span> <span class="keyword">in</span> <span class="variable">$InfrastructureDefinition</span>.DeploymentOrder) &#123;</span><br><span class="line">            <span class="variable">$resource</span> = <span class="variable">$resourceMap</span><span class="function">[<span class="variable">$resourceName</span>]</span></span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (<span class="operator">-not</span> <span class="variable">$resource</span>) &#123;</span><br><span class="line">                <span class="built_in">Write-Warning</span> <span class="string">&quot;资源 &#x27;<span class="variable">$resourceName</span>&#x27; 在部署顺序中但未找到资源定义。跳过。&quot;</span></span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="variable">$result</span> = <span class="built_in">Deploy-InfrastructureResource</span> <span class="literal">-Resource</span> <span class="variable">$resource</span> <span class="literal">-InfrastructureDefinition</span> <span class="variable">$InfrastructureDefinition</span> <span class="literal">-WhatIf</span>:<span class="variable">$WhatIf</span> <span class="literal">-DeploymentContext</span> <span class="variable">$deploymentContext</span></span><br><span class="line">            <span class="variable">$deploymentResults</span> += <span class="variable">$result</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 如果部署失败且未强制继续，则终止部署</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="variable">$result</span>.Status <span class="operator">-eq</span> <span class="string">&quot;Failed&quot;</span> <span class="operator">-and</span> <span class="operator">-not</span> <span class="variable">$Force</span>) &#123;</span><br><span class="line">                <span class="built_in">Write-Error</span> <span class="string">&quot;资源 &#x27;<span class="variable">$resourceName</span>&#x27; 部署失败。终止部署。&quot;</span></span><br><span class="line">                <span class="variable">$deploymentSuccess</span> = <span class="variable">$false</span></span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 更新部署上下文</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="variable">$result</span>.Status <span class="operator">-eq</span> <span class="string">&quot;Success&quot;</span>) &#123;</span><br><span class="line">                <span class="variable">$deploymentContext</span>[<span class="variable">$resourceName</span>] = <span class="variable">$result</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="variable">$deploymentEnd</span> = <span class="built_in">Get-Date</span></span><br><span class="line">        <span class="variable">$deploymentDuration</span> = <span class="variable">$deploymentEnd</span> - <span class="variable">$deploymentStart</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 生成部署摘要</span></span><br><span class="line">        <span class="variable">$deploymentSummary</span> = [<span class="type">PSCustomObject</span>]<span class="selector-tag">@</span>&#123;</span><br><span class="line">            EnvironmentName = <span class="variable">$environmentName</span></span><br><span class="line">            StartTime = <span class="variable">$deploymentStart</span></span><br><span class="line">            EndTime = <span class="variable">$deploymentEnd</span></span><br><span class="line">            Duration = <span class="variable">$deploymentDuration</span></span><br><span class="line">            Status = <span class="keyword">if</span> (<span class="variable">$deploymentSuccess</span>) &#123; <span class="string">&quot;Success&quot;</span> &#125; <span class="keyword">else</span> &#123; <span class="string">&quot;Failed&quot;</span> &#125;</span><br><span class="line">            ResourceCount = <span class="variable">$deploymentResults</span>.Count</span><br><span class="line">            SuccessCount = (<span class="variable">$deploymentResults</span> | <span class="built_in">Where-Object</span> &#123; <span class="variable">$_</span>.Status <span class="operator">-eq</span> <span class="string">&quot;Success&quot;</span> &#125;).Count</span><br><span class="line">            FailedCount = (<span class="variable">$deploymentResults</span> | <span class="built_in">Where-Object</span> &#123; <span class="variable">$_</span>.Status <span class="operator">-eq</span> <span class="string">&quot;Failed&quot;</span> &#125;).Count</span><br><span class="line">            WhatIfCount = (<span class="variable">$deploymentResults</span> | <span class="built_in">Where-Object</span> &#123; <span class="variable">$_</span>.Status <span class="operator">-eq</span> <span class="string">&quot;WhatIf&quot;</span> &#125;).Count</span><br><span class="line">            DetailedResults = <span class="variable">$deploymentResults</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 保存部署日志</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$DeploymentLogPath</span>) &#123;</span><br><span class="line">            <span class="variable">$logFile</span> = <span class="built_in">Join-Path</span> <span class="literal">-Path</span> <span class="variable">$DeploymentLogPath</span> <span class="literal">-ChildPath</span> <span class="string">&quot;Deployment_<span class="variable">$environmentName</span>`_<span class="variable">$</span>(Get-Date -Format &#x27;yyyyMMdd_HHmmss&#x27;).json&quot;</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 创建目录（如果不存在）</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="operator">-not</span> (<span class="built_in">Test-Path</span> <span class="literal">-Path</span> <span class="variable">$DeploymentLogPath</span>)) &#123;</span><br><span class="line">                <span class="built_in">New-Item</span> <span class="literal">-Path</span> <span class="variable">$DeploymentLogPath</span> <span class="literal">-ItemType</span> Directory <span class="literal">-Force</span> | <span class="built_in">Out-Null</span></span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="variable">$deploymentSummary</span> | <span class="built_in">ConvertTo-Json</span> <span class="literal">-Depth</span> <span class="number">10</span> | <span class="built_in">Out-File</span> <span class="literal">-FilePath</span> <span class="variable">$logFile</span> <span class="literal">-Encoding</span> UTF8</span><br><span class="line">            <span class="built_in">Write-Host</span> <span class="string">&quot;部署日志已保存至: <span class="variable">$logFile</span>&quot;</span> <span class="literal">-ForegroundColor</span> Green</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 部署成功或失败时执行的操作</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$deploymentSuccess</span> <span class="operator">-and</span> <span class="variable">$OnSuccessAction</span>) &#123;</span><br><span class="line">            &amp; <span class="variable">$OnSuccessAction</span> <span class="literal">-DeploymentSummary</span> <span class="variable">$deploymentSummary</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">elseif</span> (<span class="operator">-not</span> <span class="variable">$deploymentSuccess</span> <span class="operator">-and</span> <span class="variable">$OnFailureAction</span>) &#123;</span><br><span class="line">            &amp; <span class="variable">$OnFailureAction</span> <span class="literal">-DeploymentSummary</span> <span class="variable">$deploymentSummary</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 输出部署摘要</span></span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">&quot;部署摘要:&quot;</span> <span class="literal">-ForegroundColor</span> Cyan</span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">&quot;  环境: <span class="variable">$environmentName</span>&quot;</span> <span class="literal">-ForegroundColor</span> White</span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">&quot;  状态: <span class="variable">$</span>(<span class="variable">$deploymentSummary</span>.Status)&quot;</span> <span class="literal">-ForegroundColor</span> <span class="variable">$</span>(<span class="keyword">if</span> (<span class="variable">$deploymentSummary</span>.Status <span class="operator">-eq</span> <span class="string">&quot;Success&quot;</span>) &#123; <span class="string">&quot;Green&quot;</span> &#125; <span class="keyword">else</span> &#123; <span class="string">&quot;Red&quot;</span> &#125;)</span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">&quot;  持续时间: <span class="variable">$</span>(<span class="variable">$deploymentDuration</span>.TotalMinutes) 分钟&quot;</span> <span class="literal">-ForegroundColor</span> White</span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">&quot;  资源总数: <span class="variable">$</span>(<span class="variable">$deploymentSummary</span>.ResourceCount)&quot;</span> <span class="literal">-ForegroundColor</span> White</span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">&quot;  成功: <span class="variable">$</span>(<span class="variable">$deploymentSummary</span>.SuccessCount)&quot;</span> <span class="literal">-ForegroundColor</span> Green</span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">&quot;  失败: <span class="variable">$</span>(<span class="variable">$deploymentSummary</span>.FailedCount)&quot;</span> <span class="literal">-ForegroundColor</span> <span class="variable">$</span>(<span class="keyword">if</span> (<span class="variable">$deploymentSummary</span>.FailedCount <span class="operator">-gt</span> <span class="number">0</span>) &#123; <span class="string">&quot;Red&quot;</span> &#125; <span class="keyword">else</span> &#123; <span class="string">&quot;White&quot;</span> &#125;)</span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">&quot;  WhatIf: <span class="variable">$</span>(<span class="variable">$deploymentSummary</span>.WhatIfCount)&quot;</span> <span class="literal">-ForegroundColor</span> Yellow</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$deploymentSummary</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> &#123;</span><br><span class="line">        <span class="built_in">Write-Error</span> <span class="string">&quot;部署环境 &#x27;<span class="variable">$environmentName</span>&#x27; 时出错: <span class="variable">$_</span>&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>现在，让我们看一个使用示例：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 定义输出路径</span></span><br><span class="line"><span class="variable">$outputPath</span> = <span class="string">&quot;C:\IaC\Definitions&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建一个新的环境定义</span></span><br><span class="line"><span class="variable">$envDef</span> = <span class="built_in">New-InfrastructureDefinition</span> <span class="literal">-EnvironmentName</span> <span class="string">&quot;DevTest&quot;</span> <span class="literal">-EnvironmentType</span> <span class="string">&quot;Development&quot;</span> <span class="literal">-OutputPath</span> <span class="variable">$outputPath</span> <span class="literal">-Description</span> <span class="string">&quot;开发测试环境&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加网络资源</span></span><br><span class="line"><span class="variable">$subnets</span> = <span class="selector-tag">@</span>(</span><br><span class="line">    [<span class="type">PSCustomObject</span>]<span class="selector-tag">@</span>&#123; Name = <span class="string">&quot;Frontend&quot;</span>; AddressPrefix = <span class="string">&quot;10.0.1.0/24&quot;</span> &#125;,</span><br><span class="line">    [<span class="type">PSCustomObject</span>]<span class="selector-tag">@</span>&#123; Name = <span class="string">&quot;Backend&quot;</span>; AddressPrefix = <span class="string">&quot;10.0.2.0/24&quot;</span> &#125;,</span><br><span class="line">    [<span class="type">PSCustomObject</span>]<span class="selector-tag">@</span>&#123; Name = <span class="string">&quot;Database&quot;</span>; AddressPrefix = <span class="string">&quot;10.0.3.0/24&quot;</span> &#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="variable">$envDef</span> = <span class="built_in">Add-NetworkResource</span> <span class="literal">-InfrastructureDefinition</span> <span class="variable">$envDef</span> <span class="literal">-NetworkName</span> <span class="string">&quot;DevVNet&quot;</span> <span class="literal">-AddressSpace</span> <span class="string">&quot;10.0.0.0/16&quot;</span> <span class="literal">-Subnets</span> <span class="variable">$subnets</span> <span class="literal">-OutputPath</span> <span class="variable">$outputPath</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加虚拟机资源</span></span><br><span class="line"><span class="variable">$envDef</span> = <span class="built_in">Add-VMResource</span> <span class="literal">-InfrastructureDefinition</span> <span class="variable">$envDef</span> <span class="literal">-VMName</span> <span class="string">&quot;WebServer01&quot;</span> <span class="literal">-Size</span> <span class="string">&quot;Standard_B2s&quot;</span> <span class="literal">-OSType</span> <span class="string">&quot;Windows&quot;</span> <span class="literal">-OSVersion</span> <span class="string">&quot;2022-Datacenter&quot;</span> <span class="literal">-NetworkName</span> <span class="string">&quot;DevVNet&quot;</span> <span class="literal">-SubnetName</span> <span class="string">&quot;Frontend&quot;</span> <span class="literal">-DependsOn</span> <span class="selector-tag">@</span>(<span class="string">&quot;DevVNet&quot;</span>) <span class="literal">-OutputPath</span> <span class="variable">$outputPath</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$envDef</span> = <span class="built_in">Add-VMResource</span> <span class="literal">-InfrastructureDefinition</span> <span class="variable">$envDef</span> <span class="literal">-VMName</span> <span class="string">&quot;AppServer01&quot;</span> <span class="literal">-Size</span> <span class="string">&quot;Standard_B2s&quot;</span> <span class="literal">-OSType</span> <span class="string">&quot;Windows&quot;</span> <span class="literal">-OSVersion</span> <span class="string">&quot;2022-Datacenter&quot;</span> <span class="literal">-NetworkName</span> <span class="string">&quot;DevVNet&quot;</span> <span class="literal">-SubnetName</span> <span class="string">&quot;Backend&quot;</span> <span class="literal">-DependsOn</span> <span class="selector-tag">@</span>(<span class="string">&quot;DevVNet&quot;</span>, <span class="string">&quot;WebServer01&quot;</span>) <span class="literal">-OutputPath</span> <span class="variable">$outputPath</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$envDef</span> = <span class="built_in">Add-VMResource</span> <span class="literal">-InfrastructureDefinition</span> <span class="variable">$envDef</span> <span class="literal">-VMName</span> <span class="string">&quot;DbServer01&quot;</span> <span class="literal">-Size</span> <span class="string">&quot;Standard_B2ms&quot;</span> <span class="literal">-OSType</span> <span class="string">&quot;Windows&quot;</span> <span class="literal">-OSVersion</span> <span class="string">&quot;2022-Datacenter&quot;</span> <span class="literal">-NetworkName</span> <span class="string">&quot;DevVNet&quot;</span> <span class="literal">-SubnetName</span> <span class="string">&quot;Database&quot;</span> <span class="literal">-DependsOn</span> <span class="selector-tag">@</span>(<span class="string">&quot;DevVNet&quot;</span>) <span class="literal">-OutputPath</span> <span class="variable">$outputPath</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 生成部署顺序</span></span><br><span class="line"><span class="variable">$envDef</span> = <span class="built_in">Set-DeploymentOrder</span> <span class="literal">-InfrastructureDefinition</span> <span class="variable">$envDef</span> <span class="literal">-Validate</span> <span class="literal">-OutputPath</span> <span class="variable">$outputPath</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 预览部署（WhatIf）</span></span><br><span class="line"><span class="variable">$deploymentPreview</span> = <span class="built_in">Deploy-Infrastructure</span> <span class="literal">-InfrastructureDefinition</span> <span class="variable">$envDef</span> <span class="literal">-WhatIf</span> <span class="literal">-DeploymentLogPath</span> <span class="string">&quot;C:\IaC\Logs&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 实际部署</span></span><br><span class="line"><span class="variable">$deploymentResult</span> = <span class="built_in">Deploy-Infrastructure</span> <span class="literal">-InfrastructureDefinition</span> <span class="variable">$envDef</span> <span class="literal">-DeploymentLogPath</span> <span class="string">&quot;C:\IaC\Logs&quot;</span></span><br></pre></td></tr></table></figure>

<p>这些PowerShell函数提供了一个强大的基础设施即代码解决方案，可以帮助自动化环境部署流程。随着基础设施复杂性的增加，您可以扩展这些函数来支持更多的资源类型和部署场景。结合版本控制系统如Git，这种方法能够确保环境配置的一致性和可重复性，从而提高IT运维的效率和可靠性。 </p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2025-02-27T00:00:00.000Z" title="2025/2/27 08:00:00">2025-02-27</time>发表</span><span class="level-item"><time dateTime="2025-03-25T09:40:56.407Z" title="2025/3/25 17:40:56">2025-03-25</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/powershell/">powershell</a><span> / </span><a class="link-muted" href="/categories/powershell/tip/">tip</a></span><span class="level-item">2 分钟读完 (大约322个字)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2025/02/27/powershell-cloudnative-config/">PowerShell 技能连载 - 云原生配置管理</a></h1><div class="content"><p>在云原生环境中，自动化资源配置管理至关重要。以下脚本实现Kubernetes部署模板生成与应用：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">New-K8sDeployment</span></span> &#123;</span><br><span class="line">    <span class="function">[<span class="type">CmdletBinding</span>()]</span></span><br><span class="line">    <span class="keyword">param</span>(</span><br><span class="line">        [<span class="type">Parameter</span>(<span class="type">Mandatory</span>=<span class="variable">$true</span>)]</span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$AppName</span>,</span><br><span class="line">        </span><br><span class="line">        [<span class="type">ValidateRange</span>(<span class="number">1</span>,<span class="number">10</span>)]</span><br><span class="line">        [<span class="built_in">int</span>]<span class="variable">$Replicas</span> = <span class="number">3</span>,</span><br><span class="line">        </span><br><span class="line">        [<span class="type">ValidateSet</span>(<span class="string">&#x27;development&#x27;</span>,<span class="string">&#x27;production&#x27;</span>)]</span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$Environment</span> = <span class="string">&#x27;production&#x27;</span></span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    <span class="variable">$yaml</span> = <span class="string">@&quot;</span></span><br><span class="line"><span class="string">apiVersion: apps/v1</span></span><br><span class="line"><span class="string">kind: Deployment</span></span><br><span class="line"><span class="string">metadata:</span></span><br><span class="line"><span class="string">  name: <span class="variable">$AppName</span>-<span class="variable">$Environment</span></span></span><br><span class="line"><span class="string">spec:</span></span><br><span class="line"><span class="string">  replicas: <span class="variable">$Replicas</span></span></span><br><span class="line"><span class="string">  selector:</span></span><br><span class="line"><span class="string">    matchLabels:</span></span><br><span class="line"><span class="string">      app: <span class="variable">$AppName</span></span></span><br><span class="line"><span class="string">  template:</span></span><br><span class="line"><span class="string">    metadata:</span></span><br><span class="line"><span class="string">      labels:</span></span><br><span class="line"><span class="string">        app: <span class="variable">$AppName</span></span></span><br><span class="line"><span class="string">        env: <span class="variable">$Environment</span></span></span><br><span class="line"><span class="string">    spec:</span></span><br><span class="line"><span class="string">      containers:</span></span><br><span class="line"><span class="string">      - name: <span class="variable">$AppName</span></span></span><br><span class="line"><span class="string">        image: registry/vichamp/<span class="variable">$AppName:latest</span></span></span><br><span class="line"><span class="string">        resources:</span></span><br><span class="line"><span class="string">          limits:</span></span><br><span class="line"><span class="string">            memory: &quot;512Mi&quot;</span></span><br><span class="line"><span class="string">            cpu: &quot;500m&quot;</span></span><br><span class="line"><span class="string">&quot;@</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="variable">$tempFile</span> = <span class="built_in">New-TemporaryFile</span></span><br><span class="line">        <span class="variable">$yaml</span> | <span class="built_in">Out-File</span> <span class="variable">$tempFile</span>.FullName</span><br><span class="line">        </span><br><span class="line">        kubectl apply <span class="operator">-f</span> <span class="variable">$tempFile</span>.FullName</span><br><span class="line">        </span><br><span class="line">        [<span class="type">PSCustomObject</span>]<span class="selector-tag">@</span>&#123;</span><br><span class="line">            AppName = <span class="variable">$AppName</span></span><br><span class="line">            Environment = <span class="variable">$Environment</span></span><br><span class="line">            Manifest = <span class="variable">$yaml</span></span><br><span class="line">            Status = <span class="string">&#x27;Applied&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> &#123;</span><br><span class="line">        <span class="built_in">Write-Error</span> <span class="string">&quot;Kubernetes部署失败: <span class="variable">$_</span>&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="built_in">Remove-Item</span> <span class="variable">$tempFile</span>.FullName <span class="literal">-ErrorAction</span> SilentlyContinue</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>实现原理：</p>
<ol>
<li>使用here-string动态生成标准YAML部署模板</li>
<li>通过环境参数控制副本数量和部署环境</li>
<li>自动创建临时文件执行kubectl apply命令</li>
<li>返回包含应用状态的定制对象</li>
<li>完善的错误处理与临时文件清理机制</li>
</ol>
<p>使用示例：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">New-K8sDeployment</span> <span class="literal">-AppName</span> <span class="string">&#x27;order-service&#x27;</span> <span class="literal">-Environment</span> <span class="string">&#x27;production&#x27;</span> <span class="literal">-Replicas</span> <span class="number">5</span></span><br></pre></td></tr></table></figure>

<p>最佳实践：</p>
<ol>
<li>与CI&#x2F;CD流水线集成实现自动部署</li>
<li>添加资源请求&#x2F;限制验证逻辑</li>
<li>实现部署历史版本回滚功能</li>
<li>集成Prometheus监控指标</li>
</ol>
<p>注意事项：<br>• 需要配置kubectl访问权限<br>• 建议添加YAML语法验证<br>• 生产环境需设置严格的资源限制</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2025-02-26T00:00:00.000Z" title="2025/2/26 08:00:00">2025-02-26</time>发表</span><span class="level-item"><time dateTime="2025-03-25T07:49:53.312Z" title="2025/3/25 15:49:53">2025-03-25</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/powershell/">powershell</a><span> / </span><a class="link-muted" href="/categories/powershell/tip/">tip</a></span><span class="level-item">4 分钟读完 (大约599个字)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2025/02/26/powershell-excel-processing/">PowerShell 技能连载 - Excel 处理技巧</a></h1><div class="content"><p>在 PowerShell 中处理 Excel 文件是一项常见任务，本文将介绍一些实用的 Excel 处理技巧。</p>
<p>首先，让我们看看基本的 Excel 操作：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建 Excel 信息获取函数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Get-ExcelInfo</span></span> &#123;</span><br><span class="line">    <span class="keyword">param</span>(</span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$ExcelPath</span></span><br><span class="line">    )</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="variable">$excel</span> = <span class="built_in">New-Object</span> <span class="literal">-ComObject</span> Excel.Application</span><br><span class="line">        <span class="variable">$excel</span>.Visible = <span class="variable">$false</span></span><br><span class="line">        <span class="variable">$workbook</span> = <span class="variable">$excel</span>.Workbooks.Open(<span class="variable">$ExcelPath</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="variable">$info</span> = [<span class="type">PSCustomObject</span>]<span class="selector-tag">@</span>&#123;</span><br><span class="line">            FileName = <span class="built_in">Split-Path</span> <span class="variable">$ExcelPath</span> <span class="literal">-Leaf</span></span><br><span class="line">            SheetCount = <span class="variable">$workbook</span>.Sheets.Count</span><br><span class="line">            SheetNames = <span class="variable">$workbook</span>.Sheets | <span class="built_in">ForEach-Object</span> &#123; <span class="variable">$_</span>.Name &#125;</span><br><span class="line">            UsedRange = <span class="variable">$workbook</span>.Sheets(<span class="number">1</span>).UsedRange.Address</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="variable">$workbook</span>.Close(<span class="variable">$false</span>)</span><br><span class="line">        <span class="variable">$excel</span>.Quit()</span><br><span class="line">        [<span class="type">System.Runtime.Interopservices.Marshal</span>]::ReleaseComObject(<span class="variable">$excel</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$info</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> &#123;</span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">&quot;获取 Excel 信息失败：<span class="variable">$_</span>&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Excel 数据导出：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建 Excel 数据导出函数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Export-ExcelData</span></span> &#123;</span><br><span class="line">    <span class="keyword">param</span>(</span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$InputPath</span>,</span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$OutputPath</span>,</span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$SheetName</span>,</span><br><span class="line">        [<span class="built_in">int</span>]<span class="variable">$StartRow</span> = <span class="number">1</span>,</span><br><span class="line">        [<span class="built_in">int</span>]<span class="variable">$EndRow</span></span><br><span class="line">    )</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="variable">$excel</span> = <span class="built_in">New-Object</span> <span class="literal">-ComObject</span> Excel.Application</span><br><span class="line">        <span class="variable">$excel</span>.Visible = <span class="variable">$false</span></span><br><span class="line">        <span class="variable">$workbook</span> = <span class="variable">$excel</span>.Workbooks.Open(<span class="variable">$InputPath</span>)</span><br><span class="line">        <span class="variable">$sheet</span> = <span class="variable">$workbook</span>.Sheets(<span class="variable">$SheetName</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (<span class="operator">-not</span> <span class="variable">$EndRow</span>) &#123;</span><br><span class="line">            <span class="variable">$EndRow</span> = <span class="variable">$sheet</span>.UsedRange.Rows.Count</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="variable">$data</span> = <span class="selector-tag">@</span>()</span><br><span class="line">        <span class="keyword">for</span> (<span class="variable">$row</span> = <span class="variable">$StartRow</span>; <span class="variable">$row</span> <span class="operator">-le</span> <span class="variable">$EndRow</span>; <span class="variable">$row</span>++) &#123;</span><br><span class="line">            <span class="variable">$rowData</span> = <span class="selector-tag">@</span>()</span><br><span class="line">            <span class="keyword">for</span> (<span class="variable">$col</span> = <span class="number">1</span>; <span class="variable">$col</span> <span class="operator">-le</span> <span class="variable">$sheet</span>.UsedRange.Columns.Count; <span class="variable">$col</span>++) &#123;</span><br><span class="line">                <span class="variable">$rowData</span> += <span class="variable">$sheet</span>.Cells(<span class="variable">$row</span>, <span class="variable">$col</span>).Text</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="variable">$data</span> += <span class="variable">$rowData</span> <span class="operator">-join</span> <span class="string">&quot;,&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="variable">$data</span> | <span class="built_in">Out-File</span> <span class="variable">$OutputPath</span> <span class="literal">-Encoding</span> UTF8</span><br><span class="line">        </span><br><span class="line">        <span class="variable">$workbook</span>.Close(<span class="variable">$false</span>)</span><br><span class="line">        <span class="variable">$excel</span>.Quit()</span><br><span class="line">        [<span class="type">System.Runtime.Interopservices.Marshal</span>]::ReleaseComObject(<span class="variable">$excel</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">&quot;数据导出完成：<span class="variable">$OutputPath</span>&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> &#123;</span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">&quot;导出失败：<span class="variable">$_</span>&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Excel 数据导入：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建 Excel 数据导入函数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Import-ExcelData</span></span> &#123;</span><br><span class="line">    <span class="keyword">param</span>(</span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$InputPath</span>,</span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$OutputPath</span>,</span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$SheetName</span> = <span class="string">&quot;Sheet1&quot;</span>,</span><br><span class="line">        [<span class="built_in">string</span>[]]<span class="variable">$Headers</span></span><br><span class="line">    )</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="variable">$excel</span> = <span class="built_in">New-Object</span> <span class="literal">-ComObject</span> Excel.Application</span><br><span class="line">        <span class="variable">$excel</span>.Visible = <span class="variable">$false</span></span><br><span class="line">        <span class="variable">$workbook</span> = <span class="variable">$excel</span>.Workbooks.Add()</span><br><span class="line">        <span class="variable">$sheet</span> = <span class="variable">$workbook</span>.Sheets(<span class="number">1</span>)</span><br><span class="line">        <span class="variable">$sheet</span>.Name = <span class="variable">$SheetName</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 写入表头</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> <span class="operator">-lt</span> <span class="variable">$Headers</span>.Count; <span class="variable">$i</span>++) &#123;</span><br><span class="line">            <span class="variable">$sheet</span>.Cells(<span class="number">1</span>, <span class="variable">$i</span> + <span class="number">1</span>) = <span class="variable">$Headers</span>[<span class="variable">$i</span>]</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 写入数据</span></span><br><span class="line">        <span class="variable">$row</span> = <span class="number">2</span></span><br><span class="line">        <span class="built_in">Get-Content</span> <span class="variable">$InputPath</span> | <span class="built_in">ForEach-Object</span> &#123;</span><br><span class="line">            <span class="variable">$values</span> = <span class="variable">$_</span> <span class="operator">-split</span> <span class="string">&quot;,&quot;</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="variable">$col</span> = <span class="number">0</span>; <span class="variable">$col</span> <span class="operator">-lt</span> <span class="variable">$values</span>.Count; <span class="variable">$col</span>++) &#123;</span><br><span class="line">                <span class="variable">$sheet</span>.Cells(<span class="variable">$row</span>, <span class="variable">$col</span> + <span class="number">1</span>) = <span class="variable">$values</span>[<span class="variable">$col</span>]</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="variable">$row</span>++</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 调整列宽</span></span><br><span class="line">        <span class="variable">$sheet</span>.UsedRange.EntireColumn.AutoFit()</span><br><span class="line">        </span><br><span class="line">        <span class="variable">$workbook</span>.SaveAs(<span class="variable">$OutputPath</span>)</span><br><span class="line">        <span class="variable">$workbook</span>.Close(<span class="variable">$true</span>)</span><br><span class="line">        <span class="variable">$excel</span>.Quit()</span><br><span class="line">        [<span class="type">System.Runtime.Interopservices.Marshal</span>]::ReleaseComObject(<span class="variable">$excel</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">&quot;数据导入完成：<span class="variable">$OutputPath</span>&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> &#123;</span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">&quot;导入失败：<span class="variable">$_</span>&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Excel 数据合并：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建 Excel 数据合并函数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Merge-ExcelData</span></span> &#123;</span><br><span class="line">    <span class="keyword">param</span>(</span><br><span class="line">        [<span class="built_in">string</span>[]]<span class="variable">$InputFiles</span>,</span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$OutputPath</span>,</span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$SheetName</span> = <span class="string">&quot;Sheet1&quot;</span></span><br><span class="line">    )</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="variable">$excel</span> = <span class="built_in">New-Object</span> <span class="literal">-ComObject</span> Excel.Application</span><br><span class="line">        <span class="variable">$excel</span>.Visible = <span class="variable">$false</span></span><br><span class="line">        <span class="variable">$workbook</span> = <span class="variable">$excel</span>.Workbooks.Add()</span><br><span class="line">        <span class="variable">$sheet</span> = <span class="variable">$workbook</span>.Sheets(<span class="number">1</span>)</span><br><span class="line">        <span class="variable">$sheet</span>.Name = <span class="variable">$SheetName</span></span><br><span class="line">        </span><br><span class="line">        <span class="variable">$currentRow</span> = <span class="number">1</span></span><br><span class="line">        <span class="variable">$headersWritten</span> = <span class="variable">$false</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">foreach</span> (<span class="variable">$file</span> <span class="keyword">in</span> <span class="variable">$InputFiles</span>) &#123;</span><br><span class="line">            <span class="variable">$sourceWorkbook</span> = <span class="variable">$excel</span>.Workbooks.Open(<span class="variable">$file</span>)</span><br><span class="line">            <span class="variable">$sourceSheet</span> = <span class="variable">$sourceWorkbook</span>.Sheets(<span class="number">1</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (<span class="operator">-not</span> <span class="variable">$headersWritten</span>) &#123;</span><br><span class="line">                <span class="comment"># 复制表头</span></span><br><span class="line">                <span class="variable">$sourceSheet</span>.Range(<span class="variable">$sourceSheet</span>.UsedRange.Rows(<span class="number">1</span>).Address).Copy(<span class="variable">$sheet</span>.Cells(<span class="variable">$currentRow</span>, <span class="number">1</span>))</span><br><span class="line">                <span class="variable">$headersWritten</span> = <span class="variable">$true</span></span><br><span class="line">                <span class="variable">$currentRow</span>++</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 复制数据</span></span><br><span class="line">            <span class="variable">$lastRow</span> = <span class="variable">$sourceSheet</span>.UsedRange.Rows.Count</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable">$lastRow</span> <span class="operator">-gt</span> <span class="number">1</span>) &#123;</span><br><span class="line">                <span class="variable">$sourceSheet</span>.Range(<span class="variable">$sourceSheet</span>.UsedRange.Rows(<span class="number">2</span>).Address + <span class="string">&quot;:&quot;</span> + <span class="variable">$sourceSheet</span>.UsedRange.Rows(<span class="variable">$lastRow</span>).Address).Copy(<span class="variable">$sheet</span>.Cells(<span class="variable">$currentRow</span>, <span class="number">1</span>))</span><br><span class="line">                <span class="variable">$currentRow</span> += <span class="variable">$lastRow</span> - <span class="number">1</span></span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="variable">$sourceWorkbook</span>.Close(<span class="variable">$false</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 调整列宽</span></span><br><span class="line">        <span class="variable">$sheet</span>.UsedRange.EntireColumn.AutoFit()</span><br><span class="line">        </span><br><span class="line">        <span class="variable">$workbook</span>.SaveAs(<span class="variable">$OutputPath</span>)</span><br><span class="line">        <span class="variable">$workbook</span>.Close(<span class="variable">$true</span>)</span><br><span class="line">        <span class="variable">$excel</span>.Quit()</span><br><span class="line">        [<span class="type">System.Runtime.Interopservices.Marshal</span>]::ReleaseComObject(<span class="variable">$excel</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">&quot;数据合并完成：<span class="variable">$OutputPath</span>&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> &#123;</span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">&quot;合并失败：<span class="variable">$_</span>&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这些技巧将帮助您更有效地处理 Excel 文件。记住，在处理 Excel 时，始终要注意内存管理和资源释放。同时，建议在处理大型 Excel 文件时使用流式处理方式，以提高性能。 </p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2025-02-25T00:00:00.000Z" title="2025/2/25 08:00:00">2025-02-25</time>发表</span><span class="level-item"><time dateTime="2025-03-25T10:13:05.181Z" title="2025/3/25 18:13:05">2025-03-25</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/powershell/">powershell</a><span> / </span><a class="link-muted" href="/categories/powershell/tip/">tip</a></span><span class="level-item">7 分钟读完 (大约990个字)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2025/02/25/powershell-asset-management/">PowerShell 技能连载 - 资产管理</a></h1><div class="content"><p>在系统管理中，资产管理对于确保资源的有效利用和成本控制至关重要。本文将介绍如何使用PowerShell构建一个资产管理系统，包括资产发现、跟踪和优化等功能。</p>
<h2 id="资产发现"><a href="#资产发现" class="headerlink" title="资产发现"></a>资产发现</h2><p>首先，让我们创建一个用于管理资产发现的函数：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Discover-SystemAssets</span></span> &#123;</span><br><span class="line">    <span class="function">[<span class="type">CmdletBinding</span>()]</span></span><br><span class="line">    <span class="keyword">param</span>(</span><br><span class="line">        [<span class="type">Parameter</span>(<span class="type">Mandatory</span> = <span class="variable">$true</span>)]</span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$DiscoveryID</span>,</span><br><span class="line">        </span><br><span class="line">        [<span class="type">Parameter</span>()]</span><br><span class="line">        [<span class="built_in">string</span>[]]<span class="variable">$AssetTypes</span>,</span><br><span class="line">        </span><br><span class="line">        [<span class="type">Parameter</span>()]</span><br><span class="line">        [<span class="type">ValidateSet</span>(<span class="string">&quot;Full&quot;</span>, <span class="string">&quot;Quick&quot;</span>, <span class="string">&quot;Custom&quot;</span>)]</span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$DiscoveryMode</span> = <span class="string">&quot;Full&quot;</span>,</span><br><span class="line">        </span><br><span class="line">        [<span class="type">Parameter</span>()]</span><br><span class="line">        [<span class="built_in">hashtable</span>]<span class="variable">$DiscoveryConfig</span>,</span><br><span class="line">        </span><br><span class="line">        [<span class="type">Parameter</span>()]</span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$LogPath</span></span><br><span class="line">    )</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="variable">$discoverer</span> = [<span class="type">PSCustomObject</span>]<span class="selector-tag">@</span>&#123;</span><br><span class="line">            DiscoveryID = <span class="variable">$DiscoveryID</span></span><br><span class="line">            StartTime = <span class="built_in">Get-Date</span></span><br><span class="line">            DiscoveryStatus = <span class="selector-tag">@</span>&#123;&#125;</span><br><span class="line">            Assets = <span class="selector-tag">@</span>&#123;&#125;</span><br><span class="line">            Issues = <span class="selector-tag">@</span>()</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 获取发现配置</span></span><br><span class="line">        <span class="variable">$config</span> = <span class="built_in">Get-DiscoveryConfig</span> <span class="literal">-DiscoveryID</span> <span class="variable">$DiscoveryID</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 管理发现</span></span><br><span class="line">        <span class="keyword">foreach</span> (<span class="variable">$type</span> <span class="keyword">in</span> <span class="variable">$AssetTypes</span>) &#123;</span><br><span class="line">            <span class="variable">$status</span> = [<span class="type">PSCustomObject</span>]<span class="selector-tag">@</span>&#123;</span><br><span class="line">                <span class="built_in">Type</span> = <span class="variable">$type</span></span><br><span class="line">                Status = <span class="string">&quot;Unknown&quot;</span></span><br><span class="line">                Config = <span class="selector-tag">@</span>&#123;&#125;</span><br><span class="line">                Assets = <span class="selector-tag">@</span>&#123;&#125;</span><br><span class="line">                Issues = <span class="selector-tag">@</span>()</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 应用发现配置</span></span><br><span class="line">            <span class="variable">$typeConfig</span> = Apply<span class="literal">-DiscoveryConfig</span> `</span><br><span class="line">                <span class="literal">-Config</span> <span class="variable">$config</span> `</span><br><span class="line">                <span class="literal">-Type</span> <span class="variable">$type</span> `</span><br><span class="line">                <span class="literal">-Mode</span> <span class="variable">$DiscoveryMode</span> `</span><br><span class="line">                <span class="literal">-Settings</span> <span class="variable">$DiscoveryConfig</span></span><br><span class="line">            </span><br><span class="line">            <span class="variable">$status</span>.Config = <span class="variable">$typeConfig</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 发现系统资产</span></span><br><span class="line">            <span class="variable">$assets</span> = Discover<span class="literal">-AssetInventory</span> `</span><br><span class="line">                <span class="literal">-Type</span> <span class="variable">$type</span> `</span><br><span class="line">                <span class="literal">-Config</span> <span class="variable">$typeConfig</span></span><br><span class="line">            </span><br><span class="line">            <span class="variable">$status</span>.Assets = <span class="variable">$assets</span></span><br><span class="line">            <span class="variable">$discoverer</span>.Assets[<span class="variable">$type</span>] = <span class="variable">$assets</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 检查资产问题</span></span><br><span class="line">            <span class="variable">$issues</span> = Check<span class="literal">-AssetIssues</span> `</span><br><span class="line">                <span class="literal">-Assets</span> <span class="variable">$assets</span> `</span><br><span class="line">                <span class="literal">-Config</span> <span class="variable">$typeConfig</span></span><br><span class="line">            </span><br><span class="line">            <span class="variable">$status</span>.Issues = <span class="variable">$issues</span></span><br><span class="line">            <span class="variable">$discoverer</span>.Issues += <span class="variable">$issues</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 更新发现状态</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="variable">$issues</span>.Count <span class="operator">-gt</span> <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="variable">$status</span>.Status = <span class="string">&quot;Warning&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="variable">$status</span>.Status = <span class="string">&quot;Success&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="variable">$discoverer</span>.DiscoveryStatus[<span class="variable">$type</span>] = <span class="variable">$status</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 记录发现日志</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$LogPath</span>) &#123;</span><br><span class="line">            <span class="variable">$discoverer</span> | <span class="built_in">ConvertTo-Json</span> <span class="literal">-Depth</span> <span class="number">10</span> | <span class="built_in">Out-File</span> <span class="literal">-FilePath</span> <span class="variable">$LogPath</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 更新发现器状态</span></span><br><span class="line">        <span class="variable">$discoverer</span>.EndTime = <span class="built_in">Get-Date</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$discoverer</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> &#123;</span><br><span class="line">        <span class="built_in">Write-Error</span> <span class="string">&quot;资产发现失败：<span class="variable">$_</span>&quot;</span></span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$null</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="资产跟踪"><a href="#资产跟踪" class="headerlink" title="资产跟踪"></a>资产跟踪</h2><p>接下来，创建一个用于管理资产跟踪的函数：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Track-SystemAssets</span></span> &#123;</span><br><span class="line">    <span class="function">[<span class="type">CmdletBinding</span>()]</span></span><br><span class="line">    <span class="keyword">param</span>(</span><br><span class="line">        [<span class="type">Parameter</span>(<span class="type">Mandatory</span> = <span class="variable">$true</span>)]</span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$TrackingID</span>,</span><br><span class="line">        </span><br><span class="line">        [<span class="type">Parameter</span>()]</span><br><span class="line">        [<span class="built_in">string</span>[]]<span class="variable">$TrackingTypes</span>,</span><br><span class="line">        </span><br><span class="line">        [<span class="type">Parameter</span>()]</span><br><span class="line">        [<span class="type">ValidateSet</span>(<span class="string">&quot;Usage&quot;</span>, <span class="string">&quot;Cost&quot;</span>, <span class="string">&quot;Lifecycle&quot;</span>)]</span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$TrackingMode</span> = <span class="string">&quot;Usage&quot;</span>,</span><br><span class="line">        </span><br><span class="line">        [<span class="type">Parameter</span>()]</span><br><span class="line">        [<span class="built_in">hashtable</span>]<span class="variable">$TrackingConfig</span>,</span><br><span class="line">        </span><br><span class="line">        [<span class="type">Parameter</span>()]</span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$ReportPath</span></span><br><span class="line">    )</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="variable">$tracker</span> = [<span class="type">PSCustomObject</span>]<span class="selector-tag">@</span>&#123;</span><br><span class="line">            TrackingID = <span class="variable">$TrackingID</span></span><br><span class="line">            StartTime = <span class="built_in">Get-Date</span></span><br><span class="line">            TrackingStatus = <span class="selector-tag">@</span>&#123;&#125;</span><br><span class="line">            Tracking = <span class="selector-tag">@</span>&#123;&#125;</span><br><span class="line">            Metrics = <span class="selector-tag">@</span>()</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 获取跟踪配置</span></span><br><span class="line">        <span class="variable">$config</span> = <span class="built_in">Get-TrackingConfig</span> <span class="literal">-TrackingID</span> <span class="variable">$TrackingID</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 管理跟踪</span></span><br><span class="line">        <span class="keyword">foreach</span> (<span class="variable">$type</span> <span class="keyword">in</span> <span class="variable">$TrackingTypes</span>) &#123;</span><br><span class="line">            <span class="variable">$status</span> = [<span class="type">PSCustomObject</span>]<span class="selector-tag">@</span>&#123;</span><br><span class="line">                <span class="built_in">Type</span> = <span class="variable">$type</span></span><br><span class="line">                Status = <span class="string">&quot;Unknown&quot;</span></span><br><span class="line">                Config = <span class="selector-tag">@</span>&#123;&#125;</span><br><span class="line">                Tracking = <span class="selector-tag">@</span>&#123;&#125;</span><br><span class="line">                Metrics = <span class="selector-tag">@</span>()</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 应用跟踪配置</span></span><br><span class="line">            <span class="variable">$typeConfig</span> = Apply<span class="literal">-TrackingConfig</span> `</span><br><span class="line">                <span class="literal">-Config</span> <span class="variable">$config</span> `</span><br><span class="line">                <span class="literal">-Type</span> <span class="variable">$type</span> `</span><br><span class="line">                <span class="literal">-Mode</span> <span class="variable">$TrackingMode</span> `</span><br><span class="line">                <span class="literal">-Settings</span> <span class="variable">$TrackingConfig</span></span><br><span class="line">            </span><br><span class="line">            <span class="variable">$status</span>.Config = <span class="variable">$typeConfig</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 跟踪系统资产</span></span><br><span class="line">            <span class="variable">$tracking</span> = Track<span class="literal">-AssetMetrics</span> `</span><br><span class="line">                <span class="literal">-Type</span> <span class="variable">$type</span> `</span><br><span class="line">                <span class="literal">-Config</span> <span class="variable">$typeConfig</span></span><br><span class="line">            </span><br><span class="line">            <span class="variable">$status</span>.Tracking = <span class="variable">$tracking</span></span><br><span class="line">            <span class="variable">$tracker</span>.Tracking[<span class="variable">$type</span>] = <span class="variable">$tracking</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 生成跟踪指标</span></span><br><span class="line">            <span class="variable">$metrics</span> = Generate<span class="literal">-TrackingMetrics</span> `</span><br><span class="line">                <span class="literal">-Tracking</span> <span class="variable">$tracking</span> `</span><br><span class="line">                <span class="literal">-Config</span> <span class="variable">$typeConfig</span></span><br><span class="line">            </span><br><span class="line">            <span class="variable">$status</span>.Metrics = <span class="variable">$metrics</span></span><br><span class="line">            <span class="variable">$tracker</span>.Metrics += <span class="variable">$metrics</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 更新跟踪状态</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="variable">$metrics</span>.Count <span class="operator">-gt</span> <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="variable">$status</span>.Status = <span class="string">&quot;Active&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="variable">$status</span>.Status = <span class="string">&quot;Inactive&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="variable">$tracker</span>.TrackingStatus[<span class="variable">$type</span>] = <span class="variable">$status</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 生成报告</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$ReportPath</span>) &#123;</span><br><span class="line">            <span class="variable">$report</span> = Generate<span class="literal">-TrackingReport</span> `</span><br><span class="line">                <span class="literal">-Tracker</span> <span class="variable">$tracker</span> `</span><br><span class="line">                <span class="literal">-Config</span> <span class="variable">$config</span></span><br><span class="line">            </span><br><span class="line">            <span class="variable">$report</span> | <span class="built_in">ConvertTo-Json</span> <span class="literal">-Depth</span> <span class="number">10</span> | <span class="built_in">Out-File</span> <span class="literal">-FilePath</span> <span class="variable">$ReportPath</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 更新跟踪器状态</span></span><br><span class="line">        <span class="variable">$tracker</span>.EndTime = <span class="built_in">Get-Date</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$tracker</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> &#123;</span><br><span class="line">        <span class="built_in">Write-Error</span> <span class="string">&quot;资产跟踪失败：<span class="variable">$_</span>&quot;</span></span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$null</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="资产优化"><a href="#资产优化" class="headerlink" title="资产优化"></a>资产优化</h2><p>最后，创建一个用于管理资产优化的函数：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Optimize-SystemAssets</span></span> &#123;</span><br><span class="line">    <span class="function">[<span class="type">CmdletBinding</span>()]</span></span><br><span class="line">    <span class="keyword">param</span>(</span><br><span class="line">        [<span class="type">Parameter</span>(<span class="type">Mandatory</span> = <span class="variable">$true</span>)]</span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$OptimizationID</span>,</span><br><span class="line">        </span><br><span class="line">        [<span class="type">Parameter</span>()]</span><br><span class="line">        [<span class="built_in">string</span>[]]<span class="variable">$OptimizationTypes</span>,</span><br><span class="line">        </span><br><span class="line">        [<span class="type">Parameter</span>()]</span><br><span class="line">        [<span class="type">ValidateSet</span>(<span class="string">&quot;Cost&quot;</span>, <span class="string">&quot;Performance&quot;</span>, <span class="string">&quot;Utilization&quot;</span>)]</span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$OptimizationMode</span> = <span class="string">&quot;Cost&quot;</span>,</span><br><span class="line">        </span><br><span class="line">        [<span class="type">Parameter</span>()]</span><br><span class="line">        [<span class="built_in">hashtable</span>]<span class="variable">$OptimizationConfig</span>,</span><br><span class="line">        </span><br><span class="line">        [<span class="type">Parameter</span>()]</span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$ReportPath</span></span><br><span class="line">    )</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="variable">$optimizer</span> = [<span class="type">PSCustomObject</span>]<span class="selector-tag">@</span>&#123;</span><br><span class="line">            OptimizationID = <span class="variable">$OptimizationID</span></span><br><span class="line">            StartTime = <span class="built_in">Get-Date</span></span><br><span class="line">            OptimizationStatus = <span class="selector-tag">@</span>&#123;&#125;</span><br><span class="line">            Optimizations = <span class="selector-tag">@</span>&#123;&#125;</span><br><span class="line">            Actions = <span class="selector-tag">@</span>()</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 获取优化配置</span></span><br><span class="line">        <span class="variable">$config</span> = <span class="built_in">Get-OptimizationConfig</span> <span class="literal">-OptimizationID</span> <span class="variable">$OptimizationID</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 管理优化</span></span><br><span class="line">        <span class="keyword">foreach</span> (<span class="variable">$type</span> <span class="keyword">in</span> <span class="variable">$OptimizationTypes</span>) &#123;</span><br><span class="line">            <span class="variable">$status</span> = [<span class="type">PSCustomObject</span>]<span class="selector-tag">@</span>&#123;</span><br><span class="line">                <span class="built_in">Type</span> = <span class="variable">$type</span></span><br><span class="line">                Status = <span class="string">&quot;Unknown&quot;</span></span><br><span class="line">                Config = <span class="selector-tag">@</span>&#123;&#125;</span><br><span class="line">                Optimizations = <span class="selector-tag">@</span>&#123;&#125;</span><br><span class="line">                Actions = <span class="selector-tag">@</span>()</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 应用优化配置</span></span><br><span class="line">            <span class="variable">$typeConfig</span> = Apply<span class="literal">-OptimizationConfig</span> `</span><br><span class="line">                <span class="literal">-Config</span> <span class="variable">$config</span> `</span><br><span class="line">                <span class="literal">-Type</span> <span class="variable">$type</span> `</span><br><span class="line">                <span class="literal">-Mode</span> <span class="variable">$OptimizationMode</span> `</span><br><span class="line">                <span class="literal">-Settings</span> <span class="variable">$OptimizationConfig</span></span><br><span class="line">            </span><br><span class="line">            <span class="variable">$status</span>.Config = <span class="variable">$typeConfig</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 优化系统资产</span></span><br><span class="line">            <span class="variable">$optimizations</span> = <span class="built_in">Optimize-AssetUsage</span> `</span><br><span class="line">                <span class="literal">-Type</span> <span class="variable">$type</span> `</span><br><span class="line">                <span class="literal">-Config</span> <span class="variable">$typeConfig</span></span><br><span class="line">            </span><br><span class="line">            <span class="variable">$status</span>.Optimizations = <span class="variable">$optimizations</span></span><br><span class="line">            <span class="variable">$optimizer</span>.Optimizations[<span class="variable">$type</span>] = <span class="variable">$optimizations</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 执行优化动作</span></span><br><span class="line">            <span class="variable">$actions</span> = Execute<span class="literal">-OptimizationActions</span> `</span><br><span class="line">                <span class="literal">-Optimizations</span> <span class="variable">$optimizations</span> `</span><br><span class="line">                <span class="literal">-Config</span> <span class="variable">$typeConfig</span></span><br><span class="line">            </span><br><span class="line">            <span class="variable">$status</span>.Actions = <span class="variable">$actions</span></span><br><span class="line">            <span class="variable">$optimizer</span>.Actions += <span class="variable">$actions</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 更新优化状态</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="variable">$actions</span>.Count <span class="operator">-gt</span> <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="variable">$status</span>.Status = <span class="string">&quot;Optimized&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="variable">$status</span>.Status = <span class="string">&quot;NoAction&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="variable">$optimizer</span>.OptimizationStatus[<span class="variable">$type</span>] = <span class="variable">$status</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 生成报告</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$ReportPath</span>) &#123;</span><br><span class="line">            <span class="variable">$report</span> = Generate<span class="literal">-OptimizationReport</span> `</span><br><span class="line">                <span class="literal">-Optimizer</span> <span class="variable">$optimizer</span> `</span><br><span class="line">                <span class="literal">-Config</span> <span class="variable">$config</span></span><br><span class="line">            </span><br><span class="line">            <span class="variable">$report</span> | <span class="built_in">ConvertTo-Json</span> <span class="literal">-Depth</span> <span class="number">10</span> | <span class="built_in">Out-File</span> <span class="literal">-FilePath</span> <span class="variable">$ReportPath</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 更新优化器状态</span></span><br><span class="line">        <span class="variable">$optimizer</span>.EndTime = <span class="built_in">Get-Date</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$optimizer</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> &#123;</span><br><span class="line">        <span class="built_in">Write-Error</span> <span class="string">&quot;资产优化失败：<span class="variable">$_</span>&quot;</span></span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$null</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="使用示例"><a href="#使用示例" class="headerlink" title="使用示例"></a>使用示例</h2><p>以下是如何使用这些函数来管理资产的示例：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 发现系统资产</span></span><br><span class="line"><span class="variable">$discoverer</span> = Discover<span class="literal">-SystemAssets</span> <span class="literal">-DiscoveryID</span> <span class="string">&quot;DISCOVERY001&quot;</span> `</span><br><span class="line">    <span class="literal">-AssetTypes</span> <span class="selector-tag">@</span>(<span class="string">&quot;Hardware&quot;</span>, <span class="string">&quot;Software&quot;</span>, <span class="string">&quot;Network&quot;</span>, <span class="string">&quot;Storage&quot;</span>) `</span><br><span class="line">    <span class="literal">-DiscoveryMode</span> <span class="string">&quot;Full&quot;</span> `</span><br><span class="line">    <span class="literal">-DiscoveryConfig</span> <span class="selector-tag">@</span>&#123;</span><br><span class="line">        <span class="string">&quot;Hardware&quot;</span> = <span class="selector-tag">@</span>&#123;</span><br><span class="line">            <span class="string">&quot;Categories&quot;</span> = <span class="selector-tag">@</span>(<span class="string">&quot;Server&quot;</span>, <span class="string">&quot;Desktop&quot;</span>, <span class="string">&quot;Mobile&quot;</span>)</span><br><span class="line">            <span class="string">&quot;Attributes&quot;</span> = <span class="selector-tag">@</span>(<span class="string">&quot;CPU&quot;</span>, <span class="string">&quot;Memory&quot;</span>, <span class="string">&quot;Storage&quot;</span>)</span><br><span class="line">            <span class="string">&quot;Filter&quot;</span> = <span class="string">&quot;Status = Active&quot;</span></span><br><span class="line">            <span class="string">&quot;Retention&quot;</span> = <span class="number">7</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="string">&quot;Software&quot;</span> = <span class="selector-tag">@</span>&#123;</span><br><span class="line">            <span class="string">&quot;Categories&quot;</span> = <span class="selector-tag">@</span>(<span class="string">&quot;OS&quot;</span>, <span class="string">&quot;Application&quot;</span>, <span class="string">&quot;Driver&quot;</span>)</span><br><span class="line">            <span class="string">&quot;Attributes&quot;</span> = <span class="selector-tag">@</span>(<span class="string">&quot;Version&quot;</span>, <span class="string">&quot;License&quot;</span>, <span class="string">&quot;InstallDate&quot;</span>)</span><br><span class="line">            <span class="string">&quot;Filter&quot;</span> = <span class="string">&quot;Status = Installed&quot;</span></span><br><span class="line">            <span class="string">&quot;Retention&quot;</span> = <span class="number">7</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="string">&quot;Network&quot;</span> = <span class="selector-tag">@</span>&#123;</span><br><span class="line">            <span class="string">&quot;Categories&quot;</span> = <span class="selector-tag">@</span>(<span class="string">&quot;Device&quot;</span>, <span class="string">&quot;Connection&quot;</span>, <span class="string">&quot;Protocol&quot;</span>)</span><br><span class="line">            <span class="string">&quot;Attributes&quot;</span> = <span class="selector-tag">@</span>(<span class="string">&quot;IP&quot;</span>, <span class="string">&quot;MAC&quot;</span>, <span class="string">&quot;Speed&quot;</span>)</span><br><span class="line">            <span class="string">&quot;Filter&quot;</span> = <span class="string">&quot;Status = Connected&quot;</span></span><br><span class="line">            <span class="string">&quot;Retention&quot;</span> = <span class="number">7</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="string">&quot;Storage&quot;</span> = <span class="selector-tag">@</span>&#123;</span><br><span class="line">            <span class="string">&quot;Categories&quot;</span> = <span class="selector-tag">@</span>(<span class="string">&quot;Disk&quot;</span>, <span class="string">&quot;Volume&quot;</span>, <span class="string">&quot;Share&quot;</span>)</span><br><span class="line">            <span class="string">&quot;Attributes&quot;</span> = <span class="selector-tag">@</span>(<span class="string">&quot;Size&quot;</span>, <span class="string">&quot;Free&quot;</span>, <span class="string">&quot;Type&quot;</span>)</span><br><span class="line">            <span class="string">&quot;Filter&quot;</span> = <span class="string">&quot;Status = Online&quot;</span></span><br><span class="line">            <span class="string">&quot;Retention&quot;</span> = <span class="number">7</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125; `</span><br><span class="line">    <span class="literal">-LogPath</span> <span class="string">&quot;C:\Logs\asset_discovery.json&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 跟踪系统资产</span></span><br><span class="line"><span class="variable">$tracker</span> = Track<span class="literal">-SystemAssets</span> <span class="literal">-TrackingID</span> <span class="string">&quot;TRACKING001&quot;</span> `</span><br><span class="line">    <span class="literal">-TrackingTypes</span> <span class="selector-tag">@</span>(<span class="string">&quot;Usage&quot;</span>, <span class="string">&quot;Cost&quot;</span>, <span class="string">&quot;Lifecycle&quot;</span>) `</span><br><span class="line">    <span class="literal">-TrackingMode</span> <span class="string">&quot;Usage&quot;</span> `</span><br><span class="line">    <span class="literal">-TrackingConfig</span> <span class="selector-tag">@</span>&#123;</span><br><span class="line">        <span class="string">&quot;Usage&quot;</span> = <span class="selector-tag">@</span>&#123;</span><br><span class="line">            <span class="string">&quot;Metrics&quot;</span> = <span class="selector-tag">@</span>(<span class="string">&quot;CPU&quot;</span>, <span class="string">&quot;Memory&quot;</span>, <span class="string">&quot;Storage&quot;</span>, <span class="string">&quot;Network&quot;</span>)</span><br><span class="line">            <span class="string">&quot;Threshold&quot;</span> = <span class="number">80</span></span><br><span class="line">            <span class="string">&quot;Interval&quot;</span> = <span class="number">60</span></span><br><span class="line">            <span class="string">&quot;Report&quot;</span> = <span class="variable">$true</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="string">&quot;Cost&quot;</span> = <span class="selector-tag">@</span>&#123;</span><br><span class="line">            <span class="string">&quot;Metrics&quot;</span> = <span class="selector-tag">@</span>(<span class="string">&quot;License&quot;</span>, <span class="string">&quot;Maintenance&quot;</span>, <span class="string">&quot;Support&quot;</span>)</span><br><span class="line">            <span class="string">&quot;Threshold&quot;</span> = <span class="number">1000</span></span><br><span class="line">            <span class="string">&quot;Interval&quot;</span> = <span class="number">30</span></span><br><span class="line">            <span class="string">&quot;Report&quot;</span> = <span class="variable">$true</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="string">&quot;Lifecycle&quot;</span> = <span class="selector-tag">@</span>&#123;</span><br><span class="line">            <span class="string">&quot;Metrics&quot;</span> = <span class="selector-tag">@</span>(<span class="string">&quot;Age&quot;</span>, <span class="string">&quot;Warranty&quot;</span>, <span class="string">&quot;Depreciation&quot;</span>)</span><br><span class="line">            <span class="string">&quot;Threshold&quot;</span> = <span class="number">365</span></span><br><span class="line">            <span class="string">&quot;Interval&quot;</span> = <span class="number">90</span></span><br><span class="line">            <span class="string">&quot;Report&quot;</span> = <span class="variable">$true</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125; `</span><br><span class="line">    <span class="literal">-ReportPath</span> <span class="string">&quot;C:\Reports\asset_tracking.json&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 优化系统资产</span></span><br><span class="line"><span class="variable">$optimizer</span> = <span class="built_in">Optimize-SystemAssets</span> <span class="literal">-OptimizationID</span> <span class="string">&quot;OPTIMIZATION001&quot;</span> `</span><br><span class="line">    <span class="literal">-OptimizationTypes</span> <span class="selector-tag">@</span>(<span class="string">&quot;Cost&quot;</span>, <span class="string">&quot;Performance&quot;</span>, <span class="string">&quot;Utilization&quot;</span>) `</span><br><span class="line">    <span class="literal">-OptimizationMode</span> <span class="string">&quot;Cost&quot;</span> `</span><br><span class="line">    <span class="literal">-OptimizationConfig</span> <span class="selector-tag">@</span>&#123;</span><br><span class="line">        <span class="string">&quot;Cost&quot;</span> = <span class="selector-tag">@</span>&#123;</span><br><span class="line">            <span class="string">&quot;Metrics&quot;</span> = <span class="selector-tag">@</span>(<span class="string">&quot;License&quot;</span>, <span class="string">&quot;Maintenance&quot;</span>, <span class="string">&quot;Support&quot;</span>)</span><br><span class="line">            <span class="string">&quot;Threshold&quot;</span> = <span class="number">1000</span></span><br><span class="line">            <span class="string">&quot;Actions&quot;</span> = <span class="selector-tag">@</span>(<span class="string">&quot;Renew&quot;</span>, <span class="string">&quot;Upgrade&quot;</span>, <span class="string">&quot;Terminate&quot;</span>)</span><br><span class="line">            <span class="string">&quot;Report&quot;</span> = <span class="variable">$true</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="string">&quot;Performance&quot;</span> = <span class="selector-tag">@</span>&#123;</span><br><span class="line">            <span class="string">&quot;Metrics&quot;</span> = <span class="selector-tag">@</span>(<span class="string">&quot;CPU&quot;</span>, <span class="string">&quot;Memory&quot;</span>, <span class="string">&quot;Storage&quot;</span>, <span class="string">&quot;Network&quot;</span>)</span><br><span class="line">            <span class="string">&quot;Threshold&quot;</span> = <span class="number">80</span></span><br><span class="line">            <span class="string">&quot;Actions&quot;</span> = <span class="selector-tag">@</span>(<span class="string">&quot;Scale&quot;</span>, <span class="string">&quot;Upgrade&quot;</span>, <span class="string">&quot;Migrate&quot;</span>)</span><br><span class="line">            <span class="string">&quot;Report&quot;</span> = <span class="variable">$true</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="string">&quot;Utilization&quot;</span> = <span class="selector-tag">@</span>&#123;</span><br><span class="line">            <span class="string">&quot;Metrics&quot;</span> = <span class="selector-tag">@</span>(<span class="string">&quot;Usage&quot;</span>, <span class="string">&quot;Efficiency&quot;</span>, <span class="string">&quot;Availability&quot;</span>)</span><br><span class="line">            <span class="string">&quot;Threshold&quot;</span> = <span class="number">60</span></span><br><span class="line">            <span class="string">&quot;Actions&quot;</span> = <span class="selector-tag">@</span>(<span class="string">&quot;Consolidate&quot;</span>, <span class="string">&quot;Optimize&quot;</span>, <span class="string">&quot;Decommission&quot;</span>)</span><br><span class="line">            <span class="string">&quot;Report&quot;</span> = <span class="variable">$true</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125; `</span><br><span class="line">    <span class="literal">-ReportPath</span> <span class="string">&quot;C:\Reports\asset_optimization.json&quot;</span></span><br></pre></td></tr></table></figure>

<h2 id="最佳实践"><a href="#最佳实践" class="headerlink" title="最佳实践"></a>最佳实践</h2><ol>
<li>实施资产发现</li>
<li>跟踪资产使用</li>
<li>优化资产利用</li>
<li>保持详细的资产记录</li>
<li>定期进行资产评估</li>
<li>实施优化策略</li>
<li>建立成本控制</li>
<li>保持系统文档更新</li>
</ol>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2025-02-25T00:00:00.000Z" title="2025/2/25 08:00:00">2025-02-25</time>发表</span><span class="level-item"><time dateTime="2025-03-25T07:49:53.369Z" title="2025/3/25 15:49:53">2025-03-25</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/powershell/">powershell</a><span> / </span><a class="link-muted" href="/categories/powershell/tip/">tip</a></span><span class="level-item">4 分钟读完 (大约572个字)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2025/02/25/powershell-video-processing/">PowerShell 技能连载 - 视频处理技巧</a></h1><div class="content"><p>在 PowerShell 中处理视频文件是一项有趣的任务，本文将介绍一些实用的视频处理技巧。</p>
<p>首先，让我们看看基本的视频操作：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建视频信息获取函数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Get-VideoInfo</span></span> &#123;</span><br><span class="line">    <span class="keyword">param</span>(</span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$VideoPath</span></span><br><span class="line">    )</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment"># 使用 ffprobe 获取视频信息</span></span><br><span class="line">        <span class="variable">$ffprobe</span> = <span class="string">&quot;ffprobe&quot;</span></span><br><span class="line">        <span class="variable">$info</span> = &amp; <span class="variable">$ffprobe</span> <span class="literal">-v</span> quiet <span class="literal">-print_format</span> json <span class="literal">-show_format</span> <span class="literal">-show_streams</span> <span class="variable">$VideoPath</span> | <span class="built_in">ConvertFrom-Json</span></span><br><span class="line">        </span><br><span class="line">        <span class="variable">$videoStream</span> = <span class="variable">$info</span>.streams | <span class="built_in">Where-Object</span> &#123; <span class="variable">$_</span>.codec_type <span class="operator">-eq</span> <span class="string">&quot;video&quot;</span> &#125;</span><br><span class="line">        <span class="variable">$audioStream</span> = <span class="variable">$info</span>.streams | <span class="built_in">Where-Object</span> &#123; <span class="variable">$_</span>.codec_type <span class="operator">-eq</span> <span class="string">&quot;audio&quot;</span> &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> [<span class="type">PSCustomObject</span>]<span class="selector-tag">@</span>&#123;</span><br><span class="line">            FileName = <span class="built_in">Split-Path</span> <span class="variable">$VideoPath</span> <span class="literal">-Leaf</span></span><br><span class="line">            Duration = [<span class="type">math</span>]::Round([<span class="built_in">double</span>]<span class="variable">$info</span>.format.duration, <span class="number">2</span>)</span><br><span class="line">            Size = [<span class="type">math</span>]::Round([<span class="built_in">double</span>]<span class="variable">$info</span>.format.size / <span class="number">1</span>MB, <span class="number">2</span>)</span><br><span class="line">            Bitrate = [<span class="type">math</span>]::Round([<span class="built_in">double</span>]<span class="variable">$info</span>.format.bit_rate / <span class="number">1000</span>, <span class="number">2</span>)</span><br><span class="line">            Format = <span class="variable">$info</span>.format.format_name</span><br><span class="line">            VideoCodec = <span class="variable">$videoStream</span>.codec_name</span><br><span class="line">            VideoResolution = <span class="string">&quot;<span class="variable">$</span>(<span class="variable">$videoStream</span>.width)x<span class="variable">$</span>(<span class="variable">$videoStream</span>.height)&quot;</span></span><br><span class="line">            AudioCodec = <span class="variable">$audioStream</span>.codec_name</span><br><span class="line">            AudioChannels = <span class="variable">$audioStream</span>.channels</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> &#123;</span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">&quot;获取视频信息失败：<span class="variable">$_</span>&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>视频格式转换：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建视频格式转换函数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Convert-VideoFormat</span></span> &#123;</span><br><span class="line">    <span class="keyword">param</span>(</span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$InputPath</span>,</span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$OutputPath</span>,</span><br><span class="line">        [<span class="type">ValidateSet</span>(<span class="string">&quot;mp4&quot;</span>, <span class="string">&quot;avi&quot;</span>, <span class="string">&quot;mkv&quot;</span>, <span class="string">&quot;mov&quot;</span>)]</span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$TargetFormat</span>,</span><br><span class="line">        [<span class="type">ValidateSet</span>(<span class="string">&quot;high&quot;</span>, <span class="string">&quot;medium&quot;</span>, <span class="string">&quot;low&quot;</span>)]</span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$Quality</span> = <span class="string">&quot;medium&quot;</span></span><br><span class="line">    )</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="variable">$ffmpeg</span> = <span class="string">&quot;ffmpeg&quot;</span></span><br><span class="line">        <span class="variable">$qualitySettings</span> = <span class="selector-tag">@</span>&#123;</span><br><span class="line">            <span class="string">&quot;high&quot;</span> = <span class="string">&quot;-crf 17&quot;</span></span><br><span class="line">            <span class="string">&quot;medium&quot;</span> = <span class="string">&quot;-crf 23&quot;</span></span><br><span class="line">            <span class="string">&quot;low&quot;</span> = <span class="string">&quot;-crf 28&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="variable">$command</span> = <span class="string">&quot;<span class="variable">$ffmpeg</span> -i `&quot;<span class="variable">$InputPath</span>`&quot; <span class="variable">$</span>(<span class="variable">$qualitySettings</span>[<span class="variable">$Quality</span>]) `&quot;<span class="variable">$OutputPath</span>`&quot;&quot;</span></span><br><span class="line">        <span class="built_in">Invoke-Expression</span> <span class="variable">$command</span></span><br><span class="line">        </span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">&quot;格式转换完成：<span class="variable">$OutputPath</span>&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> &#123;</span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">&quot;转换失败：<span class="variable">$_</span>&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>视频剪辑：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建视频剪辑函数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Split-Video</span></span> &#123;</span><br><span class="line">    <span class="keyword">param</span>(</span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$InputPath</span>,</span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$OutputFolder</span>,</span><br><span class="line">        [<span class="built_in">double</span>]<span class="variable">$StartTime</span>,</span><br><span class="line">        [<span class="built_in">double</span>]<span class="variable">$Duration</span></span><br><span class="line">    )</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="variable">$ffmpeg</span> = <span class="string">&quot;ffmpeg&quot;</span></span><br><span class="line">        <span class="variable">$fileName</span> = [<span class="type">System.IO.Path</span>]::GetFileNameWithoutExtension(<span class="variable">$InputPath</span>)</span><br><span class="line">        <span class="variable">$extension</span> = [<span class="type">System.IO.Path</span>]::GetExtension(<span class="variable">$InputPath</span>)</span><br><span class="line">        <span class="variable">$outputPath</span> = <span class="built_in">Join-Path</span> <span class="variable">$OutputFolder</span> <span class="string">&quot;<span class="variable">$fileName</span>`_split<span class="variable">$extension</span>&quot;</span></span><br><span class="line">        </span><br><span class="line">        <span class="variable">$command</span> = <span class="string">&quot;<span class="variable">$ffmpeg</span> -i `&quot;<span class="variable">$InputPath</span>`&quot; -ss <span class="variable">$StartTime</span> -t <span class="variable">$Duration</span> `&quot;<span class="variable">$outputPath</span>`&quot;&quot;</span></span><br><span class="line">        <span class="built_in">Invoke-Expression</span> <span class="variable">$command</span></span><br><span class="line">        </span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">&quot;视频剪辑完成：<span class="variable">$outputPath</span>&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> &#123;</span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">&quot;剪辑失败：<span class="variable">$_</span>&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>视频压缩：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建视频压缩函数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Compress-Video</span></span> &#123;</span><br><span class="line">    <span class="keyword">param</span>(</span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$InputPath</span>,</span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$OutputPath</span>,</span><br><span class="line">        [<span class="type">ValidateSet</span>(<span class="string">&quot;high&quot;</span>, <span class="string">&quot;medium&quot;</span>, <span class="string">&quot;low&quot;</span>)]</span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$Quality</span> = <span class="string">&quot;medium&quot;</span>,</span><br><span class="line">        [<span class="built_in">int</span>]<span class="variable">$MaxWidth</span> = <span class="number">1920</span></span><br><span class="line">    )</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="variable">$ffmpeg</span> = <span class="string">&quot;ffmpeg&quot;</span></span><br><span class="line">        <span class="variable">$qualitySettings</span> = <span class="selector-tag">@</span>&#123;</span><br><span class="line">            <span class="string">&quot;high&quot;</span> = <span class="string">&quot;-crf 23&quot;</span></span><br><span class="line">            <span class="string">&quot;medium&quot;</span> = <span class="string">&quot;-crf 28&quot;</span></span><br><span class="line">            <span class="string">&quot;low&quot;</span> = <span class="string">&quot;-crf 33&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="variable">$command</span> = <span class="string">&quot;<span class="variable">$ffmpeg</span> -i `&quot;<span class="variable">$InputPath</span>`&quot; -vf scale=<span class="variable">$MaxWidth</span>`:-1 <span class="variable">$</span>(<span class="variable">$qualitySettings</span>[<span class="variable">$Quality</span>]) `&quot;<span class="variable">$OutputPath</span>`&quot;&quot;</span></span><br><span class="line">        <span class="built_in">Invoke-Expression</span> <span class="variable">$command</span></span><br><span class="line">        </span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">&quot;视频压缩完成：<span class="variable">$OutputPath</span>&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> &#123;</span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">&quot;压缩失败：<span class="variable">$_</span>&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>视频帧提取：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建视频帧提取函数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Extract-VideoFrames</span></span> &#123;</span><br><span class="line">    <span class="keyword">param</span>(</span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$InputPath</span>,</span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$OutputFolder</span>,</span><br><span class="line">        [<span class="built_in">double</span>]<span class="variable">$Interval</span> = <span class="number">1.0</span>,</span><br><span class="line">        [<span class="type">ValidateSet</span>(<span class="string">&quot;jpg&quot;</span>, <span class="string">&quot;png&quot;</span>)]</span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$Format</span> = <span class="string">&quot;jpg&quot;</span></span><br><span class="line">    )</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="variable">$ffmpeg</span> = <span class="string">&quot;ffmpeg&quot;</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="operator">-not</span> (<span class="built_in">Test-Path</span> <span class="variable">$OutputFolder</span>)) &#123;</span><br><span class="line">            <span class="built_in">New-Item</span> <span class="literal">-ItemType</span> Directory <span class="literal">-Path</span> <span class="variable">$OutputFolder</span> | <span class="built_in">Out-Null</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="variable">$fileName</span> = [<span class="type">System.IO.Path</span>]::GetFileNameWithoutExtension(<span class="variable">$InputPath</span>)</span><br><span class="line">        <span class="variable">$outputPattern</span> = <span class="built_in">Join-Path</span> <span class="variable">$OutputFolder</span> <span class="string">&quot;<span class="variable">$fileName</span>`_%d.<span class="variable">$Format</span>&quot;</span></span><br><span class="line">        </span><br><span class="line">        <span class="variable">$command</span> = <span class="string">&quot;<span class="variable">$ffmpeg</span> -i `&quot;<span class="variable">$InputPath</span>`&quot; -vf fps=1/<span class="variable">$Interval</span> `&quot;<span class="variable">$outputPattern</span>`&quot;&quot;</span></span><br><span class="line">        <span class="built_in">Invoke-Expression</span> <span class="variable">$command</span></span><br><span class="line">        </span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">&quot;帧提取完成：<span class="variable">$OutputFolder</span>&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> &#123;</span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">&quot;帧提取失败：<span class="variable">$_</span>&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这些技巧将帮助您更有效地处理视频文件。记住，在处理视频时，始终要注意文件格式的兼容性和视频质量。同时，建议在处理大型视频文件时使用流式处理方式，以提高性能。 </p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2025-02-19T00:00:00.000Z" title="2025/2/19 08:00:00">2025-02-19</time>发表</span><span class="level-item"><time dateTime="2025-03-25T07:49:53.728Z" title="2025/3/25 15:49:53">2025-03-25</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/powershell/">powershell</a><span> / </span><a class="link-muted" href="/categories/powershell/tip/">tip</a></span><span class="level-item">4 分钟读完 (大约658个字)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2025/02/19/powershell-kubernetes-management/">PowerShell 技能连载 - Kubernetes 管理技巧</a></h1><div class="content"><p>在 PowerShell 中管理 Kubernetes 是一项重要任务，本文将介绍一些实用的 Kubernetes 管理技巧。</p>
<p>首先，让我们看看基本的 Kubernetes 操作：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建 Kubernetes 集群管理函数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Manage-K8sCluster</span></span> &#123;</span><br><span class="line">    <span class="keyword">param</span>(</span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$ClusterName</span>,</span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$ResourceGroup</span>,</span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$Location</span>,</span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$NodeCount</span>,</span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$NodeSize</span>,</span><br><span class="line">        [<span class="type">ValidateSet</span>(<span class="string">&#x27;Create&#x27;</span>, <span class="string">&#x27;Update&#x27;</span>, <span class="string">&#x27;Delete&#x27;</span>, <span class="string">&#x27;Start&#x27;</span>, <span class="string">&#x27;Stop&#x27;</span>)]</span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$Action</span></span><br><span class="line">    )</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="built_in">Import-Module</span> Az.Aks</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">switch</span> (<span class="variable">$Action</span>) &#123;</span><br><span class="line">            <span class="string">&#x27;Create&#x27;</span> &#123;</span><br><span class="line">                <span class="built_in">New-AzAksCluster</span> <span class="literal">-Name</span> <span class="variable">$ClusterName</span> <span class="literal">-ResourceGroupName</span> <span class="variable">$ResourceGroup</span> <span class="literal">-Location</span> <span class="variable">$Location</span> <span class="literal">-NodeCount</span> <span class="variable">$NodeCount</span> <span class="literal">-NodeSize</span> <span class="variable">$NodeSize</span></span><br><span class="line">                <span class="built_in">Write-Host</span> <span class="string">&quot;Kubernetes 集群 <span class="variable">$ClusterName</span> 创建成功&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="string">&#x27;Update&#x27;</span> &#123;</span><br><span class="line">                <span class="built_in">Update-AzAksCluster</span> <span class="literal">-Name</span> <span class="variable">$ClusterName</span> <span class="literal">-ResourceGroupName</span> <span class="variable">$ResourceGroup</span> <span class="literal">-NodeCount</span> <span class="variable">$NodeCount</span></span><br><span class="line">                <span class="built_in">Write-Host</span> <span class="string">&quot;Kubernetes 集群 <span class="variable">$ClusterName</span> 更新成功&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="string">&#x27;Delete&#x27;</span> &#123;</span><br><span class="line">                <span class="built_in">Remove-AzAksCluster</span> <span class="literal">-Name</span> <span class="variable">$ClusterName</span> <span class="literal">-ResourceGroupName</span> <span class="variable">$ResourceGroup</span> <span class="literal">-Force</span></span><br><span class="line">                <span class="built_in">Write-Host</span> <span class="string">&quot;Kubernetes 集群 <span class="variable">$ClusterName</span> 删除成功&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="string">&#x27;Start&#x27;</span> &#123;</span><br><span class="line">                <span class="built_in">Start-AzAksCluster</span> <span class="literal">-Name</span> <span class="variable">$ClusterName</span> <span class="literal">-ResourceGroupName</span> <span class="variable">$ResourceGroup</span></span><br><span class="line">                <span class="built_in">Write-Host</span> <span class="string">&quot;Kubernetes 集群 <span class="variable">$ClusterName</span> 已启动&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="string">&#x27;Stop&#x27;</span> &#123;</span><br><span class="line">                <span class="built_in">Stop-AzAksCluster</span> <span class="literal">-Name</span> <span class="variable">$ClusterName</span> <span class="literal">-ResourceGroupName</span> <span class="variable">$ResourceGroup</span></span><br><span class="line">                <span class="built_in">Write-Host</span> <span class="string">&quot;Kubernetes 集群 <span class="variable">$ClusterName</span> 已停止&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> &#123;</span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">&quot;Kubernetes 集群操作失败：<span class="variable">$_</span>&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Kubernetes 资源部署：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建 Kubernetes 资源部署函数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Deploy-K8sResource</span></span> &#123;</span><br><span class="line">    <span class="keyword">param</span>(</span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$Namespace</span>,</span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$ManifestPath</span>,</span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$Context</span>,</span><br><span class="line">        [<span class="type">switch</span>]<span class="variable">$DryRun</span></span><br><span class="line">    )</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="built_in">Import-Module</span> Kubernetes</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$DryRun</span>) &#123;</span><br><span class="line">            <span class="variable">$result</span> = kubectl apply <span class="operator">-f</span> <span class="variable">$ManifestPath</span> <span class="literal">-n</span> <span class="variable">$Namespace</span> <span class="literal">--context</span> <span class="variable">$Context</span> <span class="literal">--dry-run</span>=client</span><br><span class="line">            <span class="built_in">Write-Host</span> <span class="string">&quot;部署预览：&quot;</span></span><br><span class="line">            <span class="variable">$result</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable">$result</span> = kubectl apply <span class="operator">-f</span> <span class="variable">$ManifestPath</span> <span class="literal">-n</span> <span class="variable">$Namespace</span> <span class="literal">--context</span> <span class="variable">$Context</span></span><br><span class="line">            <span class="built_in">Write-Host</span> <span class="string">&quot;资源已部署到命名空间 <span class="variable">$Namespace</span>&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> [<span class="type">PSCustomObject</span>]<span class="selector-tag">@</span>&#123;</span><br><span class="line">            Namespace = <span class="variable">$Namespace</span></span><br><span class="line">            ManifestPath = <span class="variable">$ManifestPath</span></span><br><span class="line">            Context = <span class="variable">$Context</span></span><br><span class="line">            Result = <span class="variable">$result</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> &#123;</span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">&quot;资源部署失败：<span class="variable">$_</span>&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Kubernetes 日志收集：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建 Kubernetes 日志收集函数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Get-K8sLogs</span></span> &#123;</span><br><span class="line">    <span class="keyword">param</span>(</span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$Namespace</span>,</span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$Pod</span>,</span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$Container</span>,</span><br><span class="line">        [<span class="built_in">int</span>]<span class="variable">$Lines</span> = <span class="number">100</span>,</span><br><span class="line">        [<span class="built_in">datetime</span>]<span class="variable">$Since</span>,</span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$OutputPath</span></span><br><span class="line">    )</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="built_in">Import-Module</span> Kubernetes</span><br><span class="line">        </span><br><span class="line">        <span class="variable">$logParams</span> = <span class="selector-tag">@</span>(</span><br><span class="line">            <span class="string">&quot;logs&quot;</span>,</span><br><span class="line">            <span class="variable">$Pod</span>,</span><br><span class="line">            <span class="string">&quot;-n&quot;</span>, <span class="variable">$Namespace</span>,</span><br><span class="line">            <span class="string">&quot;--tail=<span class="variable">$Lines</span>&quot;</span></span><br><span class="line">        )</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$Container</span>) &#123;</span><br><span class="line">            <span class="variable">$logParams</span> += <span class="string">&quot;-c&quot;</span>, <span class="variable">$Container</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$Since</span>) &#123;</span><br><span class="line">            <span class="variable">$logParams</span> += <span class="string">&quot;--since=<span class="variable">$</span>(<span class="variable">$Since</span>.ToString(&#x27;yyyy-MM-ddTHH:mm:ssZ&#x27;))&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="variable">$logs</span> = kubectl <span class="variable">$logParams</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$OutputPath</span>) &#123;</span><br><span class="line">            <span class="variable">$logs</span> | <span class="built_in">Out-File</span> <span class="literal">-FilePath</span> <span class="variable">$OutputPath</span> <span class="literal">-Encoding</span> UTF8</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> [<span class="type">PSCustomObject</span>]<span class="selector-tag">@</span>&#123;</span><br><span class="line">            Pod = <span class="variable">$Pod</span></span><br><span class="line">            Namespace = <span class="variable">$Namespace</span></span><br><span class="line">            Container = <span class="variable">$Container</span></span><br><span class="line">            LogCount = <span class="variable">$logs</span>.Count</span><br><span class="line">            OutputPath = <span class="variable">$OutputPath</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> &#123;</span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">&quot;日志收集失败：<span class="variable">$_</span>&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Kubernetes 资源监控：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建 Kubernetes 资源监控函数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Monitor-K8sResources</span></span> &#123;</span><br><span class="line">    <span class="keyword">param</span>(</span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$Namespace</span>,</span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$ResourceType</span>,</span><br><span class="line">        [<span class="built_in">int</span>]<span class="variable">$Duration</span> = <span class="number">3600</span>,</span><br><span class="line">        [<span class="built_in">int</span>]<span class="variable">$Interval</span> = <span class="number">60</span></span><br><span class="line">    )</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="built_in">Import-Module</span> Kubernetes</span><br><span class="line">        </span><br><span class="line">        <span class="variable">$metrics</span> = <span class="selector-tag">@</span>()</span><br><span class="line">        <span class="variable">$endTime</span> = <span class="built_in">Get-Date</span></span><br><span class="line">        <span class="variable">$startTime</span> = <span class="variable">$endTime</span>.AddSeconds(-<span class="variable">$Duration</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">while</span> (<span class="variable">$startTime</span> <span class="operator">-lt</span> <span class="variable">$endTime</span>) &#123;</span><br><span class="line">            <span class="variable">$resourceMetrics</span> = <span class="keyword">switch</span> (<span class="variable">$ResourceType</span>) &#123;</span><br><span class="line">                <span class="string">&quot;Pod&quot;</span> &#123;</span><br><span class="line">                    kubectl top pods <span class="literal">-n</span> <span class="variable">$Namespace</span></span><br><span class="line">                &#125;</span><br><span class="line">                <span class="string">&quot;Node&quot;</span> &#123;</span><br><span class="line">                    kubectl top nodes</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="string">&quot;Deployment&quot;</span> &#123;</span><br><span class="line">                    kubectl top deployment <span class="literal">-n</span> <span class="variable">$Namespace</span></span><br><span class="line">                &#125;</span><br><span class="line">                default &#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="string">&quot;不支持的资源类型：<span class="variable">$ResourceType</span>&quot;</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="variable">$metrics</span> += [<span class="type">PSCustomObject</span>]<span class="selector-tag">@</span>&#123;</span><br><span class="line">                Time = <span class="variable">$startTime</span></span><br><span class="line">                ResourceType = <span class="variable">$ResourceType</span></span><br><span class="line">                Metrics = <span class="variable">$resourceMetrics</span></span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="variable">$startTime</span> = <span class="variable">$startTime</span>.AddSeconds(<span class="variable">$Interval</span>)</span><br><span class="line">            <span class="built_in">Start-Sleep</span> <span class="literal">-Seconds</span> <span class="variable">$Interval</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> [<span class="type">PSCustomObject</span>]<span class="selector-tag">@</span>&#123;</span><br><span class="line">            Namespace = <span class="variable">$Namespace</span></span><br><span class="line">            ResourceType = <span class="variable">$ResourceType</span></span><br><span class="line">            Duration = <span class="variable">$Duration</span></span><br><span class="line">            Interval = <span class="variable">$Interval</span></span><br><span class="line">            Metrics = <span class="variable">$metrics</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> &#123;</span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">&quot;资源监控失败：<span class="variable">$_</span>&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Kubernetes 问题诊断：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建 Kubernetes 问题诊断函数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Debug-K8sIssues</span></span> &#123;</span><br><span class="line">    <span class="keyword">param</span>(</span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$Namespace</span>,</span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$Pod</span>,</span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$OutputPath</span></span><br><span class="line">    )</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="built_in">Import-Module</span> Kubernetes</span><br><span class="line">        </span><br><span class="line">        <span class="variable">$diagnostics</span> = <span class="selector-tag">@</span>&#123;</span><br><span class="line">            PodStatus = kubectl get pod <span class="variable">$Pod</span> <span class="literal">-n</span> <span class="variable">$Namespace</span> <span class="literal">-o</span> yaml</span><br><span class="line">            PodDescription = kubectl describe pod <span class="variable">$Pod</span> <span class="literal">-n</span> <span class="variable">$Namespace</span></span><br><span class="line">            PodEvents = kubectl get events <span class="literal">-n</span> <span class="variable">$Namespace</span> <span class="literal">--field-selector</span> involvedObject.name=<span class="variable">$Pod</span></span><br><span class="line">            PodLogs = kubectl logs <span class="variable">$Pod</span> <span class="literal">-n</span> <span class="variable">$Namespace</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$OutputPath</span>) &#123;</span><br><span class="line">            <span class="variable">$diagnostics</span> | <span class="built_in">ConvertTo-Json</span> <span class="literal">-Depth</span> <span class="number">10</span> | <span class="built_in">Out-File</span> <span class="literal">-FilePath</span> <span class="variable">$OutputPath</span> <span class="literal">-Encoding</span> UTF8</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> [<span class="type">PSCustomObject</span>]<span class="selector-tag">@</span>&#123;</span><br><span class="line">            Pod = <span class="variable">$Pod</span></span><br><span class="line">            Namespace = <span class="variable">$Namespace</span></span><br><span class="line">            Diagnostics = <span class="variable">$diagnostics</span></span><br><span class="line">            OutputPath = <span class="variable">$OutputPath</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> &#123;</span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">&quot;问题诊断失败：<span class="variable">$_</span>&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这些技巧将帮助您更有效地管理 Kubernetes。记住，在处理 Kubernetes 时，始终要注意安全性和性能。同时，建议使用适当的错误处理和日志记录机制来跟踪所有操作。 </p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2025-02-17T00:00:00.000Z" title="2025/2/17 08:00:00">2025-02-17</time>发表</span><span class="level-item"><time dateTime="2025-03-25T07:49:53.417Z" title="2025/3/25 15:49:53">2025-03-25</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/powershell/">powershell</a><span> / </span><a class="link-muted" href="/categories/powershell/tip/">tip</a></span><span class="level-item">4 分钟读完 (大约614个字)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2025/02/17/powershell-kubernetes-management/">PowerShell 技能连载 - Kubernetes 管理技巧</a></h1><div class="content"><p>在 PowerShell 中管理 Kubernetes 集群是一项重要任务，本文将介绍一些实用的 Kubernetes 管理技巧。</p>
<p>首先，让我们看看基本的 Kubernetes 操作：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建 Kubernetes 集群信息获取函数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Get-K8sClusterInfo</span></span> &#123;</span><br><span class="line">    <span class="keyword">param</span>(</span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$Context</span></span><br><span class="line">    )</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="variable">$kubectl</span> = <span class="string">&quot;kubectl&quot;</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$Context</span>) &#123;</span><br><span class="line">            <span class="variable">$kubectl</span> += <span class="string">&quot; --context=<span class="variable">$Context</span>&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="variable">$nodes</span> = &amp; <span class="variable">$kubectl</span> get nodes <span class="literal">-o</span> json | <span class="built_in">ConvertFrom-Json</span></span><br><span class="line">        <span class="variable">$pods</span> = &amp; <span class="variable">$kubectl</span> get pods <span class="literal">--all-namespaces</span> <span class="literal">-o</span> json | <span class="built_in">ConvertFrom-Json</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> [<span class="type">PSCustomObject</span>]<span class="selector-tag">@</span>&#123;</span><br><span class="line">            NodeCount = <span class="variable">$nodes</span>.items.Count</span><br><span class="line">            PodCount = <span class="variable">$pods</span>.items.Count</span><br><span class="line">            Namespaces = (<span class="variable">$pods</span>.items | <span class="built_in">Select-Object</span> <span class="literal">-ExpandProperty</span> metadata | <span class="built_in">Select-Object</span> <span class="literal">-ExpandProperty</span> namespace <span class="literal">-Unique</span>).Count</span><br><span class="line">            NodeStatus = <span class="variable">$nodes</span>.items | <span class="built_in">ForEach-Object</span> &#123;</span><br><span class="line">                [<span class="type">PSCustomObject</span>]<span class="selector-tag">@</span>&#123;</span><br><span class="line">                    Name = <span class="variable">$_</span>.metadata.name</span><br><span class="line">                    Status = <span class="variable">$_</span>.status.conditions | <span class="built_in">Where-Object</span> &#123; <span class="variable">$_</span>.type <span class="operator">-eq</span> <span class="string">&quot;Ready&quot;</span> &#125; | <span class="built_in">Select-Object</span> <span class="literal">-ExpandProperty</span> status</span><br><span class="line">                    Version = <span class="variable">$_</span>.status.nodeInfo.kubeletVersion</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> &#123;</span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">&quot;获取集群信息失败：<span class="variable">$_</span>&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Kubernetes 资源部署：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建 Kubernetes 资源部署函数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Deploy-K8sResource</span></span> &#123;</span><br><span class="line">    <span class="keyword">param</span>(</span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$ManifestPath</span>,</span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$Namespace</span>,</span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$Context</span>,</span><br><span class="line">        [<span class="type">switch</span>]<span class="variable">$DryRun</span></span><br><span class="line">    )</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="variable">$kubectl</span> = <span class="string">&quot;kubectl&quot;</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$Context</span>) &#123;</span><br><span class="line">            <span class="variable">$kubectl</span> += <span class="string">&quot; --context=<span class="variable">$Context</span>&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$Namespace</span>) &#123;</span><br><span class="line">            <span class="variable">$kubectl</span> += <span class="string">&quot; -n <span class="variable">$Namespace</span>&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$DryRun</span>) &#123;</span><br><span class="line">            <span class="variable">$kubectl</span> += <span class="string">&quot; --dry-run=client&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="variable">$command</span> = <span class="string">&quot;<span class="variable">$kubectl</span> apply -f `&quot;<span class="variable">$ManifestPath</span>`&quot;&quot;</span></span><br><span class="line">        <span class="built_in">Invoke-Expression</span> <span class="variable">$command</span></span><br><span class="line">        </span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">&quot;资源部署完成&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> &#123;</span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">&quot;部署失败：<span class="variable">$_</span>&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Kubernetes 日志收集：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建 Kubernetes 日志收集函数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Get-K8sLogs</span></span> &#123;</span><br><span class="line">    <span class="keyword">param</span>(</span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$PodName</span>,</span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$Namespace</span>,</span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$Container</span>,</span><br><span class="line">        [<span class="built_in">int</span>]<span class="variable">$Lines</span> = <span class="number">100</span>,</span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$Context</span>,</span><br><span class="line">        [<span class="built_in">datetime</span>]<span class="variable">$Since</span></span><br><span class="line">    )</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="variable">$kubectl</span> = <span class="string">&quot;kubectl&quot;</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$Context</span>) &#123;</span><br><span class="line">            <span class="variable">$kubectl</span> += <span class="string">&quot; --context=<span class="variable">$Context</span>&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$Namespace</span>) &#123;</span><br><span class="line">            <span class="variable">$kubectl</span> += <span class="string">&quot; -n <span class="variable">$Namespace</span>&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$Container</span>) &#123;</span><br><span class="line">            <span class="variable">$kubectl</span> += <span class="string">&quot; -c <span class="variable">$Container</span>&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$Since</span>) &#123;</span><br><span class="line">            <span class="variable">$kubectl</span> += <span class="string">&quot; --since=<span class="variable">$</span>(<span class="variable">$Since</span>.ToString(&#x27;yyyy-MM-ddTHH:mm:ssZ&#x27;))&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="variable">$command</span> = <span class="string">&quot;<span class="variable">$kubectl</span> logs <span class="variable">$PodName</span> --tail=<span class="variable">$Lines</span>&quot;</span></span><br><span class="line">        <span class="variable">$logs</span> = <span class="built_in">Invoke-Expression</span> <span class="variable">$command</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> [<span class="type">PSCustomObject</span>]<span class="selector-tag">@</span>&#123;</span><br><span class="line">            PodName = <span class="variable">$PodName</span></span><br><span class="line">            Container = <span class="variable">$Container</span></span><br><span class="line">            Logs = <span class="variable">$logs</span></span><br><span class="line">            Timestamp = <span class="built_in">Get-Date</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> &#123;</span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">&quot;日志收集失败：<span class="variable">$_</span>&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Kubernetes 资源监控：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建 Kubernetes 资源监控函数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Monitor-K8sResources</span></span> &#123;</span><br><span class="line">    <span class="keyword">param</span>(</span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$Namespace</span>,</span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$Context</span>,</span><br><span class="line">        [<span class="built_in">int</span>]<span class="variable">$Interval</span> = <span class="number">60</span>,</span><br><span class="line">        [<span class="built_in">int</span>]<span class="variable">$Duration</span> = <span class="number">3600</span></span><br><span class="line">    )</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="variable">$kubectl</span> = <span class="string">&quot;kubectl&quot;</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$Context</span>) &#123;</span><br><span class="line">            <span class="variable">$kubectl</span> += <span class="string">&quot; --context=<span class="variable">$Context</span>&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$Namespace</span>) &#123;</span><br><span class="line">            <span class="variable">$kubectl</span> += <span class="string">&quot; -n <span class="variable">$Namespace</span>&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="variable">$startTime</span> = <span class="built_in">Get-Date</span></span><br><span class="line">        <span class="variable">$metrics</span> = <span class="selector-tag">@</span>()</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">while</span> ((<span class="built_in">Get-Date</span>) - <span class="variable">$startTime</span>).TotalSeconds <span class="operator">-lt</span> <span class="variable">$Duration</span> &#123;</span><br><span class="line">            <span class="variable">$pods</span> = &amp; <span class="variable">$kubectl</span> get pods <span class="literal">-o</span> json | <span class="built_in">ConvertFrom-Json</span></span><br><span class="line">            <span class="variable">$nodes</span> = &amp; <span class="variable">$kubectl</span> get nodes <span class="literal">-o</span> json | <span class="built_in">ConvertFrom-Json</span></span><br><span class="line">            </span><br><span class="line">            <span class="variable">$metrics</span> += [<span class="type">PSCustomObject</span>]<span class="selector-tag">@</span>&#123;</span><br><span class="line">                Timestamp = <span class="built_in">Get-Date</span></span><br><span class="line">                PodCount = <span class="variable">$pods</span>.items.Count</span><br><span class="line">                NodeCount = <span class="variable">$nodes</span>.items.Count</span><br><span class="line">                PodStatus = <span class="variable">$pods</span>.items | <span class="built_in">Group-Object</span> &#123; <span class="variable">$_</span>.status.phase &#125; | <span class="built_in">ForEach-Object</span> &#123;</span><br><span class="line">                    [<span class="type">PSCustomObject</span>]<span class="selector-tag">@</span>&#123;</span><br><span class="line">                        Status = <span class="variable">$_</span>.Name</span><br><span class="line">                        Count = <span class="variable">$_</span>.Count</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                NodeStatus = <span class="variable">$nodes</span>.items | <span class="built_in">Group-Object</span> &#123; <span class="variable">$_</span>.status.conditions | <span class="built_in">Where-Object</span> &#123; <span class="variable">$_</span>.type <span class="operator">-eq</span> <span class="string">&quot;Ready&quot;</span> &#125; | <span class="built_in">Select-Object</span> <span class="literal">-ExpandProperty</span> status &#125; | <span class="built_in">ForEach-Object</span> &#123;</span><br><span class="line">                    [<span class="type">PSCustomObject</span>]<span class="selector-tag">@</span>&#123;</span><br><span class="line">                        Status = <span class="variable">$_</span>.Name</span><br><span class="line">                        Count = <span class="variable">$_</span>.Count</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="built_in">Start-Sleep</span> <span class="literal">-Seconds</span> <span class="variable">$Interval</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$metrics</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> &#123;</span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">&quot;监控失败：<span class="variable">$_</span>&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Kubernetes 故障排查：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建 Kubernetes 故障排查函数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Debug-K8sIssues</span></span> &#123;</span><br><span class="line">    <span class="keyword">param</span>(</span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$PodName</span>,</span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$Namespace</span>,</span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$Context</span>,</span><br><span class="line">        [<span class="type">switch</span>]<span class="variable">$IncludeEvents</span>,</span><br><span class="line">        [<span class="type">switch</span>]<span class="variable">$IncludeLogs</span></span><br><span class="line">    )</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="variable">$kubectl</span> = <span class="string">&quot;kubectl&quot;</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$Context</span>) &#123;</span><br><span class="line">            <span class="variable">$kubectl</span> += <span class="string">&quot; --context=<span class="variable">$Context</span>&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$Namespace</span>) &#123;</span><br><span class="line">            <span class="variable">$kubectl</span> += <span class="string">&quot; -n <span class="variable">$Namespace</span>&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="variable">$diagnostics</span> = <span class="selector-tag">@</span>&#123;</span><br><span class="line">            PodStatus = &amp; <span class="variable">$kubectl</span> get pod <span class="variable">$PodName</span> <span class="literal">-o</span> json | <span class="built_in">ConvertFrom-Json</span></span><br><span class="line">            PodDescription = &amp; <span class="variable">$kubectl</span> describe pod <span class="variable">$PodName</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$IncludeEvents</span>) &#123;</span><br><span class="line">            <span class="variable">$diagnostics</span>.Events = &amp; <span class="variable">$kubectl</span> get events <span class="literal">--field-selector</span> involvedObject.name=<span class="variable">$PodName</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$IncludeLogs</span>) &#123;</span><br><span class="line">            <span class="variable">$diagnostics</span>.Logs = &amp; <span class="variable">$kubectl</span> logs <span class="variable">$PodName</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> [<span class="type">PSCustomObject</span>]<span class="variable">$diagnostics</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> &#123;</span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">&quot;故障排查失败：<span class="variable">$_</span>&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这些技巧将帮助您更有效地管理 Kubernetes 集群。记住，在处理 Kubernetes 资源时，始终要注意集群的安全性和稳定性。同时，建议在处理大型集群时使用适当的资源限制和监控机制。 </p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2025-02-14T00:00:00.000Z" title="2025/2/14 08:00:00">2025-02-14</time>发表</span><span class="level-item"><time dateTime="2025-03-25T07:49:53.784Z" title="2025/3/25 15:49:53">2025-03-25</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/powershell/">powershell</a><span> / </span><a class="link-muted" href="/categories/powershell/tip/">tip</a></span><span class="level-item">5 分钟读完 (大约783个字)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2025/02/14/powershell-ai-integration/">PowerShell 技能连载 - AI 集成技巧</a></h1><div class="content"><p>在 PowerShell 中集成 AI 功能是一项前沿任务，本文将介绍一些实用的 AI 集成技巧。</p>
<p>首先，让我们看看如何与 OpenAI API 进行交互：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建 OpenAI 交互函数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Invoke-OpenAIAPI</span></span> &#123;</span><br><span class="line">    <span class="keyword">param</span>(</span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$ApiKey</span>,</span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$Prompt</span>,</span><br><span class="line">        [<span class="type">ValidateSet</span>(<span class="string">&#x27;gpt-4&#x27;</span>, <span class="string">&#x27;gpt-3.5-turbo&#x27;</span>)]</span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$Model</span> = <span class="string">&#x27;gpt-3.5-turbo&#x27;</span>,</span><br><span class="line">        [<span class="type">float</span>]<span class="variable">$Temperature</span> = <span class="number">0.7</span>,</span><br><span class="line">        [<span class="built_in">int</span>]<span class="variable">$MaxTokens</span> = <span class="number">500</span></span><br><span class="line">    )</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="variable">$headers</span> = <span class="selector-tag">@</span>&#123;</span><br><span class="line">            <span class="string">&#x27;Content-Type&#x27;</span> = <span class="string">&#x27;application/json&#x27;</span></span><br><span class="line">            <span class="string">&#x27;Authorization&#x27;</span> = <span class="string">&quot;Bearer <span class="variable">$ApiKey</span>&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="variable">$body</span> = <span class="selector-tag">@</span>&#123;</span><br><span class="line">            model = <span class="variable">$Model</span></span><br><span class="line">            messages = <span class="selector-tag">@</span>(</span><br><span class="line">                <span class="selector-tag">@</span>&#123;</span><br><span class="line">                    role = <span class="string">&quot;user&quot;</span></span><br><span class="line">                    content = <span class="variable">$Prompt</span></span><br><span class="line">                &#125;</span><br><span class="line">            )</span><br><span class="line">            temperature = <span class="variable">$Temperature</span></span><br><span class="line">            max_tokens = <span class="variable">$MaxTokens</span></span><br><span class="line">        &#125; | <span class="built_in">ConvertTo-Json</span></span><br><span class="line">        </span><br><span class="line">        <span class="variable">$response</span> = <span class="built_in">Invoke-RestMethod</span> <span class="literal">-Uri</span> <span class="string">&quot;https://api.openai.com/v1/chat/completions&quot;</span> <span class="literal">-Method</span> Post <span class="literal">-Headers</span> <span class="variable">$headers</span> <span class="literal">-Body</span> <span class="variable">$body</span></span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$response</span>.choices[<span class="number">0</span>].message.content</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> &#123;</span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">&quot;OpenAI API 调用失败：<span class="variable">$_</span>&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用 AI 生成 PowerShell 脚本：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建 AI 脚本生成函数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">New-AIScript</span></span> &#123;</span><br><span class="line">    <span class="keyword">param</span>(</span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$ApiKey</span>,</span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$Description</span>,</span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$OutputPath</span></span><br><span class="line">    )</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="variable">$prompt</span> = <span class="string">@&quot;</span></span><br><span class="line"><span class="string">生成一个 PowerShell 脚本，完成以下功能：<span class="variable">$Description</span></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">要求：</span></span><br><span class="line"><span class="string">1. 脚本应包含详细的注释</span></span><br><span class="line"><span class="string">2. 包含适当的错误处理</span></span><br><span class="line"><span class="string">3. 遵循 PowerShell 最佳实践</span></span><br><span class="line"><span class="string">4. 只返回脚本代码，不要额外的解释</span></span><br><span class="line"><span class="string">&quot;@</span></span><br><span class="line">        </span><br><span class="line">        <span class="variable">$script</span> = <span class="built_in">Invoke-OpenAIAPI</span> <span class="literal">-ApiKey</span> <span class="variable">$ApiKey</span> <span class="literal">-Prompt</span> <span class="variable">$prompt</span> <span class="literal">-MaxTokens</span> <span class="number">2000</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$OutputPath</span>) &#123;</span><br><span class="line">            <span class="variable">$script</span> | <span class="built_in">Out-File</span> <span class="literal">-FilePath</span> <span class="variable">$OutputPath</span> <span class="literal">-Encoding</span> UTF8</span><br><span class="line">            <span class="built_in">Write-Host</span> <span class="string">&quot;脚本已保存至：<span class="variable">$OutputPath</span>&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$script</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> &#123;</span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">&quot;AI 脚本生成失败：<span class="variable">$_</span>&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>利用 AI 进行日志分析：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建 AI 日志分析函数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Analyze-LogsWithAI</span></span> &#123;</span><br><span class="line">    <span class="keyword">param</span>(</span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$ApiKey</span>,</span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$LogFilePath</span>,</span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$OutputPath</span>,</span><br><span class="line">        [<span class="type">switch</span>]<span class="variable">$IncludeRecommendations</span></span><br><span class="line">    )</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="variable">$logs</span> = <span class="built_in">Get-Content</span> <span class="literal">-Path</span> <span class="variable">$LogFilePath</span> <span class="literal">-Raw</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 将日志截断到合理的大小</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$logs</span>.Length <span class="operator">-gt</span> <span class="number">4000</span>) &#123;</span><br><span class="line">            <span class="variable">$logs</span> = <span class="variable">$logs</span>.Substring(<span class="number">0</span>, <span class="number">4000</span>) + <span class="string">&quot;... [日志截断]&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="variable">$promptSuffix</span> = <span class="string">&quot;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$IncludeRecommendations</span>) &#123;</span><br><span class="line">            <span class="variable">$promptSuffix</span> = <span class="string">&quot;并提供解决方案建议。&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="variable">$prompt</span> = <span class="string">@&quot;</span></span><br><span class="line"><span class="string">分析以下系统日志，识别可能的错误、警告和问题模式<span class="variable">$promptSuffix</span></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">日志内容：</span></span><br><span class="line"><span class="string"><span class="variable">$logs</span></span></span><br><span class="line"><span class="string">&quot;@</span></span><br><span class="line">        </span><br><span class="line">        <span class="variable">$analysis</span> = <span class="built_in">Invoke-OpenAIAPI</span> <span class="literal">-ApiKey</span> <span class="variable">$ApiKey</span> <span class="literal">-Prompt</span> <span class="variable">$prompt</span> <span class="literal">-MaxTokens</span> <span class="number">1500</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$OutputPath</span>) &#123;</span><br><span class="line">            <span class="variable">$analysis</span> | <span class="built_in">Out-File</span> <span class="literal">-FilePath</span> <span class="variable">$OutputPath</span> <span class="literal">-Encoding</span> UTF8</span><br><span class="line">            <span class="built_in">Write-Host</span> <span class="string">&quot;分析结果已保存至：<span class="variable">$OutputPath</span>&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$analysis</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> &#123;</span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">&quot;AI 日志分析失败：<span class="variable">$_</span>&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>AI 辅助的自动化故障排除：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建 AI 故障排除函数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Start-AITroubleshooting</span></span> &#123;</span><br><span class="line">    <span class="keyword">param</span>(</span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$ApiKey</span>,</span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$Issue</span>,</span><br><span class="line">        [<span class="type">switch</span>]<span class="variable">$RunDiagnostics</span></span><br><span class="line">    )</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="variable">$systemInfo</span> = <span class="built_in">Get-ComputerInfo</span> | <span class="built_in">ConvertTo-Json</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$RunDiagnostics</span>) &#123;</span><br><span class="line">            <span class="variable">$eventLogs</span> = <span class="built_in">Get-WinEvent</span> <span class="literal">-LogName</span> Application <span class="literal">-MaxEvents</span> <span class="number">20</span> | <span class="built_in">Select-Object</span> TimeCreated, LevelDisplayName, Message | <span class="built_in">ConvertTo-Json</span></span><br><span class="line">            <span class="variable">$services</span> = <span class="built_in">Get-Service</span> | <span class="built_in">Where-Object</span> &#123; <span class="variable">$_</span>.Status <span class="operator">-eq</span> <span class="string">&#x27;Stopped&#x27;</span> <span class="operator">-and</span> <span class="variable">$_</span>.StartType <span class="operator">-eq</span> <span class="string">&#x27;Automatic&#x27;</span> &#125; | <span class="built_in">ConvertTo-Json</span></span><br><span class="line">            </span><br><span class="line">            <span class="variable">$diagnosticInfo</span> = <span class="string">@&quot;</span></span><br><span class="line"><span class="string">系统信息：</span></span><br><span class="line"><span class="string"><span class="variable">$systemInfo</span></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">最近事件日志：</span></span><br><span class="line"><span class="string"><span class="variable">$eventLogs</span></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">已停止的自动启动服务：</span></span><br><span class="line"><span class="string"><span class="variable">$services</span></span></span><br><span class="line"><span class="string">&quot;@</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable">$diagnosticInfo</span> = <span class="string">&quot;系统信息：<span class="variable">$systemInfo</span>&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="variable">$prompt</span> = <span class="string">@&quot;</span></span><br><span class="line"><span class="string">我有以下系统问题：<span class="variable">$Issue</span></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">基于以下系统信息，提供排查步骤和可能的解决方案：</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"><span class="variable">$diagnosticInfo</span></span></span><br><span class="line"><span class="string">&quot;@</span></span><br><span class="line">        </span><br><span class="line">        <span class="variable">$troubleshooting</span> = <span class="built_in">Invoke-OpenAIAPI</span> <span class="literal">-ApiKey</span> <span class="variable">$ApiKey</span> <span class="literal">-Prompt</span> <span class="variable">$prompt</span> <span class="literal">-MaxTokens</span> <span class="number">2000</span> <span class="literal">-Model</span> <span class="string">&#x27;gpt-4&#x27;</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$troubleshooting</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> &#123;</span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">&quot;AI 故障排除失败：<span class="variable">$_</span>&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用 AI 优化 PowerShell 脚本性能：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建 AI 脚本优化函数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Optimize-ScriptWithAI</span></span> &#123;</span><br><span class="line">    <span class="keyword">param</span>(</span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$ApiKey</span>,</span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$ScriptPath</span>,</span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$OutputPath</span>,</span><br><span class="line">        [<span class="type">switch</span>]<span class="variable">$IncludeExplanation</span></span><br><span class="line">    )</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="variable">$script</span> = <span class="built_in">Get-Content</span> <span class="literal">-Path</span> <span class="variable">$ScriptPath</span> <span class="literal">-Raw</span></span><br><span class="line">        </span><br><span class="line">        <span class="variable">$promptSuffix</span> = <span class="string">&quot;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$IncludeExplanation</span>) &#123;</span><br><span class="line">            <span class="variable">$promptSuffix</span> = <span class="string">&quot;并解释所做的改动和优化理由。&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="variable">$prompt</span> = <span class="string">@&quot;</span></span><br><span class="line"><span class="string">优化以下 PowerShell 脚本的性能和代码质量<span class="variable">$promptSuffix</span></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">脚本内容：</span></span><br><span class="line"><span class="string"><span class="variable">$script</span></span></span><br><span class="line"><span class="string">&quot;@</span></span><br><span class="line">        </span><br><span class="line">        <span class="variable">$optimizedScript</span> = <span class="built_in">Invoke-OpenAIAPI</span> <span class="literal">-ApiKey</span> <span class="variable">$ApiKey</span> <span class="literal">-Prompt</span> <span class="variable">$prompt</span> <span class="literal">-MaxTokens</span> <span class="number">2000</span> <span class="literal">-Model</span> <span class="string">&#x27;gpt-4&#x27;</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$OutputPath</span>) &#123;</span><br><span class="line">            <span class="variable">$optimizedScript</span> | <span class="built_in">Out-File</span> <span class="literal">-FilePath</span> <span class="variable">$OutputPath</span> <span class="literal">-Encoding</span> UTF8</span><br><span class="line">            <span class="built_in">Write-Host</span> <span class="string">&quot;优化后的脚本已保存至：<span class="variable">$OutputPath</span>&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$optimizedScript</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> &#123;</span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">&quot;AI 脚本优化失败：<span class="variable">$_</span>&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这些技巧将帮助您更有效地在 PowerShell 中集成 AI 功能。记住，在处理 AI 相关任务时，始终要注意 API 密钥的安全性和成本控制。同时，建议使用适当的错误处理和日志记录机制来跟踪所有操作。 </p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2025-02-12T00:00:00.000Z" title="2025/2/12 08:00:00">2025-02-12</time>发表</span><span class="level-item"><time dateTime="2025-03-25T07:49:53.438Z" title="2025/3/25 15:49:53">2025-03-25</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/powershell/">powershell</a><span> / </span><a class="link-muted" href="/categories/powershell/tip/">tip</a></span><span class="level-item">7 分钟读完 (大约992个字)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2025/02/12/powershell-patch-management/">PowerShell 技能连载 - 补丁管理</a></h1><div class="content"><p>在系统管理中，补丁管理对于确保系统安全性和稳定性至关重要。本文将介绍如何使用PowerShell构建一个补丁管理系统，包括补丁扫描、评估和部署等功能。</p>
<h2 id="补丁扫描"><a href="#补丁扫描" class="headerlink" title="补丁扫描"></a>补丁扫描</h2><p>首先，让我们创建一个用于管理补丁扫描的函数：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Scan-SystemPatches</span></span> &#123;</span><br><span class="line">    <span class="function">[<span class="type">CmdletBinding</span>()]</span></span><br><span class="line">    <span class="keyword">param</span>(</span><br><span class="line">        [<span class="type">Parameter</span>(<span class="type">Mandatory</span> = <span class="variable">$true</span>)]</span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$ScanID</span>,</span><br><span class="line">        </span><br><span class="line">        [<span class="type">Parameter</span>()]</span><br><span class="line">        [<span class="built_in">string</span>[]]<span class="variable">$ScanTypes</span>,</span><br><span class="line">        </span><br><span class="line">        [<span class="type">Parameter</span>()]</span><br><span class="line">        [<span class="type">ValidateSet</span>(<span class="string">&quot;Full&quot;</span>, <span class="string">&quot;Quick&quot;</span>, <span class="string">&quot;Custom&quot;</span>)]</span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$ScanMode</span> = <span class="string">&quot;Full&quot;</span>,</span><br><span class="line">        </span><br><span class="line">        [<span class="type">Parameter</span>()]</span><br><span class="line">        [<span class="built_in">hashtable</span>]<span class="variable">$ScanConfig</span>,</span><br><span class="line">        </span><br><span class="line">        [<span class="type">Parameter</span>()]</span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$LogPath</span></span><br><span class="line">    )</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="variable">$scanner</span> = [<span class="type">PSCustomObject</span>]<span class="selector-tag">@</span>&#123;</span><br><span class="line">            ScanID = <span class="variable">$ScanID</span></span><br><span class="line">            StartTime = <span class="built_in">Get-Date</span></span><br><span class="line">            ScanStatus = <span class="selector-tag">@</span>&#123;&#125;</span><br><span class="line">            Patches = <span class="selector-tag">@</span>&#123;&#125;</span><br><span class="line">            Issues = <span class="selector-tag">@</span>()</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 获取扫描配置</span></span><br><span class="line">        <span class="variable">$config</span> = <span class="built_in">Get-ScanConfig</span> <span class="literal">-ScanID</span> <span class="variable">$ScanID</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 管理扫描</span></span><br><span class="line">        <span class="keyword">foreach</span> (<span class="variable">$type</span> <span class="keyword">in</span> <span class="variable">$ScanTypes</span>) &#123;</span><br><span class="line">            <span class="variable">$status</span> = [<span class="type">PSCustomObject</span>]<span class="selector-tag">@</span>&#123;</span><br><span class="line">                <span class="built_in">Type</span> = <span class="variable">$type</span></span><br><span class="line">                Status = <span class="string">&quot;Unknown&quot;</span></span><br><span class="line">                Config = <span class="selector-tag">@</span>&#123;&#125;</span><br><span class="line">                Patches = <span class="selector-tag">@</span>&#123;&#125;</span><br><span class="line">                Issues = <span class="selector-tag">@</span>()</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 应用扫描配置</span></span><br><span class="line">            <span class="variable">$typeConfig</span> = Apply<span class="literal">-ScanConfig</span> `</span><br><span class="line">                <span class="literal">-Config</span> <span class="variable">$config</span> `</span><br><span class="line">                <span class="literal">-Type</span> <span class="variable">$type</span> `</span><br><span class="line">                <span class="literal">-Mode</span> <span class="variable">$ScanMode</span> `</span><br><span class="line">                <span class="literal">-Settings</span> <span class="variable">$ScanConfig</span></span><br><span class="line">            </span><br><span class="line">            <span class="variable">$status</span>.Config = <span class="variable">$typeConfig</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 扫描系统补丁</span></span><br><span class="line">            <span class="variable">$patches</span> = Scan<span class="literal">-PatchData</span> `</span><br><span class="line">                <span class="literal">-Type</span> <span class="variable">$type</span> `</span><br><span class="line">                <span class="literal">-Config</span> <span class="variable">$typeConfig</span></span><br><span class="line">            </span><br><span class="line">            <span class="variable">$status</span>.Patches = <span class="variable">$patches</span></span><br><span class="line">            <span class="variable">$scanner</span>.Patches[<span class="variable">$type</span>] = <span class="variable">$patches</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 检查扫描问题</span></span><br><span class="line">            <span class="variable">$issues</span> = Check<span class="literal">-ScanIssues</span> `</span><br><span class="line">                <span class="literal">-Patches</span> <span class="variable">$patches</span> `</span><br><span class="line">                <span class="literal">-Config</span> <span class="variable">$typeConfig</span></span><br><span class="line">            </span><br><span class="line">            <span class="variable">$status</span>.Issues = <span class="variable">$issues</span></span><br><span class="line">            <span class="variable">$scanner</span>.Issues += <span class="variable">$issues</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 更新扫描状态</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="variable">$issues</span>.Count <span class="operator">-gt</span> <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="variable">$status</span>.Status = <span class="string">&quot;Warning&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="variable">$status</span>.Status = <span class="string">&quot;Success&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="variable">$scanner</span>.ScanStatus[<span class="variable">$type</span>] = <span class="variable">$status</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 记录扫描日志</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$LogPath</span>) &#123;</span><br><span class="line">            <span class="variable">$scanner</span> | <span class="built_in">ConvertTo-Json</span> <span class="literal">-Depth</span> <span class="number">10</span> | <span class="built_in">Out-File</span> <span class="literal">-FilePath</span> <span class="variable">$LogPath</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 更新扫描器状态</span></span><br><span class="line">        <span class="variable">$scanner</span>.EndTime = <span class="built_in">Get-Date</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$scanner</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> &#123;</span><br><span class="line">        <span class="built_in">Write-Error</span> <span class="string">&quot;补丁扫描失败：<span class="variable">$_</span>&quot;</span></span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$null</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="补丁评估"><a href="#补丁评估" class="headerlink" title="补丁评估"></a>补丁评估</h2><p>接下来，创建一个用于管理补丁评估的函数：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Assess-SystemPatches</span></span> &#123;</span><br><span class="line">    <span class="function">[<span class="type">CmdletBinding</span>()]</span></span><br><span class="line">    <span class="keyword">param</span>(</span><br><span class="line">        [<span class="type">Parameter</span>(<span class="type">Mandatory</span> = <span class="variable">$true</span>)]</span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$AssessmentID</span>,</span><br><span class="line">        </span><br><span class="line">        [<span class="type">Parameter</span>()]</span><br><span class="line">        [<span class="built_in">string</span>[]]<span class="variable">$AssessmentTypes</span>,</span><br><span class="line">        </span><br><span class="line">        [<span class="type">Parameter</span>()]</span><br><span class="line">        [<span class="type">ValidateSet</span>(<span class="string">&quot;Security&quot;</span>, <span class="string">&quot;Compatibility&quot;</span>, <span class="string">&quot;Dependency&quot;</span>)]</span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$AssessmentMode</span> = <span class="string">&quot;Security&quot;</span>,</span><br><span class="line">        </span><br><span class="line">        [<span class="type">Parameter</span>()]</span><br><span class="line">        [<span class="built_in">hashtable</span>]<span class="variable">$AssessmentConfig</span>,</span><br><span class="line">        </span><br><span class="line">        [<span class="type">Parameter</span>()]</span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$ReportPath</span></span><br><span class="line">    )</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="variable">$assessor</span> = [<span class="type">PSCustomObject</span>]<span class="selector-tag">@</span>&#123;</span><br><span class="line">            AssessmentID = <span class="variable">$AssessmentID</span></span><br><span class="line">            StartTime = <span class="built_in">Get-Date</span></span><br><span class="line">            AssessmentStatus = <span class="selector-tag">@</span>&#123;&#125;</span><br><span class="line">            Assessment = <span class="selector-tag">@</span>&#123;&#125;</span><br><span class="line">            Findings = <span class="selector-tag">@</span>()</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 获取评估配置</span></span><br><span class="line">        <span class="variable">$config</span> = <span class="built_in">Get-AssessmentConfig</span> <span class="literal">-AssessmentID</span> <span class="variable">$AssessmentID</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 管理评估</span></span><br><span class="line">        <span class="keyword">foreach</span> (<span class="variable">$type</span> <span class="keyword">in</span> <span class="variable">$AssessmentTypes</span>) &#123;</span><br><span class="line">            <span class="variable">$status</span> = [<span class="type">PSCustomObject</span>]<span class="selector-tag">@</span>&#123;</span><br><span class="line">                <span class="built_in">Type</span> = <span class="variable">$type</span></span><br><span class="line">                Status = <span class="string">&quot;Unknown&quot;</span></span><br><span class="line">                Config = <span class="selector-tag">@</span>&#123;&#125;</span><br><span class="line">                Assessment = <span class="selector-tag">@</span>&#123;&#125;</span><br><span class="line">                Findings = <span class="selector-tag">@</span>()</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 应用评估配置</span></span><br><span class="line">            <span class="variable">$typeConfig</span> = Apply<span class="literal">-AssessmentConfig</span> `</span><br><span class="line">                <span class="literal">-Config</span> <span class="variable">$config</span> `</span><br><span class="line">                <span class="literal">-Type</span> <span class="variable">$type</span> `</span><br><span class="line">                <span class="literal">-Mode</span> <span class="variable">$AssessmentMode</span> `</span><br><span class="line">                <span class="literal">-Settings</span> <span class="variable">$AssessmentConfig</span></span><br><span class="line">            </span><br><span class="line">            <span class="variable">$status</span>.Config = <span class="variable">$typeConfig</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 评估系统补丁</span></span><br><span class="line">            <span class="variable">$assessment</span> = Assess<span class="literal">-PatchData</span> `</span><br><span class="line">                <span class="literal">-Type</span> <span class="variable">$type</span> `</span><br><span class="line">                <span class="literal">-Config</span> <span class="variable">$typeConfig</span></span><br><span class="line">            </span><br><span class="line">            <span class="variable">$status</span>.Assessment = <span class="variable">$assessment</span></span><br><span class="line">            <span class="variable">$assessor</span>.Assessment[<span class="variable">$type</span>] = <span class="variable">$assessment</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 生成评估结果</span></span><br><span class="line">            <span class="variable">$findings</span> = Generate<span class="literal">-AssessmentFindings</span> `</span><br><span class="line">                <span class="literal">-Assessment</span> <span class="variable">$assessment</span> `</span><br><span class="line">                <span class="literal">-Config</span> <span class="variable">$typeConfig</span></span><br><span class="line">            </span><br><span class="line">            <span class="variable">$status</span>.Findings = <span class="variable">$findings</span></span><br><span class="line">            <span class="variable">$assessor</span>.Findings += <span class="variable">$findings</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 更新评估状态</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="variable">$findings</span>.Count <span class="operator">-gt</span> <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="variable">$status</span>.Status = <span class="string">&quot;High&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="variable">$status</span>.Status = <span class="string">&quot;Low&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="variable">$assessor</span>.AssessmentStatus[<span class="variable">$type</span>] = <span class="variable">$status</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 生成报告</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$ReportPath</span>) &#123;</span><br><span class="line">            <span class="variable">$report</span> = Generate<span class="literal">-AssessmentReport</span> `</span><br><span class="line">                <span class="literal">-Assessor</span> <span class="variable">$assessor</span> `</span><br><span class="line">                <span class="literal">-Config</span> <span class="variable">$config</span></span><br><span class="line">            </span><br><span class="line">            <span class="variable">$report</span> | <span class="built_in">ConvertTo-Json</span> <span class="literal">-Depth</span> <span class="number">10</span> | <span class="built_in">Out-File</span> <span class="literal">-FilePath</span> <span class="variable">$ReportPath</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 更新评估器状态</span></span><br><span class="line">        <span class="variable">$assessor</span>.EndTime = <span class="built_in">Get-Date</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$assessor</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> &#123;</span><br><span class="line">        <span class="built_in">Write-Error</span> <span class="string">&quot;补丁评估失败：<span class="variable">$_</span>&quot;</span></span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$null</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="补丁部署"><a href="#补丁部署" class="headerlink" title="补丁部署"></a>补丁部署</h2><p>最后，创建一个用于管理补丁部署的函数：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Deploy-SystemPatches</span></span> &#123;</span><br><span class="line">    <span class="function">[<span class="type">CmdletBinding</span>()]</span></span><br><span class="line">    <span class="keyword">param</span>(</span><br><span class="line">        [<span class="type">Parameter</span>(<span class="type">Mandatory</span> = <span class="variable">$true</span>)]</span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$DeploymentID</span>,</span><br><span class="line">        </span><br><span class="line">        [<span class="type">Parameter</span>()]</span><br><span class="line">        [<span class="built_in">string</span>[]]<span class="variable">$DeploymentTypes</span>,</span><br><span class="line">        </span><br><span class="line">        [<span class="type">Parameter</span>()]</span><br><span class="line">        [<span class="type">ValidateSet</span>(<span class="string">&quot;Automatic&quot;</span>, <span class="string">&quot;Manual&quot;</span>, <span class="string">&quot;Scheduled&quot;</span>)]</span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$DeploymentMode</span> = <span class="string">&quot;Automatic&quot;</span>,</span><br><span class="line">        </span><br><span class="line">        [<span class="type">Parameter</span>()]</span><br><span class="line">        [<span class="built_in">hashtable</span>]<span class="variable">$DeploymentConfig</span>,</span><br><span class="line">        </span><br><span class="line">        [<span class="type">Parameter</span>()]</span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$ReportPath</span></span><br><span class="line">    )</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="variable">$deployer</span> = [<span class="type">PSCustomObject</span>]<span class="selector-tag">@</span>&#123;</span><br><span class="line">            DeploymentID = <span class="variable">$DeploymentID</span></span><br><span class="line">            StartTime = <span class="built_in">Get-Date</span></span><br><span class="line">            DeploymentStatus = <span class="selector-tag">@</span>&#123;&#125;</span><br><span class="line">            Deployment = <span class="selector-tag">@</span>&#123;&#125;</span><br><span class="line">            Results = <span class="selector-tag">@</span>()</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 获取部署配置</span></span><br><span class="line">        <span class="variable">$config</span> = <span class="built_in">Get-DeploymentConfig</span> <span class="literal">-DeploymentID</span> <span class="variable">$DeploymentID</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 管理部署</span></span><br><span class="line">        <span class="keyword">foreach</span> (<span class="variable">$type</span> <span class="keyword">in</span> <span class="variable">$DeploymentTypes</span>) &#123;</span><br><span class="line">            <span class="variable">$status</span> = [<span class="type">PSCustomObject</span>]<span class="selector-tag">@</span>&#123;</span><br><span class="line">                <span class="built_in">Type</span> = <span class="variable">$type</span></span><br><span class="line">                Status = <span class="string">&quot;Unknown&quot;</span></span><br><span class="line">                Config = <span class="selector-tag">@</span>&#123;&#125;</span><br><span class="line">                Deployment = <span class="selector-tag">@</span>&#123;&#125;</span><br><span class="line">                Results = <span class="selector-tag">@</span>()</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 应用部署配置</span></span><br><span class="line">            <span class="variable">$typeConfig</span> = Apply<span class="literal">-DeploymentConfig</span> `</span><br><span class="line">                <span class="literal">-Config</span> <span class="variable">$config</span> `</span><br><span class="line">                <span class="literal">-Type</span> <span class="variable">$type</span> `</span><br><span class="line">                <span class="literal">-Mode</span> <span class="variable">$DeploymentMode</span> `</span><br><span class="line">                <span class="literal">-Settings</span> <span class="variable">$DeploymentConfig</span></span><br><span class="line">            </span><br><span class="line">            <span class="variable">$status</span>.Config = <span class="variable">$typeConfig</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 部署系统补丁</span></span><br><span class="line">            <span class="variable">$deployment</span> = <span class="built_in">Deploy-PatchData</span> `</span><br><span class="line">                <span class="literal">-Type</span> <span class="variable">$type</span> `</span><br><span class="line">                <span class="literal">-Config</span> <span class="variable">$typeConfig</span></span><br><span class="line">            </span><br><span class="line">            <span class="variable">$status</span>.Deployment = <span class="variable">$deployment</span></span><br><span class="line">            <span class="variable">$deployer</span>.Deployment[<span class="variable">$type</span>] = <span class="variable">$deployment</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 生成部署结果</span></span><br><span class="line">            <span class="variable">$results</span> = Generate<span class="literal">-DeploymentResults</span> `</span><br><span class="line">                <span class="literal">-Deployment</span> <span class="variable">$deployment</span> `</span><br><span class="line">                <span class="literal">-Config</span> <span class="variable">$typeConfig</span></span><br><span class="line">            </span><br><span class="line">            <span class="variable">$status</span>.Results = <span class="variable">$results</span></span><br><span class="line">            <span class="variable">$deployer</span>.Results += <span class="variable">$results</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 更新部署状态</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="variable">$results</span>.Count <span class="operator">-gt</span> <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="variable">$status</span>.Status = <span class="string">&quot;Success&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="variable">$status</span>.Status = <span class="string">&quot;Failed&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="variable">$deployer</span>.DeploymentStatus[<span class="variable">$type</span>] = <span class="variable">$status</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 生成报告</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$ReportPath</span>) &#123;</span><br><span class="line">            <span class="variable">$report</span> = Generate<span class="literal">-DeploymentReport</span> `</span><br><span class="line">                <span class="literal">-Deployer</span> <span class="variable">$deployer</span> `</span><br><span class="line">                <span class="literal">-Config</span> <span class="variable">$config</span></span><br><span class="line">            </span><br><span class="line">            <span class="variable">$report</span> | <span class="built_in">ConvertTo-Json</span> <span class="literal">-Depth</span> <span class="number">10</span> | <span class="built_in">Out-File</span> <span class="literal">-FilePath</span> <span class="variable">$ReportPath</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 更新部署器状态</span></span><br><span class="line">        <span class="variable">$deployer</span>.EndTime = <span class="built_in">Get-Date</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$deployer</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> &#123;</span><br><span class="line">        <span class="built_in">Write-Error</span> <span class="string">&quot;补丁部署失败：<span class="variable">$_</span>&quot;</span></span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$null</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="使用示例"><a href="#使用示例" class="headerlink" title="使用示例"></a>使用示例</h2><p>以下是如何使用这些函数来管理补丁的示例：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 扫描系统补丁</span></span><br><span class="line"><span class="variable">$scanner</span> = Scan<span class="literal">-SystemPatches</span> <span class="literal">-ScanID</span> <span class="string">&quot;SCAN001&quot;</span> `</span><br><span class="line">    <span class="literal">-ScanTypes</span> <span class="selector-tag">@</span>(<span class="string">&quot;Security&quot;</span>, <span class="string">&quot;Critical&quot;</span>, <span class="string">&quot;Optional&quot;</span>, <span class="string">&quot;Driver&quot;</span>) `</span><br><span class="line">    <span class="literal">-ScanMode</span> <span class="string">&quot;Full&quot;</span> `</span><br><span class="line">    <span class="literal">-ScanConfig</span> <span class="selector-tag">@</span>&#123;</span><br><span class="line">        <span class="string">&quot;Security&quot;</span> = <span class="selector-tag">@</span>&#123;</span><br><span class="line">            <span class="string">&quot;Source&quot;</span> = <span class="selector-tag">@</span>(<span class="string">&quot;Windows Update&quot;</span>, <span class="string">&quot;WSUS&quot;</span>, <span class="string">&quot;SCCM&quot;</span>)</span><br><span class="line">            <span class="string">&quot;Filter&quot;</span> = <span class="string">&quot;Severity = Critical&quot;</span></span><br><span class="line">            <span class="string">&quot;Report&quot;</span> = <span class="variable">$true</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="string">&quot;Critical&quot;</span> = <span class="selector-tag">@</span>&#123;</span><br><span class="line">            <span class="string">&quot;Source&quot;</span> = <span class="selector-tag">@</span>(<span class="string">&quot;Windows Update&quot;</span>, <span class="string">&quot;WSUS&quot;</span>, <span class="string">&quot;SCCM&quot;</span>)</span><br><span class="line">            <span class="string">&quot;Filter&quot;</span> = <span class="string">&quot;Type = Critical&quot;</span></span><br><span class="line">            <span class="string">&quot;Report&quot;</span> = <span class="variable">$true</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="string">&quot;Optional&quot;</span> = <span class="selector-tag">@</span>&#123;</span><br><span class="line">            <span class="string">&quot;Source&quot;</span> = <span class="selector-tag">@</span>(<span class="string">&quot;Windows Update&quot;</span>, <span class="string">&quot;WSUS&quot;</span>, <span class="string">&quot;SCCM&quot;</span>)</span><br><span class="line">            <span class="string">&quot;Filter&quot;</span> = <span class="string">&quot;Type = Optional&quot;</span></span><br><span class="line">            <span class="string">&quot;Report&quot;</span> = <span class="variable">$true</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="string">&quot;Driver&quot;</span> = <span class="selector-tag">@</span>&#123;</span><br><span class="line">            <span class="string">&quot;Source&quot;</span> = <span class="selector-tag">@</span>(<span class="string">&quot;Windows Update&quot;</span>, <span class="string">&quot;WSUS&quot;</span>, <span class="string">&quot;SCCM&quot;</span>)</span><br><span class="line">            <span class="string">&quot;Filter&quot;</span> = <span class="string">&quot;Type = Driver&quot;</span></span><br><span class="line">            <span class="string">&quot;Report&quot;</span> = <span class="variable">$true</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125; `</span><br><span class="line">    <span class="literal">-LogPath</span> <span class="string">&quot;C:\Logs\patch_scan.json&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 评估系统补丁</span></span><br><span class="line"><span class="variable">$assessor</span> = Assess<span class="literal">-SystemPatches</span> <span class="literal">-AssessmentID</span> <span class="string">&quot;ASSESSMENT001&quot;</span> `</span><br><span class="line">    <span class="literal">-AssessmentTypes</span> <span class="selector-tag">@</span>(<span class="string">&quot;Security&quot;</span>, <span class="string">&quot;Critical&quot;</span>, <span class="string">&quot;Optional&quot;</span>, <span class="string">&quot;Driver&quot;</span>) `</span><br><span class="line">    <span class="literal">-AssessmentMode</span> <span class="string">&quot;Security&quot;</span> `</span><br><span class="line">    <span class="literal">-AssessmentConfig</span> <span class="selector-tag">@</span>&#123;</span><br><span class="line">        <span class="string">&quot;Security&quot;</span> = <span class="selector-tag">@</span>&#123;</span><br><span class="line">            <span class="string">&quot;Impact&quot;</span> = <span class="selector-tag">@</span>(<span class="string">&quot;Vulnerability&quot;</span>, <span class="string">&quot;Compliance&quot;</span>, <span class="string">&quot;Risk&quot;</span>)</span><br><span class="line">            <span class="string">&quot;Priority&quot;</span> = <span class="string">&quot;High&quot;</span></span><br><span class="line">            <span class="string">&quot;Report&quot;</span> = <span class="variable">$true</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="string">&quot;Critical&quot;</span> = <span class="selector-tag">@</span>&#123;</span><br><span class="line">            <span class="string">&quot;Impact&quot;</span> = <span class="selector-tag">@</span>(<span class="string">&quot;Vulnerability&quot;</span>, <span class="string">&quot;Compliance&quot;</span>, <span class="string">&quot;Risk&quot;</span>)</span><br><span class="line">            <span class="string">&quot;Priority&quot;</span> = <span class="string">&quot;High&quot;</span></span><br><span class="line">            <span class="string">&quot;Report&quot;</span> = <span class="variable">$true</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="string">&quot;Optional&quot;</span> = <span class="selector-tag">@</span>&#123;</span><br><span class="line">            <span class="string">&quot;Impact&quot;</span> = <span class="selector-tag">@</span>(<span class="string">&quot;Vulnerability&quot;</span>, <span class="string">&quot;Compliance&quot;</span>, <span class="string">&quot;Risk&quot;</span>)</span><br><span class="line">            <span class="string">&quot;Priority&quot;</span> = <span class="string">&quot;Medium&quot;</span></span><br><span class="line">            <span class="string">&quot;Report&quot;</span> = <span class="variable">$true</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="string">&quot;Driver&quot;</span> = <span class="selector-tag">@</span>&#123;</span><br><span class="line">            <span class="string">&quot;Impact&quot;</span> = <span class="selector-tag">@</span>(<span class="string">&quot;Vulnerability&quot;</span>, <span class="string">&quot;Compliance&quot;</span>, <span class="string">&quot;Risk&quot;</span>)</span><br><span class="line">            <span class="string">&quot;Priority&quot;</span> = <span class="string">&quot;Low&quot;</span></span><br><span class="line">            <span class="string">&quot;Report&quot;</span> = <span class="variable">$true</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125; `</span><br><span class="line">    <span class="literal">-ReportPath</span> <span class="string">&quot;C:\Reports\patch_assessment.json&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 部署系统补丁</span></span><br><span class="line"><span class="variable">$deployer</span> = <span class="built_in">Deploy-SystemPatches</span> <span class="literal">-DeploymentID</span> <span class="string">&quot;DEPLOYMENT001&quot;</span> `</span><br><span class="line">    <span class="literal">-DeploymentTypes</span> <span class="selector-tag">@</span>(<span class="string">&quot;Security&quot;</span>, <span class="string">&quot;Critical&quot;</span>, <span class="string">&quot;Optional&quot;</span>, <span class="string">&quot;Driver&quot;</span>) `</span><br><span class="line">    <span class="literal">-DeploymentMode</span> <span class="string">&quot;Automatic&quot;</span> `</span><br><span class="line">    <span class="literal">-DeploymentConfig</span> <span class="selector-tag">@</span>&#123;</span><br><span class="line">        <span class="string">&quot;Security&quot;</span> = <span class="selector-tag">@</span>&#123;</span><br><span class="line">            <span class="string">&quot;Method&quot;</span> = <span class="selector-tag">@</span>(<span class="string">&quot;Download&quot;</span>, <span class="string">&quot;Install&quot;</span>, <span class="string">&quot;Verify&quot;</span>)</span><br><span class="line">            <span class="string">&quot;Schedule&quot;</span> = <span class="string">&quot;Immediate&quot;</span></span><br><span class="line">            <span class="string">&quot;Timeout&quot;</span> = <span class="number">120</span></span><br><span class="line">            <span class="string">&quot;Report&quot;</span> = <span class="variable">$true</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="string">&quot;Critical&quot;</span> = <span class="selector-tag">@</span>&#123;</span><br><span class="line">            <span class="string">&quot;Method&quot;</span> = <span class="selector-tag">@</span>(<span class="string">&quot;Download&quot;</span>, <span class="string">&quot;Install&quot;</span>, <span class="string">&quot;Verify&quot;</span>)</span><br><span class="line">            <span class="string">&quot;Schedule&quot;</span> = <span class="string">&quot;Immediate&quot;</span></span><br><span class="line">            <span class="string">&quot;Timeout&quot;</span> = <span class="number">120</span></span><br><span class="line">            <span class="string">&quot;Report&quot;</span> = <span class="variable">$true</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="string">&quot;Optional&quot;</span> = <span class="selector-tag">@</span>&#123;</span><br><span class="line">            <span class="string">&quot;Method&quot;</span> = <span class="selector-tag">@</span>(<span class="string">&quot;Download&quot;</span>, <span class="string">&quot;Install&quot;</span>, <span class="string">&quot;Verify&quot;</span>)</span><br><span class="line">            <span class="string">&quot;Schedule&quot;</span> = <span class="string">&quot;OffHours&quot;</span></span><br><span class="line">            <span class="string">&quot;Timeout&quot;</span> = <span class="number">120</span></span><br><span class="line">            <span class="string">&quot;Report&quot;</span> = <span class="variable">$true</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="string">&quot;Driver&quot;</span> = <span class="selector-tag">@</span>&#123;</span><br><span class="line">            <span class="string">&quot;Method&quot;</span> = <span class="selector-tag">@</span>(<span class="string">&quot;Download&quot;</span>, <span class="string">&quot;Install&quot;</span>, <span class="string">&quot;Verify&quot;</span>)</span><br><span class="line">            <span class="string">&quot;Schedule&quot;</span> = <span class="string">&quot;OffHours&quot;</span></span><br><span class="line">            <span class="string">&quot;Timeout&quot;</span> = <span class="number">120</span></span><br><span class="line">            <span class="string">&quot;Report&quot;</span> = <span class="variable">$true</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125; `</span><br><span class="line">    <span class="literal">-ReportPath</span> <span class="string">&quot;C:\Reports\patch_deployment.json&quot;</span></span><br></pre></td></tr></table></figure>

<h2 id="最佳实践"><a href="#最佳实践" class="headerlink" title="最佳实践"></a>最佳实践</h2><ol>
<li>实施补丁扫描</li>
<li>评估补丁影响</li>
<li>管理补丁部署</li>
<li>保持详细的补丁记录</li>
<li>定期进行补丁审查</li>
<li>实施回滚策略</li>
<li>建立补丁控制</li>
<li>保持系统文档更新</li>
</ol>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2025-02-11T00:00:00.000Z" title="2025/2/11 08:00:00">2025-02-11</time>发表</span><span class="level-item"><time dateTime="2025-03-25T07:49:53.580Z" title="2025/3/25 15:49:53">2025-03-25</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/powershell/">powershell</a><span> / </span><a class="link-muted" href="/categories/powershell/tip/">tip</a></span><span class="level-item">1 分钟读完 (大约177个字)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2025/02/11/powershell-regex-application/">PowerShell 技能连载 - 正则表达式实战</a></h1><div class="content"><h2 id="正则表达式基础"><a href="#正则表达式基础" class="headerlink" title="正则表达式基础"></a>正则表达式基础</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 邮箱验证模式</span></span><br><span class="line"><span class="variable">$emailPattern</span> = <span class="string">&#x27;^[\w-]+(\.[\w-]+)*@([\w-]+\.)+[a-zA-Z]&#123;2,7&#125;$&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 匹配操作</span></span><br><span class="line"><span class="keyword">if</span> (<span class="string">&#x27;user@domain.com&#x27;</span> <span class="operator">-match</span> <span class="variable">$emailPattern</span>) &#123;</span><br><span class="line">    <span class="built_in">Write-Output</span> <span class="string">&quot;有效邮箱地址&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="高级应用场景"><a href="#高级应用场景" class="headerlink" title="高级应用场景"></a>高级应用场景</h2><ol>
<li><p><strong>批量重命名文件</strong>：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Get-ChildItem</span> *.log | </span><br><span class="line"><span class="built_in">Rename-Item</span> <span class="literal">-NewName</span> &#123; <span class="variable">$_</span>.Name <span class="operator">-replace</span> <span class="string">&#x27;_\d&#123;8&#125;_&#x27;</span>,<span class="string">&#x27;_$(Get-Date -f yyyyMMdd)_&#x27;</span> &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>日志分析提取</strong>：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Select-String</span> <span class="literal">-Path</span> *.log <span class="literal">-Pattern</span> <span class="string">&#x27;ERROR (\w+): (.+)&#x27;</span> | </span><br><span class="line"><span class="built_in">ForEach-Object</span> &#123;</span><br><span class="line">    [<span class="type">PSCustomObject</span>]<span class="selector-tag">@</span>&#123;</span><br><span class="line">        Code = <span class="variable">$_</span>.Matches.Groups[<span class="number">1</span>].Value</span><br><span class="line">        Message = <span class="variable">$_</span>.Matches.Groups[<span class="number">2</span>].Value</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="最佳实践"><a href="#最佳实践" class="headerlink" title="最佳实践"></a>最佳实践</h2><ol>
<li><p>使用命名捕获组增强可读性：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$logEntry</span> = <span class="string">&#x27;2024-04-22 14:35 [WARN] Disk space below 10%&#x27;</span></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$logEntry</span> <span class="operator">-match</span> <span class="string">&#x27;(?&lt;Date&gt;\d&#123;4&#125;-\d&#123;2&#125;-\d&#123;2&#125;).+\[(?&lt;Level&gt;\w+)\] (?&lt;Message&gt;.+)&#x27;</span>) &#123;</span><br><span class="line">    <span class="variable">$matches</span>[<span class="string">&#x27;Level&#x27;</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>预编译常用模式提升性能：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$ipPattern</span> = [<span class="type">regex</span>]::new(<span class="string">&#x27;^\d&#123;1,3&#125;(\.\d&#123;1,3&#125;)&#123;3&#125;$&#x27;</span>)</span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$ipPattern</span>.IsMatch(<span class="string">&#x27;192.168.1.1&#x27;</span>)) &#123;</span><br><span class="line">    <span class="comment"># IP地址验证逻辑</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>多行模式处理复杂文本：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$multiLineText</span> = <span class="built_in">Get-Content</span> <span class="literal">-Raw</span> data.txt</span><br><span class="line"><span class="variable">$matches</span> = <span class="variable">$multiLineText</span> | <span class="built_in">Select-String</span> <span class="literal">-Pattern</span> <span class="string">&#x27;(?s)&lt;start&gt;(.*?)&lt;end&gt;&#x27;</span></span><br></pre></td></tr></table></figure></li>
</ol>
</div></article></div><nav class="pagination" role="navigation" aria-label="pagination"><div class="pagination-previous"><a href="/tags/series/">上一页</a></div><div class="pagination-next"><a href="/tags/series/page/3/">下一页</a></div><ul class="pagination-list is-hidden-mobile"><li><a class="pagination-link" href="/tags/series/">1</a></li><li><a class="pagination-link is-current" href="/tags/series/page/2/">2</a></li><li><a class="pagination-link" href="/tags/series/page/3/">3</a></li><li><span class="pagination-ellipsis">&hellip;</span></li><li><a class="pagination-link" href="/tags/series/page/199/">199</a></li></ul></nav></div><div class="column column-left is-4-tablet is-4-desktop is-4-widescreen  order-1 is-sticky"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar" src="https://www.gravatar.com/avatar/2dd950aaf78f980772660e4a37eb409c?s=128" alt="吴波"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">吴波</p><p class="is-size-6 is-block">Full Stack Developer</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>Fuzhou, China</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">文章</p><a href="/archives"><p class="title">2193</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">分类</p><a href="/categories"><p class="title">63</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">标签</p><a href="/tags"><p class="title">207</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/victorwoo" target="_blank" rel="noopener">关注我</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/victorwoo"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Facebook" href="https://www.facebook.com/vichampcn"><i class="fab fa-facebook"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Twitter" href="https://twitter.com/victorwoo"><i class="fab fa-twitter"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Dribbble" href="https://dribbble.com"><i class="fab fa-dribbble"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="RSS" href="/atom.xml"><i class="fas fa-rss"></i></a></div></div></div><!--!--><div class="card widget" data-type="links"><div class="card-content"><div class="menu"><h3 class="menu-label">链接</h3><ul class="menu-list"><li><a class="level is-mobile" href="https://github.com/PowerShell/PowerShell" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">PowerShell</span></span><span class="level-right"><span class="level-item tag">github.com</span></span></a></li><li><a class="level is-mobile" href="https://learn.microsoft.com/zh-cn/powershell/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">PowerShell 文档</span></span><span class="level-right"><span class="level-item tag">learn.microsoft.com</span></span></a></li><li><a class="level is-mobile" href="https://www.powershellgallery.com/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">PowerShell Gallery</span></span><span class="level-right"><span class="level-item tag">www.powershellgallery.com</span></span></a></li></ul></div></div></div><div class="card widget" data-type="categories"><div class="card-content"><div class="menu"><h3 class="menu-label">分类</h3><ul class="menu-list"><li><a class="level is-mobile" href="/categories/C/"><span class="level-start"><span class="level-item">C#</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/angularjs/"><span class="level-start"><span class="level-item">angularjs</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/career/"><span class="level-start"><span class="level-item">career</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/design/"><span class="level-start"><span class="level-item">design</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/embedded/"><span class="level-start"><span class="level-item">embedded</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/geek/"><span class="level-start"><span class="level-item">geek</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/git/"><span class="level-start"><span class="level-item">git</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/ionic/"><span class="level-start"><span class="level-item">ionic</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/javascript/"><span class="level-start"><span class="level-item">javascript</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li><li><a class="level is-mobile" href="/categories/markdown/"><span class="level-start"><span class="level-item">markdown</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/mongoose/"><span class="level-start"><span class="level-item">mongoose</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/mvp/"><span class="level-start"><span class="level-item">mvp</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/network/"><span class="level-start"><span class="level-item">network</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/node-js/"><span class="level-start"><span class="level-item">node.js</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/nodejs/"><span class="level-start"><span class="level-item">nodejs</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/powershell/"><span class="level-start"><span class="level-item">powershell</span></span><span class="level-end"><span class="level-item tag">2153</span></span></a><ul><li><a class="level is-mobile" href="/categories/powershell/advanced-scripting/"><span class="level-start"><span class="level-item">advanced-scripting</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/powershell/ai/"><span class="level-start"><span class="level-item">ai</span></span><span class="level-end"><span class="level-item tag">7</span></span></a><ul><li><a class="level is-mobile" href="/categories/powershell/ai/automation/"><span class="level-start"><span class="level-item">automation</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/powershell/automation/"><span class="level-start"><span class="level-item">automation</span></span><span class="level-end"><span class="level-item tag">1</span></span></a><ul><li><a class="level is-mobile" href="/categories/powershell/automation/ai/"><span class="level-start"><span class="level-item">ai</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/powershell/azure/"><span class="level-start"><span class="level-item">azure</span></span><span class="level-end"><span class="level-item tag">2</span></span></a><ul><li><a class="level is-mobile" href="/categories/powershell/azure/devops/"><span class="level-start"><span class="level-item">devops</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/powershell/azure/security/"><span class="level-start"><span class="level-item">security</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/powershell/basic/"><span class="level-start"><span class="level-item">basic</span></span><span class="level-end"><span class="level-item tag">28</span></span></a></li><li><a class="level is-mobile" href="/categories/powershell/blockchain/"><span class="level-start"><span class="level-item">blockchain</span></span><span class="level-end"><span class="level-item tag">1</span></span></a><ul><li><a class="level is-mobile" href="/categories/powershell/blockchain/automation/"><span class="level-start"><span class="level-item">automation</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/powershell/cloud/"><span class="level-start"><span class="level-item">cloud</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li><li><a class="level is-mobile" href="/categories/powershell/core-mechanism/"><span class="level-start"><span class="level-item">core-mechanism</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/powershell/cross-platform/"><span class="level-start"><span class="level-item">cross-platform</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/powershell/data/"><span class="level-start"><span class="level-item">data</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/powershell/data-processing/"><span class="level-start"><span class="level-item">data-processing</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/powershell/debugging/"><span class="level-start"><span class="level-item">debugging</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/powershell/development/"><span class="level-start"><span class="level-item">development</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/powershell/devops/"><span class="level-start"><span class="level-item">devops</span></span><span class="level-end"><span class="level-item tag">4</span></span></a><ul><li><a class="level is-mobile" href="/categories/powershell/devops/kubernetes/"><span class="level-start"><span class="level-item">kubernetes</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/powershell/emerging-tech/"><span class="level-start"><span class="level-item">emerging-tech</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/powershell/energy/"><span class="level-start"><span class="level-item">energy</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/powershell/geek/"><span class="level-start"><span class="level-item">geek</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/powershell/iot/"><span class="level-start"><span class="level-item">iot</span></span><span class="level-end"><span class="level-item tag">2</span></span></a><ul><li><a class="level is-mobile" href="/categories/powershell/iot/automation/"><span class="level-start"><span class="level-item">automation</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/powershell/module-system/"><span class="level-start"><span class="level-item">module-system</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/powershell/office/"><span class="level-start"><span class="level-item">office</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li><li><a class="level is-mobile" href="/categories/powershell/office365/"><span class="level-start"><span class="level-item">office365</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/powershell/performance/"><span class="level-start"><span class="level-item">performance</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/powershell/remote-scripting/"><span class="level-start"><span class="level-item">remote-scripting</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/powershell/scripting/"><span class="level-start"><span class="level-item">scripting</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li><li><a class="level is-mobile" href="/categories/powershell/security/"><span class="level-start"><span class="level-item">security</span></span><span class="level-end"><span class="level-item tag">13</span></span></a><ul><li><a class="level is-mobile" href="/categories/powershell/security/automation/"><span class="level-start"><span class="level-item">automation</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/powershell/security/azure/"><span class="level-start"><span class="level-item">azure</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/powershell/security/devops/"><span class="level-start"><span class="level-item">devops</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/powershell/system/"><span class="level-start"><span class="level-item">system</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/powershell/system-administration/"><span class="level-start"><span class="level-item">system-administration</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/powershell/text/"><span class="level-start"><span class="level-item">text</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li><li><a class="level is-mobile" href="/categories/powershell/tip/"><span class="level-start"><span class="level-item">tip</span></span><span class="level-end"><span class="level-item tag">1980</span></span></a></li><li><a class="level is-mobile" href="/categories/powershell/web-services/"><span class="level-start"><span class="level-item">web-services</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/program/"><span class="level-start"><span class="level-item">program</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/server/"><span class="level-start"><span class="level-item">server</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/software-engineering/"><span class="level-start"><span class="level-item">software-engineering</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/text/"><span class="level-start"><span class="level-item">text</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/vim/"><span class="level-start"><span class="level-item">vim</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/visualstudio/"><span class="level-start"><span class="level-item">visualstudio</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/web/"><span class="level-start"><span class="level-item">web</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li></ul></div></div></div><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">最新文章</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2025-03-25T16:00:00.000Z">2025-03-26</time></p><p class="title"><a href="/2025/03/26/blog-index/">PowerShell 博客文章汇总 (2024-04 ~ 2025-03)</a></p><p class="categories"><a href="/categories/powershell/">powershell</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2025-03-25T00:00:00.000Z">2025-03-25</time></p><p class="title"><a href="/2025/03/25/powershell-image-processing/">PowerShell 技能连载 - 图像处理技巧</a></p><p class="categories"><a href="/categories/powershell/">powershell</a> / <a href="/categories/powershell/tip/">tip</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2025-03-24T00:00:00.000Z">2025-03-24</time></p><p class="title"><a href="/2025/03/24/powershell-pipeline-filtering/">PowerShell管道过滤机制实战解析</a></p><p class="categories"><a href="/categories/powershell/">powershell</a> / <a href="/categories/powershell/basic/">basic</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2025-03-21T00:00:00.000Z">2025-03-21</time></p><p class="title"><a href="/2025/03/21/powershell-education-device-sync/">PowerShell 技能连载 - 教育设备同步系统</a></p><p class="categories"><a href="/categories/powershell/">powershell</a> / <a href="/categories/powershell/tip/">tip</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2025-03-20T00:00:00.000Z">2025-03-20</time></p><p class="title"><a href="/2025/03/20/powershell-network-operations/">PowerShell 技能连载 - 网络操作技巧</a></p><p class="categories"><a href="/categories/powershell/">powershell</a> / <a href="/categories/powershell/tip/">tip</a></p></div></article></div></div><div class="card widget" data-type="archives"><div class="card-content"><div class="menu"><h3 class="menu-label">归档</h3><ul class="menu-list"><li><a class="level is-mobile" href="/archives/2025/03/"><span class="level-start"><span class="level-item">三月 2025</span></span><span class="level-end"><span class="level-item tag">16</span></span></a></li><li><a class="level is-mobile" href="/archives/2025/02/"><span class="level-start"><span class="level-item">二月 2025</span></span><span class="level-end"><span class="level-item tag">20</span></span></a></li><li><a class="level is-mobile" href="/archives/2025/01/"><span class="level-start"><span class="level-item">一月 2025</span></span><span class="level-end"><span class="level-item tag">21</span></span></a></li><li><a class="level is-mobile" href="/archives/2024/12/"><span class="level-start"><span class="level-item">十二月 2024</span></span><span class="level-end"><span class="level-item tag">20</span></span></a></li><li><a class="level is-mobile" href="/archives/2024/11/"><span class="level-start"><span class="level-item">十一月 2024</span></span><span class="level-end"><span class="level-item tag">17</span></span></a></li><li><a class="level is-mobile" href="/archives/2024/10/"><span class="level-start"><span class="level-item">十月 2024</span></span><span class="level-end"><span class="level-item tag">20</span></span></a></li><li><a class="level is-mobile" href="/archives/2024/09/"><span class="level-start"><span class="level-item">九月 2024</span></span><span class="level-end"><span class="level-item tag">21</span></span></a></li><li><a class="level is-mobile" href="/archives/2024/08/"><span class="level-start"><span class="level-item">八月 2024</span></span><span class="level-end"><span class="level-item tag">19</span></span></a></li><li><a class="level is-mobile" href="/archives/2024/07/"><span class="level-start"><span class="level-item">七月 2024</span></span><span class="level-end"><span class="level-item tag">18</span></span></a></li><li><a class="level is-mobile" href="/archives/2024/06/"><span class="level-start"><span class="level-item">六月 2024</span></span><span class="level-end"><span class="level-item tag">17</span></span></a></li><li><a class="level is-mobile" href="/archives/2024/05/"><span class="level-start"><span class="level-item">五月 2024</span></span><span class="level-end"><span class="level-item tag">23</span></span></a></li><li><a class="level is-mobile" href="/archives/2024/04/"><span class="level-start"><span class="level-item">四月 2024</span></span><span class="level-end"><span class="level-item tag">25</span></span></a></li><li><a class="level is-mobile" href="/archives/2024/03/"><span class="level-start"><span class="level-item">三月 2024</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li><li><a class="level is-mobile" href="/archives/2024/02/"><span class="level-start"><span class="level-item">二月 2024</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2024/01/"><span class="level-start"><span class="level-item">一月 2024</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/11/"><span class="level-start"><span class="level-item">十一月 2023</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/10/"><span class="level-start"><span class="level-item">十月 2023</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/08/"><span class="level-start"><span class="level-item">八月 2023</span></span><span class="level-end"><span class="level-item tag">8</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/07/"><span class="level-start"><span class="level-item">七月 2023</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/06/"><span class="level-start"><span class="level-item">六月 2023</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/05/"><span class="level-start"><span class="level-item">五月 2023</span></span><span class="level-end"><span class="level-item tag">14</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/04/"><span class="level-start"><span class="level-item">四月 2023</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/03/"><span class="level-start"><span class="level-item">三月 2023</span></span><span class="level-end"><span class="level-item tag">9</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/02/"><span class="level-start"><span class="level-item">二月 2023</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/01/"><span class="level-start"><span class="level-item">一月 2023</span></span><span class="level-end"><span class="level-item tag">12</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/11/"><span class="level-start"><span class="level-item">十一月 2022</span></span><span class="level-end"><span class="level-item tag">8</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/10/"><span class="level-start"><span class="level-item">十月 2022</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/09/"><span class="level-start"><span class="level-item">九月 2022</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/08/"><span class="level-start"><span class="level-item">八月 2022</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/07/"><span class="level-start"><span class="level-item">七月 2022</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/06/"><span class="level-start"><span class="level-item">六月 2022</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/05/"><span class="level-start"><span class="level-item">五月 2022</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/04/"><span class="level-start"><span class="level-item">四月 2022</span></span><span class="level-end"><span class="level-item tag">10</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/03/"><span class="level-start"><span class="level-item">三月 2022</span></span><span class="level-end"><span class="level-item tag">16</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/02/"><span class="level-start"><span class="level-item">二月 2022</span></span><span class="level-end"><span class="level-item tag">10</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/01/"><span class="level-start"><span class="level-item">一月 2022</span></span><span class="level-end"><span class="level-item tag">10</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/12/"><span class="level-start"><span class="level-item">十二月 2021</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/11/"><span class="level-start"><span class="level-item">十一月 2021</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/10/"><span class="level-start"><span class="level-item">十月 2021</span></span><span class="level-end"><span class="level-item tag">10</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/09/"><span class="level-start"><span class="level-item">九月 2021</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/08/"><span class="level-start"><span class="level-item">八月 2021</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/07/"><span class="level-start"><span class="level-item">七月 2021</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/06/"><span class="level-start"><span class="level-item">六月 2021</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/05/"><span class="level-start"><span class="level-item">五月 2021</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/04/"><span class="level-start"><span class="level-item">四月 2021</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/03/"><span class="level-start"><span class="level-item">三月 2021</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/02/"><span class="level-start"><span class="level-item">二月 2021</span></span><span class="level-end"><span class="level-item tag">10</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/01/"><span class="level-start"><span class="level-item">一月 2021</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/12/"><span class="level-start"><span class="level-item">十二月 2020</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/11/"><span class="level-start"><span class="level-item">十一月 2020</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/10/"><span class="level-start"><span class="level-item">十月 2020</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/09/"><span class="level-start"><span class="level-item">九月 2020</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/08/"><span class="level-start"><span class="level-item">八月 2020</span></span><span class="level-end"><span class="level-item tag">10</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/07/"><span class="level-start"><span class="level-item">七月 2020</span></span><span class="level-end"><span class="level-item tag">12</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/06/"><span class="level-start"><span class="level-item">六月 2020</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/05/"><span class="level-start"><span class="level-item">五月 2020</span></span><span class="level-end"><span class="level-item tag">10</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/04/"><span class="level-start"><span class="level-item">四月 2020</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/03/"><span class="level-start"><span class="level-item">三月 2020</span></span><span class="level-end"><span class="level-item tag">12</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/02/"><span class="level-start"><span class="level-item">二月 2020</span></span><span class="level-end"><span class="level-item tag">10</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/01/"><span class="level-start"><span class="level-item">一月 2020</span></span><span class="level-end"><span class="level-item tag">12</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/12/"><span class="level-start"><span class="level-item">十二月 2019</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/11/"><span class="level-start"><span class="level-item">十一月 2019</span></span><span class="level-end"><span class="level-item tag">10</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/10/"><span class="level-start"><span class="level-item">十月 2019</span></span><span class="level-end"><span class="level-item tag">12</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/09/"><span class="level-start"><span class="level-item">九月 2019</span></span><span class="level-end"><span class="level-item tag">10</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/08/"><span class="level-start"><span class="level-item">八月 2019</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/07/"><span class="level-start"><span class="level-item">七月 2019</span></span><span class="level-end"><span class="level-item tag">12</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/06/"><span class="level-start"><span class="level-item">六月 2019</span></span><span class="level-end"><span class="level-item tag">20</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/05/"><span class="level-start"><span class="level-item">五月 2019</span></span><span class="level-end"><span class="level-item tag">23</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/04/"><span class="level-start"><span class="level-item">四月 2019</span></span><span class="level-end"><span class="level-item tag">22</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/03/"><span class="level-start"><span class="level-item">三月 2019</span></span><span class="level-end"><span class="level-item tag">22</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/02/"><span class="level-start"><span class="level-item">二月 2019</span></span><span class="level-end"><span class="level-item tag">20</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/01/"><span class="level-start"><span class="level-item">一月 2019</span></span><span class="level-end"><span class="level-item tag">23</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/12/"><span class="level-start"><span class="level-item">十二月 2018</span></span><span class="level-end"><span class="level-item tag">21</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/11/"><span class="level-start"><span class="level-item">十一月 2018</span></span><span class="level-end"><span class="level-item tag">22</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/10/"><span class="level-start"><span class="level-item">十月 2018</span></span><span class="level-end"><span class="level-item tag">23</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/09/"><span class="level-start"><span class="level-item">九月 2018</span></span><span class="level-end"><span class="level-item tag">20</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/08/"><span class="level-start"><span class="level-item">八月 2018</span></span><span class="level-end"><span class="level-item tag">23</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/07/"><span class="level-start"><span class="level-item">七月 2018</span></span><span class="level-end"><span class="level-item tag">22</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/06/"><span class="level-start"><span class="level-item">六月 2018</span></span><span class="level-end"><span class="level-item tag">21</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/05/"><span class="level-start"><span class="level-item">五月 2018</span></span><span class="level-end"><span class="level-item tag">23</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/04/"><span class="level-start"><span class="level-item">四月 2018</span></span><span class="level-end"><span class="level-item tag">21</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/03/"><span class="level-start"><span class="level-item">三月 2018</span></span><span class="level-end"><span class="level-item tag">22</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/02/"><span class="level-start"><span class="level-item">二月 2018</span></span><span class="level-end"><span class="level-item tag">20</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/01/"><span class="level-start"><span class="level-item">一月 2018</span></span><span class="level-end"><span class="level-item tag">23</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/12/"><span class="level-start"><span class="level-item">十二月 2017</span></span><span class="level-end"><span class="level-item tag">21</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/11/"><span class="level-start"><span class="level-item">十一月 2017</span></span><span class="level-end"><span class="level-item tag">22</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/10/"><span class="level-start"><span class="level-item">十月 2017</span></span><span class="level-end"><span class="level-item tag">22</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/09/"><span class="level-start"><span class="level-item">九月 2017</span></span><span class="level-end"><span class="level-item tag">21</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/08/"><span class="level-start"><span class="level-item">八月 2017</span></span><span class="level-end"><span class="level-item tag">23</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/07/"><span class="level-start"><span class="level-item">七月 2017</span></span><span class="level-end"><span class="level-item tag">21</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/06/"><span class="level-start"><span class="level-item">六月 2017</span></span><span class="level-end"><span class="level-item tag">26</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/05/"><span class="level-start"><span class="level-item">五月 2017</span></span><span class="level-end"><span class="level-item tag">23</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/04/"><span class="level-start"><span class="level-item">四月 2017</span></span><span class="level-end"><span class="level-item tag">20</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/03/"><span class="level-start"><span class="level-item">三月 2017</span></span><span class="level-end"><span class="level-item tag">23</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/02/"><span class="level-start"><span class="level-item">二月 2017</span></span><span class="level-end"><span class="level-item tag">20</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/01/"><span class="level-start"><span class="level-item">一月 2017</span></span><span class="level-end"><span class="level-item tag">22</span></span></a></li><li><a class="level is-mobile" href="/archives/2016/12/"><span class="level-start"><span class="level-item">十二月 2016</span></span><span class="level-end"><span class="level-item tag">24</span></span></a></li><li><a class="level is-mobile" href="/archives/2016/11/"><span class="level-start"><span class="level-item">十一月 2016</span></span><span class="level-end"><span class="level-item tag">22</span></span></a></li><li><a class="level is-mobile" href="/archives/2016/10/"><span class="level-start"><span class="level-item">十月 2016</span></span><span class="level-end"><span class="level-item tag">21</span></span></a></li><li><a class="level is-mobile" href="/archives/2016/09/"><span class="level-start"><span class="level-item">九月 2016</span></span><span class="level-end"><span class="level-item tag">22</span></span></a></li><li><a class="level is-mobile" href="/archives/2016/08/"><span class="level-start"><span class="level-item">八月 2016</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2016/02/"><span class="level-start"><span class="level-item">二月 2016</span></span><span class="level-end"><span class="level-item tag">16</span></span></a></li><li><a class="level is-mobile" href="/archives/2016/01/"><span class="level-start"><span class="level-item">一月 2016</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li><li><a class="level is-mobile" href="/archives/2015/12/"><span class="level-start"><span class="level-item">十二月 2015</span></span><span class="level-end"><span class="level-item tag">8</span></span></a></li><li><a class="level is-mobile" href="/archives/2015/11/"><span class="level-start"><span class="level-item">十一月 2015</span></span><span class="level-end"><span class="level-item tag">15</span></span></a></li><li><a class="level is-mobile" href="/archives/2015/10/"><span class="level-start"><span class="level-item">十月 2015</span></span><span class="level-end"><span class="level-item tag">22</span></span></a></li><li><a class="level is-mobile" href="/archives/2015/09/"><span class="level-start"><span class="level-item">九月 2015</span></span><span class="level-end"><span class="level-item tag">25</span></span></a></li><li><a class="level is-mobile" href="/archives/2015/08/"><span class="level-start"><span class="level-item">八月 2015</span></span><span class="level-end"><span class="level-item tag">22</span></span></a></li><li><a class="level is-mobile" href="/archives/2015/07/"><span class="level-start"><span class="level-item">七月 2015</span></span><span class="level-end"><span class="level-item tag">24</span></span></a></li><li><a class="level is-mobile" href="/archives/2015/06/"><span class="level-start"><span class="level-item">六月 2015</span></span><span class="level-end"><span class="level-item tag">22</span></span></a></li><li><a class="level is-mobile" href="/archives/2015/05/"><span class="level-start"><span class="level-item">五月 2015</span></span><span class="level-end"><span class="level-item tag">21</span></span></a></li><li><a class="level is-mobile" href="/archives/2015/04/"><span class="level-start"><span class="level-item">四月 2015</span></span><span class="level-end"><span class="level-item tag">23</span></span></a></li><li><a class="level is-mobile" href="/archives/2015/03/"><span class="level-start"><span class="level-item">三月 2015</span></span><span class="level-end"><span class="level-item tag">24</span></span></a></li><li><a class="level is-mobile" href="/archives/2015/02/"><span class="level-start"><span class="level-item">二月 2015</span></span><span class="level-end"><span class="level-item tag">23</span></span></a></li><li><a class="level is-mobile" href="/archives/2015/01/"><span class="level-start"><span class="level-item">一月 2015</span></span><span class="level-end"><span class="level-item tag">28</span></span></a></li><li><a class="level is-mobile" href="/archives/2014/12/"><span class="level-start"><span class="level-item">十二月 2014</span></span><span class="level-end"><span class="level-item tag">23</span></span></a></li><li><a class="level is-mobile" href="/archives/2014/11/"><span class="level-start"><span class="level-item">十一月 2014</span></span><span class="level-end"><span class="level-item tag">14</span></span></a></li><li><a class="level is-mobile" href="/archives/2014/10/"><span class="level-start"><span class="level-item">十月 2014</span></span><span class="level-end"><span class="level-item tag">26</span></span></a></li><li><a class="level is-mobile" href="/archives/2014/09/"><span class="level-start"><span class="level-item">九月 2014</span></span><span class="level-end"><span class="level-item tag">26</span></span></a></li><li><a class="level is-mobile" href="/archives/2014/08/"><span class="level-start"><span class="level-item">八月 2014</span></span><span class="level-end"><span class="level-item tag">39</span></span></a></li><li><a class="level is-mobile" href="/archives/2014/07/"><span class="level-start"><span class="level-item">七月 2014</span></span><span class="level-end"><span class="level-item tag">26</span></span></a></li><li><a class="level is-mobile" href="/archives/2014/06/"><span class="level-start"><span class="level-item">六月 2014</span></span><span class="level-end"><span class="level-item tag">23</span></span></a></li><li><a class="level is-mobile" href="/archives/2014/05/"><span class="level-start"><span class="level-item">五月 2014</span></span><span class="level-end"><span class="level-item tag">23</span></span></a></li><li><a class="level is-mobile" href="/archives/2014/04/"><span class="level-start"><span class="level-item">四月 2014</span></span><span class="level-end"><span class="level-item tag">23</span></span></a></li><li><a class="level is-mobile" href="/archives/2014/03/"><span class="level-start"><span class="level-item">三月 2014</span></span><span class="level-end"><span class="level-item tag">22</span></span></a></li><li><a class="level is-mobile" href="/archives/2014/02/"><span class="level-start"><span class="level-item">二月 2014</span></span><span class="level-end"><span class="level-item tag">23</span></span></a></li><li><a class="level is-mobile" href="/archives/2014/01/"><span class="level-start"><span class="level-item">一月 2014</span></span><span class="level-end"><span class="level-item tag">29</span></span></a></li><li><a class="level is-mobile" href="/archives/2013/12/"><span class="level-start"><span class="level-item">十二月 2013</span></span><span class="level-end"><span class="level-item tag">23</span></span></a></li><li><a class="level is-mobile" href="/archives/2013/11/"><span class="level-start"><span class="level-item">十一月 2013</span></span><span class="level-end"><span class="level-item tag">30</span></span></a></li><li><a class="level is-mobile" href="/archives/2013/10/"><span class="level-start"><span class="level-item">十月 2013</span></span><span class="level-end"><span class="level-item tag">29</span></span></a></li><li><a class="level is-mobile" href="/archives/2013/09/"><span class="level-start"><span class="level-item">九月 2013</span></span><span class="level-end"><span class="level-item tag">30</span></span></a></li><li><a class="level is-mobile" href="/archives/2013/08/"><span class="level-start"><span class="level-item">八月 2013</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2013/06/"><span class="level-start"><span class="level-item">六月 2013</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2013/05/"><span class="level-start"><span class="level-item">五月 2013</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2013/03/"><span class="level-start"><span class="level-item">三月 2013</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2012/04/"><span class="level-start"><span class="level-item">四月 2012</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></div></div></div><div class="card widget" data-type="tags"><div class="card-content"><div class="menu"><h3 class="menu-label">标签</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/net/"><span class="tag">.net</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/0day/"><span class="tag">0day</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/C/"><span class="tag">C#</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/QQ/"><span class="tag">QQ</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/acl/"><span class="tag">acl</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ad/"><span class="tag">ad</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ai/"><span class="tag">ai</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ai-optimization/"><span class="tag">ai-optimization</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/angularjs/"><span class="tag">angularjs</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/animation/"><span class="tag">animation</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/apache/"><span class="tag">apache</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/appz/"><span class="tag">appz</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/asciiart/"><span class="tag">asciiart</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/att-ck/"><span class="tag">att&amp;ck</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/automation/"><span class="tag">automation</span><span class="tag">23</span></a></div><div class="control"><a class="tags has-addons" href="/tags/azure/"><span class="tag">azure</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/azure-ad/"><span class="tag">azure-ad</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/azure-functions/"><span class="tag">azure-functions</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/azuread/"><span class="tag">azuread</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/backup/"><span class="tag">backup</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/batch/"><span class="tag">batch</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/bestpractice/"><span class="tag">bestpractice</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/block/"><span class="tag">block</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/blog/"><span class="tag">blog</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/book/"><span class="tag">book</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/breakpoint/"><span class="tag">breakpoint</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/bug/"><span class="tag">bug</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/c/"><span class="tag">c#</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/career/"><span class="tag">career</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/cdn/"><span class="tag">cdn</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/cheatsheet/"><span class="tag">cheatsheet</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/cloud/"><span class="tag">cloud</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/cmd/"><span class="tag">cmd</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/cmdlet/"><span class="tag">cmdlet</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/code-generation/"><span class="tag">code-generation</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/command/"><span class="tag">command</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/community/"><span class="tag">community</span><span class="tag">6</span></a></div><div class="control"><a class="tags has-addons" href="/tags/compliance/"><span class="tag">compliance</span><span class="tag">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/computervision/"><span class="tag">computervision</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/conditional-compilation/"><span class="tag">conditional-compilation</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/container/"><span class="tag">container</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/cost-optimization/"><span class="tag">cost-optimization</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/csharp/"><span class="tag">csharp</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/css/"><span class="tag">css</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/data-structure/"><span class="tag">data-structure</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/data-structures/"><span class="tag">data-structures</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/database/"><span class="tag">database</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/datacenter/"><span class="tag">datacenter</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ddns/"><span class="tag">ddns</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/debugging/"><span class="tag">debugging</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/delicious/"><span class="tag">delicious</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/develop/"><span class="tag">develop</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/device-compliance/"><span class="tag">device-compliance</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/device-health/"><span class="tag">device-health</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/device-management/"><span class="tag">device-management</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/device-monitoring/"><span class="tag">device-monitoring</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/devops/"><span class="tag">devops</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/devsecops/"><span class="tag">devsecops</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/digital-assets/"><span class="tag">digital-assets</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/docker/"><span class="tag">docker</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/dos/"><span class="tag">dos</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/download/"><span class="tag">download</span><span class="tag">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/drone/"><span class="tag">drone</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/dsc/"><span class="tag">dsc</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/dynamic-loading/"><span class="tag">dynamic-loading</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ebook/"><span class="tag">ebook</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ed2k/"><span class="tag">ed2k</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/edge-computing/"><span class="tag">edge-computing</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/embedded/"><span class="tag">embedded</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/encoding/"><span class="tag">encoding</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/energy-optimization/"><span class="tag">energy-optimization</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/error-handling/"><span class="tag">error-handling</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ethereum/"><span class="tag">ethereum</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/excel/"><span class="tag">excel</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/extension/"><span class="tag">extension</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/filesystem-abstraction/"><span class="tag">filesystem-abstraction</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/flow-control/"><span class="tag">flow-control</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/front-end/"><span class="tag">front-end</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/function/"><span class="tag">function</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/functions/"><span class="tag">functions</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/gallery/"><span class="tag">gallery</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/geek/"><span class="tag">geek</span><span class="tag">30</span></a></div><div class="control"><a class="tags has-addons" href="/tags/git/"><span class="tag">git</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/green-computing/"><span class="tag">green-computing</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/gtd/"><span class="tag">gtd</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/guide/"><span class="tag">guide</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/guideline/"><span class="tag">guideline</span><span class="tag">11</span></a></div><div class="control"><a class="tags has-addons" href="/tags/gvim/"><span class="tag">gvim</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/hashtable/"><span class="tag">hashtable</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/healthcheck/"><span class="tag">healthcheck</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/hexo/"><span class="tag">hexo</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/html/"><span class="tag">html</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/hybrid-cloud/"><span class="tag">hybrid-cloud</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/iac/"><span class="tag">iac</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/icon/"><span class="tag">icon</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ics/"><span class="tag">ics</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ide/"><span class="tag">ide</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/industrial-iot/"><span class="tag">industrial-iot</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ionic/"><span class="tag">ionic</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ip/"><span class="tag">ip</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/iso/"><span class="tag">iso</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/javascript/"><span class="tag">javascript</span><span class="tag">7</span></a></div><div class="control"><a class="tags has-addons" href="/tags/jea/"><span class="tag">jea</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/kubernetes/"><span class="tag">kubernetes</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/language/"><span class="tag">language</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/lateral-movement/"><span class="tag">lateral-movement</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/learning/"><span class="tag">learning</span><span class="tag">6</span></a></div><div class="control"><a class="tags has-addons" href="/tags/lesson/"><span class="tag">lesson</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/link/"><span class="tag">link</span><span class="tag">6</span></a></div><div class="control"><a class="tags has-addons" href="/tags/linux/"><span class="tag">linux</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/log-analysis/"><span class="tag">log-analysis</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/loganalysis/"><span class="tag">loganalysis</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/machine-learning/"><span class="tag">machine-learning</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/markdown/"><span class="tag">markdown</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/metaprogramming/"><span class="tag">metaprogramming</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/metaverse/"><span class="tag">metaverse</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/microsoft/"><span class="tag">microsoft</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/microsoft-graph/"><span class="tag">microsoft-graph</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/module/"><span class="tag">module</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/mongodb/"><span class="tag">mongodb</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/mongoose/"><span class="tag">mongoose</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/monthly/"><span class="tag">monthly</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/mqtt/"><span class="tag">mqtt</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/multi-cloud/"><span class="tag">multi-cloud</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/multicloud/"><span class="tag">multicloud</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/multithreading/"><span class="tag">multithreading</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/mvp/"><span class="tag">mvp</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/natural-language-processing/"><span class="tag">natural-language-processing</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/nlp/"><span class="tag">nlp</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/node-js/"><span class="tag">node.js</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/nodejs/"><span class="tag">nodejs</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/nosql/"><span class="tag">nosql</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/oauth2/"><span class="tag">oauth2</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/openai/"><span class="tag">openai</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/optimization/"><span class="tag">optimization</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/oray/"><span class="tag">oray</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/packaging/"><span class="tag">packaging</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/parameters/"><span class="tag">parameters</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/path-handling/"><span class="tag">path-handling</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/picture/"><span class="tag">picture</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/policies/"><span class="tag">policies</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/powershell/"><span class="tag">powershell</span><span class="tag">2080</span></a></div><div class="control"><a class="tags has-addons" href="/tags/powertip/"><span class="tag">powertip</span><span class="tag">1985</span></a></div><div class="control"><a class="tags has-addons" href="/tags/predictive-maintenance/"><span class="tag">predictive-maintenance</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/preface/"><span class="tag">preface</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/privilege-escalation/"><span class="tag">privilege-escalation</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/process-analysis/"><span class="tag">process-analysis</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/productivity/"><span class="tag">productivity</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/proxy/"><span class="tag">proxy</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/psprovider/"><span class="tag">psprovider</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/qq/"><span class="tag">qq</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/red-team/"><span class="tag">red-team</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/reflection/"><span class="tag">reflection</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/regex/"><span class="tag">regex</span><span class="tag">6</span></a></div><div class="control"><a class="tags has-addons" href="/tags/registry/"><span class="tag">registry</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/release/"><span class="tag">release</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/remoting/"><span class="tag">remoting</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/repack/"><span class="tag">repack</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/resource/"><span class="tag">resource</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/resource-orchestration/"><span class="tag">resource-orchestration</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/rest-api/"><span class="tag">rest-api</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/role-capability/"><span class="tag">role-capability</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/runspacepool/"><span class="tag">runspacepool</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/scm/"><span class="tag">scm</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/scope/"><span class="tag">scope</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/script/"><span class="tag">script</span><span class="tag">25</span></a></div><div class="control"><a class="tags has-addons" href="/tags/security/"><span class="tag">security</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/security-monitoring/"><span class="tag">security-monitoring</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/series/"><span class="tag">series</span><span class="tag">1985</span></a></div><div class="control"><a class="tags has-addons" href="/tags/server/"><span class="tag">server</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/serverless/"><span class="tag">serverless</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/skill/"><span class="tag">skill</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/smart-contract/"><span class="tag">smart-contract</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/software/"><span class="tag">software</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/sp1/"><span class="tag">sp1</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/stacktrace/"><span class="tag">stacktrace</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/study/"><span class="tag">study</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/style/"><span class="tag">style</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/supply-chain/"><span class="tag">supply-chain</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/supplychain/"><span class="tag">supplychain</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/switch/"><span class="tag">switch</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/terraform/"><span class="tag">terraform</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/text/"><span class="tag">text</span><span class="tag">9</span></a></div><div class="control"><a class="tags has-addons" href="/tags/text-processing/"><span class="tag">text-processing</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/threat-hunting/"><span class="tag">threat-hunting</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/tip/"><span class="tag">tip</span><span class="tag">1984</span></a></div><div class="control"><a class="tags has-addons" href="/tags/tip%E4%B8%AA/"><span class="tag">tip个</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/tool/"><span class="tag">tool</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/uac/"><span class="tag">uac</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/unmanaged-code/"><span class="tag">unmanaged-code</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/update/"><span class="tag">update</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/variable/"><span class="tag">variable</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/variables/"><span class="tag">variables</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/video/"><span class="tag">video</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/vim/"><span class="tag">vim</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/virtual-environment/"><span class="tag">virtual-environment</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/visualstudio/"><span class="tag">visualstudio</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/vmware/"><span class="tag">vmware</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/vulnerability/"><span class="tag">vulnerability</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/web/"><span class="tag">web</span><span class="tag">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/web3/"><span class="tag">web3</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/window/"><span class="tag">window</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/windows/"><span class="tag">windows</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/xampp/"><span class="tag">xampp</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/xml/"><span class="tag">xml</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/zero-trust/"><span class="tag">zero-trust</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/zerotrust/"><span class="tag">zerotrust</span><span class="tag">2</span></a></div></div></div></div></div><div class="card widget" data-type="subscribe-email"><div class="card-content"><div class="menu"><h3 class="menu-label">订阅更新</h3><form action="https://feedburner.google.com/fb/a/mailverify" method="post" target="popupwindow" onsubmit="window.open(&#039;https://feedburner.google.com/fb/a/mailverify?uri=&#039;,&#039;popupwindow&#039;,&#039;scrollbars=yes,width=550,height=520&#039;);return true"><input type="hidden" value="" name="uri"><input type="hidden" name="loc" value="en_US"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button" type="submit" value="订阅"></div></div></form></div></div></div></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/logo.svg" alt="叹为观止" height="28"></a><p class="is-size-7"><span>&copy; 2025 吴波</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("zh-CN");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "此网站使用Cookie来改善您的体验。",
          dismiss: "知道了！",
          allow: "允许使用Cookie",
          deny: "拒绝",
          link: "了解更多",
          policy: "Cookie政策",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="想要查找什么..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"想要查找什么...","untitled":"(无标题)","posts":"文章","pages":"页面","categories":"分类","tags":"标签"});
        });</script></body></html>