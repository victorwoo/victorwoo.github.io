<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="robots" content="noindex"><meta><title>分类: powershell - 叹为观止</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="叹为观止"><meta name="msapplication-TileImage" content="/img/favicon.svg"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="叹为观止"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="PowerShell, 中文博客, 互联网, 效率党, 同步控, 工程师, 脚本爱好者, 崇尚优雅的程序设计"><meta property="og:type" content="blog"><meta property="og:title" content="叹为观止"><meta property="og:url" content="http://blog.vichamp.com/"><meta property="og:site_name" content="叹为观止"><meta property="og:description" content="PowerShell, 中文博客, 互联网, 效率党, 同步控, 工程师, 脚本爱好者, 崇尚优雅的程序设计"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="http://blog.vichamp.com/img/og_image.png"><meta property="article:author" content="Victor Woo"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="http://blog.vichamp.com/img/og_image.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://blog.vichamp.com"},"headline":"叹为观止","image":["http://blog.vichamp.com/img/og_image.png"],"author":{"@type":"Person","name":"Victor Woo"},"publisher":{"@type":"Organization","name":"叹为观止","logo":{"@type":"ImageObject","url":"http://blog.vichamp.com/img/logo.svg"}},"description":"PowerShell, 中文博客, 互联网, 效率党, 同步控, 工程师, 脚本爱好者, 崇尚优雅的程序设计"}</script><link rel="icon" href="/img/favicon.svg"><link rel="stylesheet" href="https://at.alicdn.com/t/font_XXXXXXXX.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.font.im/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><script>var _hmt = _hmt || [];
        (function() {
            var hm = document.createElement("script");
            hm.src = "//hm.baidu.com/hm.js?2ab798f8c30efc389bf38ada82e7e1c6";
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
        })();</script><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><!--!--><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!--!--><!--!--><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }

          const $tabMenu = document.querySelector(`a[href="${location.hash}"]`);
          if (!$tabMenu) {
            return;
          }

          const $tabMenuContainer = $tabMenu.parentElement.parentElement;
          Array.from($tabMenuContainer.children).forEach($menu => $menu.classList.remove('is-active'));
          Array.from($tabMenuContainer.querySelectorAll('a'))
              .map($menu => document.getElementById($menu.getAttribute("href").substring(1)))
              .forEach($content => $content.classList.add('is-hidden'));

          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
          const $activeTab = document.querySelector(location.hash);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.3.0"></head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/logo.svg" alt="叹为观止" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">主页</a><a class="navbar-item" href="/archives">归档</a><a class="navbar-item" href="/categories">分类</a><a class="navbar-item" href="/tags">标签</a><a class="navbar-item" href="/about">关于</a><a class="navbar-item" href="/2013/09/09/index">PowerShell技能索引</a><a class="navbar-item" target="_blank" rel="noopener" href="http://url.cn/Jq5bta">加入QQ群☆</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a><a class="navbar-item search" title="搜索" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-8-widescreen"><div class="card"><div class="card-content"><nav class="breadcrumb" aria-label="breadcrumbs"><ul><li><a href="/categories">分类</a></li><li class="is-active"><a href="#" aria-current="page">powershell</a></li></ul></nav></div></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2025-03-11T00:00:00.000Z" title="2025/3/11 08:00:00">2025-03-11</time>发表</span><span class="level-item"><time dateTime="2025-03-25T07:49:53.963Z" title="2025/3/25 15:49:53">2025-03-25</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/powershell/">powershell</a><span> / </span><a class="link-muted" href="/categories/powershell/tip/">tip</a></span><span class="level-item">6 分钟读完 (大约925个字)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2025/03/11/powershell-event-log-management/">PowerShell 技能连载 - 事件日志管理技巧</a></h1><div class="content"><p>在 PowerShell 中管理事件日志是系统管理和故障排查的重要任务。本文将介绍一些实用的事件日志管理技巧。</p>
<p>首先，让我们看看事件日志的基本操作：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 获取系统事件日志</span></span><br><span class="line"><span class="variable">$logs</span> = <span class="built_in">Get-EventLog</span> <span class="literal">-List</span> | <span class="built_in">Where-Object</span> &#123; <span class="variable">$_</span>.LogDisplayName <span class="operator">-match</span> <span class="string">&quot;System|Application|Security&quot;</span> &#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">Write-Host</span> <span class="string">&quot;`n系统事件日志列表：&quot;</span></span><br><span class="line"><span class="variable">$logs</span> | <span class="built_in">Format-Table</span> LogDisplayName, Entries, MaximumKilobytes, OverflowAction <span class="literal">-AutoSize</span></span><br></pre></td></tr></table></figure>

<p>事件日志查询：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建事件日志查询函数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Get-SystemEvents</span></span> &#123;</span><br><span class="line">    <span class="keyword">param</span>(</span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$LogName</span> = <span class="string">&quot;System&quot;</span>,</span><br><span class="line">        [<span class="built_in">int</span>]<span class="variable">$Hours</span> = <span class="number">24</span>,</span><br><span class="line">        [<span class="built_in">string</span>[]]<span class="variable">$EventTypes</span> = <span class="selector-tag">@</span>(<span class="string">&quot;Error&quot;</span>, <span class="string">&quot;Warning&quot;</span>)</span><br><span class="line">    )</span><br><span class="line">    </span><br><span class="line">    <span class="variable">$startTime</span> = (<span class="built_in">Get-Date</span>).AddHours(-<span class="variable">$Hours</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="variable">$events</span> = <span class="built_in">Get-EventLog</span> <span class="literal">-LogName</span> <span class="variable">$LogName</span> <span class="literal">-After</span> <span class="variable">$startTime</span> | </span><br><span class="line">        <span class="built_in">Where-Object</span> &#123; <span class="variable">$_</span>.EntryType <span class="operator">-in</span> <span class="variable">$EventTypes</span> &#125; |</span><br><span class="line">        <span class="built_in">Select-Object</span> TimeGenerated, EntryType, Source, EventID, Message</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">Write-Host</span> <span class="string">&quot;`n最近 <span class="variable">$Hours</span> 小时内的 <span class="variable">$LogName</span> 日志：&quot;</span></span><br><span class="line">    <span class="variable">$events</span> | <span class="built_in">Format-Table</span> TimeGenerated, EntryType, Source, EventID <span class="literal">-AutoSize</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 统计事件类型</span></span><br><span class="line">    <span class="variable">$events</span> | <span class="built_in">Group-Object</span> EntryType | <span class="built_in">ForEach-Object</span> &#123;</span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">&quot;`n<span class="variable">$</span>(<span class="variable">$_</span>.Name) 事件数量：<span class="variable">$</span>(<span class="variable">$_</span>.Count)&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>事件日志清理：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建事件日志清理函数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Clear-EventLogs</span></span> &#123;</span><br><span class="line">    <span class="keyword">param</span>(</span><br><span class="line">        [<span class="built_in">string</span>[]]<span class="variable">$LogNames</span> = <span class="selector-tag">@</span>(<span class="string">&quot;System&quot;</span>, <span class="string">&quot;Application&quot;</span>, <span class="string">&quot;Security&quot;</span>),</span><br><span class="line">        [<span class="built_in">int</span>]<span class="variable">$DaysToKeep</span> = <span class="number">30</span></span><br><span class="line">    )</span><br><span class="line">    </span><br><span class="line">    <span class="variable">$cutoffDate</span> = (<span class="built_in">Get-Date</span>).AddDays(-<span class="variable">$DaysToKeep</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$logName</span> <span class="keyword">in</span> <span class="variable">$LogNames</span>) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="variable">$log</span> = <span class="built_in">Get-EventLog</span> <span class="literal">-LogName</span> <span class="variable">$logName</span></span><br><span class="line">            <span class="variable">$oldEvents</span> = <span class="variable">$log</span>.Entries | <span class="built_in">Where-Object</span> &#123; <span class="variable">$_</span>.TimeGenerated <span class="operator">-lt</span> <span class="variable">$cutoffDate</span> &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (<span class="variable">$oldEvents</span>) &#123;</span><br><span class="line">                <span class="built_in">Write-Host</span> <span class="string">&quot;`n清理 <span class="variable">$logName</span> 日志...&quot;</span></span><br><span class="line">                <span class="built_in">Write-Host</span> <span class="string">&quot;将删除 <span class="variable">$</span>(<span class="variable">$oldEvents</span>.Count) 条旧记录&quot;</span></span><br><span class="line">                </span><br><span class="line">                <span class="comment"># 导出旧事件到文件</span></span><br><span class="line">                <span class="variable">$exportPath</span> = <span class="string">&quot;C:\LogBackup\<span class="variable">$logName_</span><span class="variable">$</span>(Get-Date -Format &#x27;yyyyMMdd&#x27;).evt&quot;</span></span><br><span class="line">                <span class="variable">$oldEvents</span> | <span class="built_in">Export-Clixml</span> <span class="literal">-Path</span> <span class="variable">$exportPath</span></span><br><span class="line">                </span><br><span class="line">                <span class="comment"># 清理日志</span></span><br><span class="line">                <span class="built_in">Clear-EventLog</span> <span class="literal">-LogName</span> <span class="variable">$logName</span></span><br><span class="line">                <span class="built_in">Write-Host</span> <span class="string">&quot;日志已清理&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="built_in">Write-Host</span> <span class="string">&quot;`n<span class="variable">$logName</span> 日志中没有需要清理的记录&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span> &#123;</span><br><span class="line">            <span class="built_in">Write-Host</span> <span class="string">&quot;清理 <span class="variable">$logName</span> 日志时出错：<span class="variable">$_</span>&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>事件日志监控：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建事件日志监控函数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Watch-EventLog</span></span> &#123;</span><br><span class="line">    <span class="keyword">param</span>(</span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$LogName</span> = <span class="string">&quot;System&quot;</span>,</span><br><span class="line">        [<span class="built_in">string</span>[]]<span class="variable">$EventTypes</span> = <span class="selector-tag">@</span>(<span class="string">&quot;Error&quot;</span>, <span class="string">&quot;Warning&quot;</span>),</span><br><span class="line">        [<span class="built_in">int</span>]<span class="variable">$Duration</span> = <span class="number">300</span></span><br><span class="line">    )</span><br><span class="line">    </span><br><span class="line">    <span class="variable">$endTime</span> = (<span class="built_in">Get-Date</span>).AddSeconds(<span class="variable">$Duration</span>)</span><br><span class="line">    <span class="built_in">Write-Host</span> <span class="string">&quot;开始监控 <span class="variable">$LogName</span> 日志&quot;</span></span><br><span class="line">    <span class="built_in">Write-Host</span> <span class="string">&quot;监控时长：<span class="variable">$Duration</span> 秒&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">while</span> ((<span class="built_in">Get-Date</span>) <span class="operator">-lt</span> <span class="variable">$endTime</span>) &#123;</span><br><span class="line">        <span class="variable">$events</span> = <span class="built_in">Get-EventLog</span> <span class="literal">-LogName</span> <span class="variable">$LogName</span> <span class="literal">-Newest</span> <span class="number">100</span> | </span><br><span class="line">            <span class="built_in">Where-Object</span> &#123; <span class="variable">$_</span>.EntryType <span class="operator">-in</span> <span class="variable">$EventTypes</span> &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$events</span>) &#123;</span><br><span class="line">            <span class="built_in">Write-Host</span> <span class="string">&quot;`n检测到新事件：&quot;</span></span><br><span class="line">            <span class="variable">$events</span> | <span class="built_in">ForEach-Object</span> &#123;</span><br><span class="line">                <span class="built_in">Write-Host</span> <span class="string">&quot;`n时间：<span class="variable">$</span>(<span class="variable">$_</span>.TimeGenerated)&quot;</span></span><br><span class="line">                <span class="built_in">Write-Host</span> <span class="string">&quot;类型：<span class="variable">$</span>(<span class="variable">$_</span>.EntryType)&quot;</span></span><br><span class="line">                <span class="built_in">Write-Host</span> <span class="string">&quot;来源：<span class="variable">$</span>(<span class="variable">$_</span>.Source)&quot;</span></span><br><span class="line">                <span class="built_in">Write-Host</span> <span class="string">&quot;事件ID：<span class="variable">$</span>(<span class="variable">$_</span>.EventID)&quot;</span></span><br><span class="line">                <span class="built_in">Write-Host</span> <span class="string">&quot;消息：<span class="variable">$</span>(<span class="variable">$_</span>.Message)&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">Start-Sleep</span> <span class="literal">-Seconds</span> <span class="number">5</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>一些实用的事件日志管理技巧：</p>
<ol>
<li><p>事件日志分析：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 分析事件日志模式</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Analyze-EventPatterns</span></span> &#123;</span><br><span class="line">    <span class="keyword">param</span>(</span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$LogName</span> = <span class="string">&quot;System&quot;</span>,</span><br><span class="line">        [<span class="built_in">int</span>]<span class="variable">$Hours</span> = <span class="number">24</span></span><br><span class="line">    )</span><br><span class="line">    </span><br><span class="line">    <span class="variable">$startTime</span> = (<span class="built_in">Get-Date</span>).AddHours(-<span class="variable">$Hours</span>)</span><br><span class="line">    <span class="variable">$events</span> = <span class="built_in">Get-EventLog</span> <span class="literal">-LogName</span> <span class="variable">$LogName</span> <span class="literal">-After</span> <span class="variable">$startTime</span></span><br><span class="line">    </span><br><span class="line">    <span class="built_in">Write-Host</span> <span class="string">&quot;`n事件来源统计：&quot;</span></span><br><span class="line">    <span class="variable">$events</span> | <span class="built_in">Group-Object</span> Source | </span><br><span class="line">        <span class="built_in">Sort-Object</span> Count <span class="literal">-Descending</span> | </span><br><span class="line">        <span class="built_in">Select-Object</span> <span class="literal">-First</span> <span class="number">10</span> | </span><br><span class="line">        <span class="built_in">Format-Table</span> Name, Count <span class="literal">-AutoSize</span></span><br><span class="line">    </span><br><span class="line">    <span class="built_in">Write-Host</span> <span class="string">&quot;`n事件类型分布：&quot;</span></span><br><span class="line">    <span class="variable">$events</span> | <span class="built_in">Group-Object</span> EntryType | </span><br><span class="line">        <span class="built_in">Format-Table</span> Name, Count <span class="literal">-AutoSize</span></span><br><span class="line">    </span><br><span class="line">    <span class="built_in">Write-Host</span> <span class="string">&quot;`n最常见的事件ID：&quot;</span></span><br><span class="line">    <span class="variable">$events</span> | <span class="built_in">Group-Object</span> EventID | </span><br><span class="line">        <span class="built_in">Sort-Object</span> Count <span class="literal">-Descending</span> | </span><br><span class="line">        <span class="built_in">Select-Object</span> <span class="literal">-First</span> <span class="number">10</span> | </span><br><span class="line">        <span class="built_in">Format-Table</span> Name, Count <span class="literal">-AutoSize</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>事件日志导出：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 导出事件日志</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Export-EventLogs</span></span> &#123;</span><br><span class="line">    <span class="keyword">param</span>(</span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$LogName</span>,</span><br><span class="line">        [<span class="built_in">DateTime</span>]<span class="variable">$StartTime</span>,</span><br><span class="line">        [<span class="built_in">DateTime</span>]<span class="variable">$EndTime</span>,</span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$ExportPath</span></span><br><span class="line">    )</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 创建导出目录</span></span><br><span class="line">    <span class="built_in">New-Item</span> <span class="literal">-ItemType</span> Directory <span class="literal">-Path</span> <span class="variable">$ExportPath</span> <span class="literal">-Force</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 导出事件日志</span></span><br><span class="line">    <span class="variable">$events</span> = <span class="built_in">Get-EventLog</span> <span class="literal">-LogName</span> <span class="variable">$LogName</span> <span class="literal">-After</span> <span class="variable">$StartTime</span> <span class="literal">-Before</span> <span class="variable">$EndTime</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 导出为CSV</span></span><br><span class="line">    <span class="variable">$csvPath</span> = <span class="built_in">Join-Path</span> <span class="variable">$ExportPath</span> <span class="string">&quot;<span class="variable">$LogName_</span><span class="variable">$</span>(Get-Date -Format &#x27;yyyyMMdd&#x27;).csv&quot;</span></span><br><span class="line">    <span class="variable">$events</span> | <span class="built_in">Export-Csv</span> <span class="literal">-Path</span> <span class="variable">$csvPath</span> <span class="literal">-NoTypeInformation</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 导出为XML</span></span><br><span class="line">    <span class="variable">$xmlPath</span> = <span class="built_in">Join-Path</span> <span class="variable">$ExportPath</span> <span class="string">&quot;<span class="variable">$LogName_</span><span class="variable">$</span>(Get-Date -Format &#x27;yyyyMMdd&#x27;).xml&quot;</span></span><br><span class="line">    <span class="variable">$events</span> | <span class="built_in">Export-Clixml</span> <span class="literal">-Path</span> <span class="variable">$xmlPath</span></span><br><span class="line">    </span><br><span class="line">    <span class="built_in">Write-Host</span> <span class="string">&quot;`n已导出事件日志：&quot;</span></span><br><span class="line">    <span class="built_in">Write-Host</span> <span class="string">&quot;CSV文件：<span class="variable">$csvPath</span>&quot;</span></span><br><span class="line">    <span class="built_in">Write-Host</span> <span class="string">&quot;XML文件：<span class="variable">$xmlPath</span>&quot;</span></span><br><span class="line">    <span class="built_in">Write-Host</span> <span class="string">&quot;事件数量：<span class="variable">$</span>(<span class="variable">$events</span>.Count)&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>事件日志过滤：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建高级事件日志过滤函数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Get-FilteredEvents</span></span> &#123;</span><br><span class="line">    <span class="keyword">param</span>(</span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$LogName</span>,</span><br><span class="line">        [<span class="built_in">string</span>[]]<span class="variable">$EventTypes</span>,</span><br><span class="line">        [<span class="built_in">string</span>[]]<span class="variable">$Sources</span>,</span><br><span class="line">        [<span class="built_in">int</span>[]]<span class="variable">$EventIDs</span>,</span><br><span class="line">        [<span class="built_in">int</span>]<span class="variable">$Hours</span> = <span class="number">24</span></span><br><span class="line">    )</span><br><span class="line">    </span><br><span class="line">    <span class="variable">$startTime</span> = (<span class="built_in">Get-Date</span>).AddHours(-<span class="variable">$Hours</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="variable">$events</span> = <span class="built_in">Get-EventLog</span> <span class="literal">-LogName</span> <span class="variable">$LogName</span> <span class="literal">-After</span> <span class="variable">$startTime</span> | </span><br><span class="line">        <span class="built_in">Where-Object</span> &#123;</span><br><span class="line">            <span class="variable">$_</span>.EntryType <span class="operator">-in</span> <span class="variable">$EventTypes</span> <span class="operator">-and</span></span><br><span class="line">            <span class="variable">$_</span>.Source <span class="operator">-in</span> <span class="variable">$Sources</span> <span class="operator">-and</span></span><br><span class="line">            <span class="variable">$_</span>.EventID <span class="operator">-in</span> <span class="variable">$EventIDs</span></span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">Write-Host</span> <span class="string">&quot;`n过滤结果：&quot;</span></span><br><span class="line">    <span class="variable">$events</span> | <span class="built_in">Format-Table</span> TimeGenerated, EntryType, Source, EventID, Message <span class="literal">-AutoSize</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 生成统计报告</span></span><br><span class="line">    <span class="built_in">Write-Host</span> <span class="string">&quot;`n统计信息：&quot;</span></span><br><span class="line">    <span class="built_in">Write-Host</span> <span class="string">&quot;总事件数：<span class="variable">$</span>(<span class="variable">$events</span>.Count)&quot;</span></span><br><span class="line">    <span class="built_in">Write-Host</span> <span class="string">&quot;`n按事件类型统计：&quot;</span></span><br><span class="line">    <span class="variable">$events</span> | <span class="built_in">Group-Object</span> EntryType | <span class="built_in">Format-Table</span> Name, Count <span class="literal">-AutoSize</span></span><br><span class="line">    <span class="built_in">Write-Host</span> <span class="string">&quot;`n按来源统计：&quot;</span></span><br><span class="line">    <span class="variable">$events</span> | <span class="built_in">Group-Object</span> Source | <span class="built_in">Format-Table</span> Name, Count <span class="literal">-AutoSize</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<p>这些技巧将帮助您更有效地管理事件日志。记住，在处理事件日志时，始终要注意日志的安全性和完整性。同时，建议定期备份重要的事件日志，以便进行历史分析和故障排查。 </p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2025-03-10T00:00:00.000Z" title="2025/3/10 08:00:00">2025-03-10</time>发表</span><span class="level-item"><time dateTime="2025-03-25T09:40:56.368Z" title="2025/3/25 17:40:56">2025-03-25</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/powershell/">powershell</a><span> / </span><a class="link-muted" href="/categories/powershell/devops/">devops</a><span> / </span><a class="link-muted" href="/categories/powershell/devops/kubernetes/">kubernetes</a></span><span class="level-item">1 分钟读完 (大约196个字)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2025/03/10/powershell-k8s-automation/">PowerShell 技能连载 - Kubernetes 节点智能编排</a></h1><div class="content"><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Invoke-K8sNodeOrchestration</span></span> &#123;</span><br><span class="line">    <span class="function">[<span class="type">CmdletBinding</span>()]</span></span><br><span class="line">    <span class="keyword">param</span>(</span><br><span class="line">        [<span class="type">ValidateSet</span>(<span class="string">&#x27;ScaleUp&#x27;</span>,<span class="string">&#x27;ScaleDown&#x27;</span>,<span class="string">&#x27;Maintenance&#x27;</span>)]</span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$Operation</span>,</span><br><span class="line">        [<span class="built_in">int</span>]<span class="variable">$NodeCount</span> = <span class="number">1</span></span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    <span class="variable">$nodePool</span> = <span class="built_in">Get-AzAksNodePool</span> <span class="literal">-ClusterName</span> <span class="string">&#x27;prod-cluster&#x27;</span></span><br><span class="line">    <span class="variable">$metrics</span> = <span class="built_in">Invoke-RestMethod</span> <span class="literal">-Uri</span> <span class="string">&#x27;http://k8s-metrics:8080/api/v1/nodes&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">switch</span> (<span class="variable">$Operation</span>) &#123;</span><br><span class="line">        <span class="string">&#x27;ScaleUp&#x27;</span> &#123;</span><br><span class="line">            <span class="variable">$newCount</span> = <span class="variable">$nodePool</span>.Count + <span class="variable">$NodeCount</span></span><br><span class="line">            <span class="built_in">Update-AzAksNodePool</span> <span class="literal">-Name</span> <span class="variable">$nodePool</span>.Name <span class="literal">-Count</span> <span class="variable">$newCount</span></span><br><span class="line">            <span class="built_in">Write-Host</span> <span class="string">&quot;节点池已扩容至<span class="variable">$newCount</span>个节点&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="string">&#x27;ScaleDown&#x27;</span> &#123;</span><br><span class="line">            <span class="variable">$nodesToRemove</span> = <span class="variable">$metrics</span>.Nodes | </span><br><span class="line">                <span class="built_in">Where-Object</span> &#123; <span class="variable">$_</span>.CpuUsage <span class="operator">-lt</span> <span class="number">20</span> &#125; | </span><br><span class="line">                <span class="built_in">Select-Object</span> <span class="literal">-First</span> <span class="variable">$NodeCount</span></span><br><span class="line">            <span class="variable">$nodesToRemove</span> | <span class="built_in">ForEach-Object</span> &#123;</span><br><span class="line">                <span class="built_in">Set-AzAksNode</span> <span class="literal">-Name</span> <span class="variable">$_</span>.Name <span class="literal">-State</span> Draining</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="string">&#x27;Maintenance&#x27;</span> &#123;</span><br><span class="line">            <span class="variable">$metrics</span>.Nodes | <span class="built_in">Where-Object</span> &#123; <span class="variable">$_</span>.HealthStatus <span class="operator">-ne</span> <span class="string">&#x27;Healthy&#x27;</span> &#125; |</span><br><span class="line">                <span class="built_in">ForEach-Object</span> &#123;</span><br><span class="line">                    <span class="built_in">Add-K8sNodeLabel</span> <span class="literal">-Node</span> <span class="variable">$_</span>.Name <span class="literal">-Label</span> <span class="selector-tag">@</span>&#123;</span><br><span class="line">                        <span class="string">&#x27;maintenance&#x27;</span> = (<span class="built_in">Get-Date</span>).ToString(<span class="string">&#x27;yyyyMMdd&#x27;</span>)</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>核心功能</strong>：</p>
<ol>
<li>节点自动扩缩容策略</li>
<li>基于资源利用率的智能调度</li>
<li>维护模式自动标签管理</li>
<li>与Azure AKS深度集成</li>
</ol>
<p><strong>典型应用场景</strong>：</p>
<ul>
<li>应对突发流量自动扩容节点</li>
<li>低负载时段自动缩容节约成本</li>
<li>异常节点自动隔离维护</li>
<li>跨可用区节点平衡管理</li>
</ul>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2025-03-07T00:00:00.000Z" title="2025/3/7 08:00:00">2025-03-07</time>发表</span><span class="level-item"><time dateTime="2025-03-25T07:49:53.433Z" title="2025/3/25 15:49:53">2025-03-25</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/powershell/">powershell</a><span> / </span><a class="link-muted" href="/categories/powershell/basic/">basic</a></span><span class="level-item">1 分钟读完 (大约128个字)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2025/03/07/powershell-flow-control/">PowerShell流程控制结构精解</a></h1><div class="content"><h2 id="循环结构实战"><a href="#循环结构实战" class="headerlink" title="循环结构实战"></a>循环结构实战</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 集合遍历优化</span></span><br><span class="line"><span class="variable">$processList</span> = <span class="built_in">Get-Process</span></span><br><span class="line"><span class="keyword">foreach</span> (<span class="variable">$process</span> <span class="keyword">in</span> <span class="variable">$processList</span>.Where&#123; <span class="variable">$_</span>.CPU <span class="operator">-gt</span> <span class="number">100</span> &#125;) &#123;</span><br><span class="line">    <span class="string">&quot;高CPU进程: <span class="variable">$</span>(<span class="variable">$process</span>.Name)&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 并行处理演示</span></span><br><span class="line"><span class="number">1</span>..<span class="number">10</span> | <span class="built_in">ForEach-Object</span> <span class="literal">-Parallel</span> &#123;</span><br><span class="line">    <span class="string">&quot;任务 <span class="variable">$_</span> 开始于: <span class="variable">$</span>(Get-Date)&quot;</span></span><br><span class="line">    <span class="built_in">Start-Sleep</span> <span class="literal">-Seconds</span> <span class="number">1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="条件判断进阶"><a href="#条件判断进阶" class="headerlink" title="条件判断进阶"></a>条件判断进阶</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 多条件筛选模式</span></span><br><span class="line"><span class="variable">$score</span> = <span class="number">85</span></span><br><span class="line"><span class="keyword">switch</span> (<span class="variable">$score</span>) &#123;</span><br><span class="line">    &#123; <span class="variable">$_</span> <span class="operator">-ge</span> <span class="number">90</span> &#125; &#123; <span class="string">&quot;优秀&quot;</span> &#125;</span><br><span class="line">    &#123; <span class="variable">$_</span> <span class="operator">-ge</span> <span class="number">75</span> &#125; &#123; <span class="string">&quot;良好&quot;</span> &#125;</span><br><span class="line">    default &#123; <span class="string">&quot;待提高&quot;</span> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="最佳实践"><a href="#最佳实践" class="headerlink" title="最佳实践"></a>最佳实践</h2><ol>
<li>避免在循环内执行耗时操作</li>
<li>使用break&#x2F;continue优化循环效率</li>
<li>优先使用管道代替传统循环</li>
<li>合理设置循环终止条件防止死循环</li>
</ol>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2025-03-06T00:00:00.000Z" title="2025/3/6 08:00:00">2025-03-06</time>发表</span><span class="level-item"><time dateTime="2025-03-25T07:49:53.499Z" title="2025/3/25 15:49:53">2025-03-25</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/powershell/">powershell</a><span> / </span><a class="link-muted" href="/categories/powershell/basic/">basic</a></span><span class="level-item">1 分钟读完 (大约183个字)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2025/03/06/powershell-function-definition/">PowerShell函数定义最佳实践</a></h1><div class="content"><h2 id="函数结构解析"><a href="#函数结构解析" class="headerlink" title="函数结构解析"></a>函数结构解析</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 带参数验证的函数示例</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Get-Volume</span></span> &#123;</span><br><span class="line">    <span class="keyword">param</span>(</span><br><span class="line">        [<span class="type">Parameter</span>(<span class="type">Mandatory</span>)]</span><br><span class="line">        [<span class="type">ValidatePattern</span>(<span class="string">&#x27;^[A-Z]:$&#x27;</span>)]</span><br><span class="line">        <span class="variable">$DriveLetter</span></span><br><span class="line">    )</span><br><span class="line">    <span class="built_in">Get-PSDrive</span> <span class="variable">$DriveLetter</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="返回值处理机制"><a href="#返回值处理机制" class="headerlink" title="返回值处理机制"></a>返回值处理机制</h2><table>
<thead>
<tr>
<th>方法</th>
<th>作用</th>
<th>推荐场景</th>
</tr>
</thead>
<tbody><tr>
<td>Write-Output</td>
<td>默认输出到管道</td>
<td>数据传递</td>
</tr>
<tr>
<td>return</td>
<td>立即终止并返回值</td>
<td>条件返回</td>
</tr>
<tr>
<td>[void]</td>
<td>抑制输出</td>
<td>无返回值操作</td>
</tr>
</tbody></table>
<h2 id="典型应用场景"><a href="#典型应用场景" class="headerlink" title="典型应用场景"></a>典型应用场景</h2><ol>
<li>通过[CmdletBinding()]启用高级函数特性</li>
<li>使用begin&#x2F;process&#x2F;end块处理管道输入</li>
<li>采用ShouldProcess实现危险操作确认</li>
<li>通过comment-based help添加帮助文档</li>
</ol>
<h2 id="常见错误模式"><a href="#常见错误模式" class="headerlink" title="常见错误模式"></a>常见错误模式</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 未处理的参数类型错误</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Add-Numbers</span></span> &#123;</span><br><span class="line">    <span class="keyword">param</span>(<span class="variable">$a</span>, <span class="variable">$b</span>)</span><br><span class="line">    <span class="variable">$a</span> + <span class="variable">$b</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">Add-Numbers</span> <span class="literal">-a</span> <span class="string">&#x27;1&#x27;</span> <span class="literal">-b</span> <span class="number">2</span>  <span class="comment"># 输出12</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 正确的类型强制转换</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Add-Integers</span></span> &#123;</span><br><span class="line">    <span class="keyword">param</span>(</span><br><span class="line">        [<span class="built_in">int</span>]<span class="variable">$a</span>,</span><br><span class="line">        [<span class="built_in">int</span>]<span class="variable">$b</span></span><br><span class="line">    )</span><br><span class="line">    <span class="variable">$a</span> + <span class="variable">$b</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2025-03-05T00:00:00.000Z" title="2025/3/5 08:00:00">2025-03-05</time>发表</span><span class="level-item"><time dateTime="2025-03-25T07:49:53.551Z" title="2025/3/25 15:49:53">2025-03-25</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/powershell/">powershell</a><span> / </span><a class="link-muted" href="/categories/powershell/basic/">basic</a></span><span class="level-item">1 分钟读完 (大约142个字)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2025/03/05/powershell-debugging-techniques/">PowerShell脚本调试全攻略</a></h1><div class="content"><h2 id="调试基础工具"><a href="#调试基础工具" class="headerlink" title="调试基础工具"></a>调试基础工具</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 设置行号断点</span></span><br><span class="line"><span class="built_in">Set-PSBreakpoint</span> <span class="literal">-Script</span> test.ps1 <span class="literal">-Line</span> <span class="number">15</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 条件断点演示</span></span><br><span class="line"><span class="built_in">Set-PSBreakpoint</span> <span class="literal">-Script</span> test.ps1 <span class="literal">-Line</span> <span class="number">20</span> <span class="literal">-Action</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$_</span>.Count <span class="operator">-gt</span> <span class="number">100</span>) &#123; <span class="keyword">break</span> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="变量追踪技巧"><a href="#变量追踪技巧" class="headerlink" title="变量追踪技巧"></a>变量追踪技巧</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 调试模式查看变量</span></span><br><span class="line"><span class="variable">$DebugPreference</span> = <span class="string">&#x27;Continue&#x27;</span></span><br><span class="line"><span class="variable">$processList</span> = <span class="built_in">Get-Process</span></span><br><span class="line"><span class="built_in">Write-Debug</span> <span class="string">&quot;当前进程数量: <span class="variable">$</span>(<span class="variable">$processList</span>.Count)&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用调试控制台</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Test-Function</span></span> &#123;</span><br><span class="line">    <span class="function">[<span class="type">CmdletBinding</span>()]</span></span><br><span class="line">    <span class="keyword">param</span>()</span><br><span class="line">    <span class="variable">$private:counter</span> = <span class="number">0</span></span><br><span class="line">    <span class="comment"># 在调试器中输入 $private:counter 查看私有变量</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="最佳实践"><a href="#最佳实践" class="headerlink" title="最佳实践"></a>最佳实践</h2><ol>
<li>使用Step-Into&#x2F;Step-Over逐行调试</li>
<li>通过$Host.EnterNestedPrompt进入嵌套调试环境</li>
<li>结合ISE&#x2F;VSCode图形化调试工具</li>
<li>使用Write-Verbose输出调试信息</li>
</ol>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2025-03-04T00:00:00.000Z" title="2025/3/4 08:00:00">2025-03-04</time>发表</span><span class="level-item"><time dateTime="2025-03-25T07:49:53.482Z" title="2025/3/25 15:49:53">2025-03-25</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/powershell/">powershell</a><span> / </span><a class="link-muted" href="/categories/powershell/tip/">tip</a></span><span class="level-item">4 分钟读完 (大约572个字)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2025/03/04/powershell-system-optimization/">PowerShell 技能连载 - 系统优化技巧</a></h1><div class="content"><p>在 PowerShell 中优化系统性能是一项重要任务，本文将介绍一些实用的系统优化技巧。</p>
<p>首先，让我们看看基本的系统优化操作：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建系统性能分析函数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Get-SystemPerformance</span></span> &#123;</span><br><span class="line">    <span class="keyword">param</span>(</span><br><span class="line">        [<span class="built_in">int</span>]<span class="variable">$Duration</span> = <span class="number">3600</span>,</span><br><span class="line">        [<span class="built_in">int</span>]<span class="variable">$Interval</span> = <span class="number">60</span></span><br><span class="line">    )</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="variable">$metrics</span> = <span class="selector-tag">@</span>()</span><br><span class="line">        <span class="variable">$endTime</span> = <span class="built_in">Get-Date</span></span><br><span class="line">        <span class="variable">$startTime</span> = <span class="variable">$endTime</span>.AddSeconds(-<span class="variable">$Duration</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">while</span> (<span class="variable">$startTime</span> <span class="operator">-lt</span> <span class="variable">$endTime</span>) &#123;</span><br><span class="line">            <span class="variable">$cpu</span> = <span class="built_in">Get-Counter</span> <span class="string">&#x27;\Processor(_Total)\% Processor Time&#x27;</span></span><br><span class="line">            <span class="variable">$memory</span> = <span class="built_in">Get-Counter</span> <span class="string">&#x27;\Memory\Available MBytes&#x27;</span></span><br><span class="line">            <span class="variable">$disk</span> = <span class="built_in">Get-Counter</span> <span class="string">&#x27;\PhysicalDisk(_Total)\% Disk Time&#x27;</span></span><br><span class="line">            </span><br><span class="line">            <span class="variable">$metrics</span> += [<span class="type">PSCustomObject</span>]<span class="selector-tag">@</span>&#123;</span><br><span class="line">                Time = <span class="built_in">Get-Date</span></span><br><span class="line">                CPUUsage = <span class="variable">$cpu</span>.CounterSamples.CookedValue</span><br><span class="line">                AvailableMemory = <span class="variable">$memory</span>.CounterSamples.CookedValue</span><br><span class="line">                DiskUsage = <span class="variable">$disk</span>.CounterSamples.CookedValue</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="variable">$startTime</span> = <span class="variable">$startTime</span>.AddSeconds(<span class="variable">$Interval</span>)</span><br><span class="line">            <span class="built_in">Start-Sleep</span> <span class="literal">-Seconds</span> <span class="variable">$Interval</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> [<span class="type">PSCustomObject</span>]<span class="selector-tag">@</span>&#123;</span><br><span class="line">            Duration = <span class="variable">$Duration</span></span><br><span class="line">            Interval = <span class="variable">$Interval</span></span><br><span class="line">            Metrics = <span class="variable">$metrics</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> &#123;</span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">&quot;系统性能分析失败：<span class="variable">$_</span>&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>系统服务优化：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建系统服务优化函数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Optimize-SystemServices</span></span> &#123;</span><br><span class="line">    <span class="keyword">param</span>(</span><br><span class="line">        [<span class="built_in">string</span>[]]<span class="variable">$Services</span>,</span><br><span class="line">        [<span class="type">ValidateSet</span>(<span class="string">&#x27;Startup&#x27;</span>, <span class="string">&#x27;Manual&#x27;</span>, <span class="string">&#x27;Disabled&#x27;</span>)]</span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$StartupType</span></span><br><span class="line">    )</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">foreach</span> (<span class="variable">$service</span> <span class="keyword">in</span> <span class="variable">$Services</span>) &#123;</span><br><span class="line">            <span class="variable">$svc</span> = <span class="built_in">Get-Service</span> <span class="literal">-Name</span> <span class="variable">$service</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="variable">$svc</span>) &#123;</span><br><span class="line">                <span class="built_in">Set-Service</span> <span class="literal">-Name</span> <span class="variable">$service</span> <span class="literal">-StartupType</span> <span class="variable">$StartupType</span></span><br><span class="line">                <span class="built_in">Write-Host</span> <span class="string">&quot;服务 <span class="variable">$service</span> 已设置为 <span class="variable">$StartupType</span>&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> [<span class="type">PSCustomObject</span>]<span class="selector-tag">@</span>&#123;</span><br><span class="line">            Services = <span class="variable">$Services</span></span><br><span class="line">            StartupType = <span class="variable">$StartupType</span></span><br><span class="line">            Status = <span class="string">&quot;完成&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> &#123;</span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">&quot;系统服务优化失败：<span class="variable">$_</span>&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>系统注册表优化：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建系统注册表优化函数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Optimize-SystemRegistry</span></span> &#123;</span><br><span class="line">    <span class="keyword">param</span>(</span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$RegistryPath</span>,</span><br><span class="line">        [<span class="built_in">hashtable</span>]<span class="variable">$Settings</span></span><br><span class="line">    )</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="operator">-not</span> (<span class="built_in">Test-Path</span> <span class="variable">$RegistryPath</span>)) &#123;</span><br><span class="line">            <span class="built_in">New-Item</span> <span class="literal">-Path</span> <span class="variable">$RegistryPath</span> <span class="literal">-Force</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">foreach</span> (<span class="variable">$key</span> <span class="keyword">in</span> <span class="variable">$Settings</span>.Keys) &#123;</span><br><span class="line">            <span class="variable">$value</span> = <span class="variable">$Settings</span>[<span class="variable">$key</span>]</span><br><span class="line">            <span class="built_in">Set-ItemProperty</span> <span class="literal">-Path</span> <span class="variable">$RegistryPath</span> <span class="literal">-Name</span> <span class="variable">$key</span> <span class="literal">-Value</span> <span class="variable">$value</span></span><br><span class="line">            <span class="built_in">Write-Host</span> <span class="string">&quot;注册表项 <span class="variable">$key</span> 已设置为 <span class="variable">$value</span>&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> [<span class="type">PSCustomObject</span>]<span class="selector-tag">@</span>&#123;</span><br><span class="line">            RegistryPath = <span class="variable">$RegistryPath</span></span><br><span class="line">            Settings = <span class="variable">$Settings</span></span><br><span class="line">            Status = <span class="string">&quot;完成&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> &#123;</span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">&quot;系统注册表优化失败：<span class="variable">$_</span>&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>系统磁盘优化：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建系统磁盘优化函数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Optimize-SystemDisk</span></span> &#123;</span><br><span class="line">    <span class="keyword">param</span>(</span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$DriveLetter</span>,</span><br><span class="line">        [<span class="type">switch</span>]<span class="variable">$Defrag</span>,</span><br><span class="line">        [<span class="type">switch</span>]<span class="variable">$Cleanup</span></span><br><span class="line">    )</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="variable">$results</span> = <span class="selector-tag">@</span>()</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$Defrag</span>) &#123;</span><br><span class="line">            <span class="variable">$defragResult</span> = <span class="built_in">Optimize-Volume</span> <span class="literal">-DriveLetter</span> <span class="variable">$DriveLetter</span> <span class="literal">-Defrag</span> <span class="literal">-Verbose</span></span><br><span class="line">            <span class="variable">$results</span> += [<span class="type">PSCustomObject</span>]<span class="selector-tag">@</span>&#123;</span><br><span class="line">                Operation = <span class="string">&quot;Defrag&quot;</span></span><br><span class="line">                Status = <span class="variable">$defragResult</span>.Status</span><br><span class="line">                SpaceSaved = <span class="variable">$defragResult</span>.SpaceSaved</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$Cleanup</span>) &#123;</span><br><span class="line">            <span class="variable">$cleanupResult</span> = <span class="built_in">Clear-RecycleBin</span> <span class="literal">-DriveLetter</span> <span class="variable">$DriveLetter</span> <span class="literal">-Force</span></span><br><span class="line">            <span class="variable">$results</span> += [<span class="type">PSCustomObject</span>]<span class="selector-tag">@</span>&#123;</span><br><span class="line">                Operation = <span class="string">&quot;Cleanup&quot;</span></span><br><span class="line">                Status = <span class="string">&quot;完成&quot;</span></span><br><span class="line">                ItemsRemoved = <span class="variable">$cleanupResult</span>.Count</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> [<span class="type">PSCustomObject</span>]<span class="selector-tag">@</span>&#123;</span><br><span class="line">            DriveLetter = <span class="variable">$DriveLetter</span></span><br><span class="line">            Operations = <span class="variable">$results</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> &#123;</span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">&quot;系统磁盘优化失败：<span class="variable">$_</span>&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>系统网络优化：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建系统网络优化函数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Optimize-SystemNetwork</span></span> &#123;</span><br><span class="line">    <span class="keyword">param</span>(</span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$AdapterName</span>,</span><br><span class="line">        [<span class="built_in">hashtable</span>]<span class="variable">$Settings</span></span><br><span class="line">    )</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="variable">$adapter</span> = <span class="built_in">Get-NetAdapter</span> <span class="literal">-Name</span> <span class="variable">$AdapterName</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$adapter</span>) &#123;</span><br><span class="line">            <span class="keyword">foreach</span> (<span class="variable">$key</span> <span class="keyword">in</span> <span class="variable">$Settings</span>.Keys) &#123;</span><br><span class="line">                <span class="variable">$value</span> = <span class="variable">$Settings</span>[<span class="variable">$key</span>]</span><br><span class="line">                <span class="built_in">Set-NetAdapterAdvancedProperty</span> <span class="literal">-Name</span> <span class="variable">$AdapterName</span> <span class="literal">-RegistryKeyword</span> <span class="variable">$key</span> <span class="literal">-RegistryValue</span> <span class="variable">$value</span></span><br><span class="line">                <span class="built_in">Write-Host</span> <span class="string">&quot;网络适配器 <span class="variable">$AdapterName</span> 的 <span class="variable">$key</span> 已设置为 <span class="variable">$value</span>&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">return</span> [<span class="type">PSCustomObject</span>]<span class="selector-tag">@</span>&#123;</span><br><span class="line">                AdapterName = <span class="variable">$AdapterName</span></span><br><span class="line">                Settings = <span class="variable">$Settings</span></span><br><span class="line">                Status = <span class="string">&quot;完成&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">Write-Host</span> <span class="string">&quot;未找到网络适配器：<span class="variable">$AdapterName</span>&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> &#123;</span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">&quot;系统网络优化失败：<span class="variable">$_</span>&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这些技巧将帮助您更有效地优化系统性能。记住，在优化系统时，始终要注意安全性和稳定性。同时，建议使用适当的错误处理和日志记录机制来跟踪所有操作。 </p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2025-02-28T00:00:00.000Z" title="2025/2/28 08:00:00">2025-02-28</time>发表</span><span class="level-item"><time dateTime="2025-03-25T07:49:53.586Z" title="2025/3/25 15:49:53">2025-03-25</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/powershell/">powershell</a><span> / </span><a class="link-muted" href="/categories/powershell/tip/">tip</a></span><span class="level-item">15 分钟读完 (大约2188个字)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2025/02/28/powershell-infrastructure-as-code/">PowerShell 技能连载 - 基础设施即代码实践</a></h1><div class="content"><p>在现代IT运维领域，基础设施即代码(Infrastructure as Code, IaC)已成为标准实践。本文将介绍如何使用PowerShell实现高效的IaC解决方案。</p>
<p>首先，让我们创建一个基础环境配置定义函数：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建环境配置定义函数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">New-InfrastructureDefinition</span></span> &#123;</span><br><span class="line">    <span class="keyword">param</span>(</span><br><span class="line">        [<span class="type">Parameter</span>(<span class="type">Mandatory</span>)]</span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$EnvironmentName</span>,</span><br><span class="line">        </span><br><span class="line">        [<span class="type">Parameter</span>(<span class="type">Mandatory</span>)]</span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$OutputPath</span>,</span><br><span class="line">        </span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$Description</span> = <span class="string">&quot;&quot;</span>,</span><br><span class="line">        </span><br><span class="line">        [<span class="type">ValidateSet</span>(<span class="string">&quot;Development&quot;</span>, <span class="string">&quot;Testing&quot;</span>, <span class="string">&quot;Staging&quot;</span>, <span class="string">&quot;Production&quot;</span>)]</span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$EnvironmentType</span> = <span class="string">&quot;Development&quot;</span>,</span><br><span class="line">        </span><br><span class="line">        [<span class="type">switch</span>]<span class="variable">$Force</span></span><br><span class="line">    )</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment"># 创建基础环境配置对象</span></span><br><span class="line">        <span class="variable">$infrastructureDefinition</span> = [<span class="type">PSCustomObject</span>]<span class="selector-tag">@</span>&#123;</span><br><span class="line">            EnvironmentName = <span class="variable">$EnvironmentName</span></span><br><span class="line">            EnvironmentType = <span class="variable">$EnvironmentType</span></span><br><span class="line">            Description = <span class="variable">$Description</span></span><br><span class="line">            CreatedBy = <span class="variable">$env:USERNAME</span></span><br><span class="line">            CreatedOn = <span class="built_in">Get-Date</span></span><br><span class="line">            Version = <span class="string">&quot;1.0&quot;</span></span><br><span class="line">            Resources = <span class="selector-tag">@</span>&#123;</span><br><span class="line">                VirtualMachines = <span class="selector-tag">@</span>()</span><br><span class="line">                NetworkResources = <span class="selector-tag">@</span>()</span><br><span class="line">                StorageResources = <span class="selector-tag">@</span>()</span><br><span class="line">                SecurityResources = <span class="selector-tag">@</span>()</span><br><span class="line">                DatabaseResources = <span class="selector-tag">@</span>()</span><br><span class="line">                ApplicationResources = <span class="selector-tag">@</span>()</span><br><span class="line">            &#125;</span><br><span class="line">            Dependencies = <span class="selector-tag">@</span>&#123;&#125;</span><br><span class="line">            DeploymentOrder = <span class="selector-tag">@</span>()</span><br><span class="line">            State = <span class="string">&quot;Draft&quot;</span></span><br><span class="line">            Metadata = <span class="selector-tag">@</span>&#123;&#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 创建JSON定义文件</span></span><br><span class="line">        <span class="variable">$definitionFile</span> = <span class="built_in">Join-Path</span> <span class="literal">-Path</span> <span class="variable">$OutputPath</span> <span class="literal">-ChildPath</span> <span class="string">&quot;<span class="variable">$EnvironmentName</span>.json&quot;</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> ((<span class="built_in">Test-Path</span> <span class="literal">-Path</span> <span class="variable">$definitionFile</span>) <span class="operator">-and</span> (<span class="operator">-not</span> <span class="variable">$Force</span>)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="string">&quot;定义文件 &#x27;<span class="variable">$definitionFile</span>&#x27; 已存在。使用 -Force 参数覆盖现有文件。&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 创建输出目录（如果不存在）</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="operator">-not</span> (<span class="built_in">Test-Path</span> <span class="literal">-Path</span> <span class="variable">$OutputPath</span>)) &#123;</span><br><span class="line">            <span class="built_in">New-Item</span> <span class="literal">-Path</span> <span class="variable">$OutputPath</span> <span class="literal">-ItemType</span> Directory <span class="literal">-Force</span> | <span class="built_in">Out-Null</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 保存定义</span></span><br><span class="line">        <span class="variable">$infrastructureDefinition</span> | <span class="built_in">ConvertTo-Json</span> <span class="literal">-Depth</span> <span class="number">10</span> | <span class="built_in">Out-File</span> <span class="literal">-FilePath</span> <span class="variable">$definitionFile</span> <span class="literal">-Encoding</span> UTF8</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">&quot;已创建基础设施定义: <span class="variable">$definitionFile</span>&quot;</span> <span class="literal">-ForegroundColor</span> Green</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$infrastructureDefinition</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> &#123;</span><br><span class="line">        <span class="built_in">Write-Error</span> <span class="string">&quot;创建基础设施定义时出错: <span class="variable">$_</span>&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>接下来，添加虚拟机资源定义：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 添加虚拟机资源定义</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Add-VMResource</span></span> &#123;</span><br><span class="line">    <span class="keyword">param</span>(</span><br><span class="line">        [<span class="type">Parameter</span>(<span class="type">Mandatory</span>, <span class="type">ValueFromPipeline</span>)]</span><br><span class="line">        [<span class="type">PSObject</span>]<span class="variable">$InfrastructureDefinition</span>,</span><br><span class="line">        </span><br><span class="line">        [<span class="type">Parameter</span>(<span class="type">Mandatory</span>)]</span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$VMName</span>,</span><br><span class="line">        </span><br><span class="line">        [<span class="type">Parameter</span>(<span class="type">Mandatory</span>)]</span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$Size</span>,</span><br><span class="line">        </span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$OSType</span> = <span class="string">&quot;Windows&quot;</span>,</span><br><span class="line">        </span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$OSVersion</span> = <span class="string">&quot;2022-Datacenter&quot;</span>,</span><br><span class="line">        </span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$NetworkName</span>,</span><br><span class="line">        </span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$SubnetName</span>,</span><br><span class="line">        </span><br><span class="line">        [<span class="built_in">hashtable</span>]<span class="variable">$Tags</span> = <span class="selector-tag">@</span>&#123;&#125;,</span><br><span class="line">        </span><br><span class="line">        [<span class="built_in">string</span>[]]<span class="variable">$DependsOn</span> = <span class="selector-tag">@</span>(),</span><br><span class="line">        </span><br><span class="line">        [<span class="built_in">hashtable</span>]<span class="variable">$Properties</span> = <span class="selector-tag">@</span>&#123;&#125;,</span><br><span class="line">        </span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$OutputPath</span></span><br><span class="line">    )</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">process</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment"># 创建VM定义</span></span><br><span class="line">            <span class="variable">$vmResource</span> = [<span class="type">PSCustomObject</span>]<span class="selector-tag">@</span>&#123;</span><br><span class="line">                Name = <span class="variable">$VMName</span></span><br><span class="line">                ResourceType = <span class="string">&quot;VirtualMachine&quot;</span></span><br><span class="line">                Size = <span class="variable">$Size</span></span><br><span class="line">                OSType = <span class="variable">$OSType</span></span><br><span class="line">                OSVersion = <span class="variable">$OSVersion</span></span><br><span class="line">                NetworkName = <span class="variable">$NetworkName</span></span><br><span class="line">                SubnetName = <span class="variable">$SubnetName</span></span><br><span class="line">                Tags = <span class="variable">$Tags</span></span><br><span class="line">                Properties = <span class="variable">$Properties</span></span><br><span class="line">                DependsOn = <span class="variable">$DependsOn</span></span><br><span class="line">                ResourceId = [<span class="type">guid</span>]::NewGuid().ToString()</span><br><span class="line">                CreatedOn = <span class="built_in">Get-Date</span></span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 添加到定义中</span></span><br><span class="line">            <span class="variable">$InfrastructureDefinition</span>.Resources.VirtualMachines += <span class="variable">$vmResource</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 添加依赖关系</span></span><br><span class="line">            <span class="keyword">foreach</span> (<span class="variable">$dependency</span> <span class="keyword">in</span> <span class="variable">$DependsOn</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="operator">-not</span> <span class="variable">$InfrastructureDefinition</span>.Dependencies.ContainsKey(<span class="variable">$VMName</span>)) &#123;</span><br><span class="line">                    <span class="variable">$InfrastructureDefinition</span>.Dependencies[<span class="variable">$VMName</span>] = <span class="selector-tag">@</span>()</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="variable">$InfrastructureDefinition</span>.Dependencies[<span class="variable">$VMName</span>] += <span class="variable">$dependency</span></span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 如果提供了输出路径，更新定义文件</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="variable">$OutputPath</span>) &#123;</span><br><span class="line">                <span class="variable">$definitionFile</span> = <span class="built_in">Join-Path</span> <span class="literal">-Path</span> <span class="variable">$OutputPath</span> <span class="literal">-ChildPath</span> <span class="string">&quot;<span class="variable">$</span>(<span class="variable">$InfrastructureDefinition</span>.EnvironmentName).json&quot;</span></span><br><span class="line">                <span class="variable">$InfrastructureDefinition</span> | <span class="built_in">ConvertTo-Json</span> <span class="literal">-Depth</span> <span class="number">10</span> | <span class="built_in">Out-File</span> <span class="literal">-FilePath</span> <span class="variable">$definitionFile</span> <span class="literal">-Encoding</span> UTF8</span><br><span class="line">                <span class="built_in">Write-Host</span> <span class="string">&quot;已更新基础设施定义: <span class="variable">$definitionFile</span>&quot;</span> <span class="literal">-ForegroundColor</span> Green</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">return</span> <span class="variable">$InfrastructureDefinition</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span> &#123;</span><br><span class="line">            <span class="built_in">Write-Error</span> <span class="string">&quot;添加虚拟机资源定义时出错: <span class="variable">$_</span>&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>添加网络资源定义：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 添加网络资源定义</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Add-NetworkResource</span></span> &#123;</span><br><span class="line">    <span class="keyword">param</span>(</span><br><span class="line">        [<span class="type">Parameter</span>(<span class="type">Mandatory</span>, <span class="type">ValueFromPipeline</span>)]</span><br><span class="line">        [<span class="type">PSObject</span>]<span class="variable">$InfrastructureDefinition</span>,</span><br><span class="line">        </span><br><span class="line">        [<span class="type">Parameter</span>(<span class="type">Mandatory</span>)]</span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$NetworkName</span>,</span><br><span class="line">        </span><br><span class="line">        [<span class="type">Parameter</span>(<span class="type">Mandatory</span>)]</span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$AddressSpace</span>,</span><br><span class="line">        </span><br><span class="line">        [<span class="type">Parameter</span>(<span class="type">Mandatory</span>)]</span><br><span class="line">        [<span class="type">PSObject</span>[]]<span class="variable">$Subnets</span>,</span><br><span class="line">        </span><br><span class="line">        [<span class="built_in">bool</span>]<span class="variable">$EnableDnsSupport</span> = <span class="variable">$true</span>,</span><br><span class="line">        </span><br><span class="line">        [<span class="built_in">hashtable</span>]<span class="variable">$Tags</span> = <span class="selector-tag">@</span>&#123;&#125;,</span><br><span class="line">        </span><br><span class="line">        [<span class="built_in">string</span>[]]<span class="variable">$DependsOn</span> = <span class="selector-tag">@</span>(),</span><br><span class="line">        </span><br><span class="line">        [<span class="built_in">hashtable</span>]<span class="variable">$Properties</span> = <span class="selector-tag">@</span>&#123;&#125;,</span><br><span class="line">        </span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$OutputPath</span></span><br><span class="line">    )</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">process</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment"># 创建网络定义</span></span><br><span class="line">            <span class="variable">$networkResource</span> = [<span class="type">PSCustomObject</span>]<span class="selector-tag">@</span>&#123;</span><br><span class="line">                Name = <span class="variable">$NetworkName</span></span><br><span class="line">                ResourceType = <span class="string">&quot;VirtualNetwork&quot;</span></span><br><span class="line">                AddressSpace = <span class="variable">$AddressSpace</span></span><br><span class="line">                Subnets = <span class="variable">$Subnets</span></span><br><span class="line">                EnableDnsSupport = <span class="variable">$EnableDnsSupport</span></span><br><span class="line">                Tags = <span class="variable">$Tags</span></span><br><span class="line">                Properties = <span class="variable">$Properties</span></span><br><span class="line">                DependsOn = <span class="variable">$DependsOn</span></span><br><span class="line">                ResourceId = [<span class="type">guid</span>]::NewGuid().ToString()</span><br><span class="line">                CreatedOn = <span class="built_in">Get-Date</span></span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 添加到定义中</span></span><br><span class="line">            <span class="variable">$InfrastructureDefinition</span>.Resources.NetworkResources += <span class="variable">$networkResource</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 添加依赖关系</span></span><br><span class="line">            <span class="keyword">foreach</span> (<span class="variable">$dependency</span> <span class="keyword">in</span> <span class="variable">$DependsOn</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="operator">-not</span> <span class="variable">$InfrastructureDefinition</span>.Dependencies.ContainsKey(<span class="variable">$NetworkName</span>)) &#123;</span><br><span class="line">                    <span class="variable">$InfrastructureDefinition</span>.Dependencies[<span class="variable">$NetworkName</span>] = <span class="selector-tag">@</span>()</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="variable">$InfrastructureDefinition</span>.Dependencies[<span class="variable">$NetworkName</span>] += <span class="variable">$dependency</span></span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 如果提供了输出路径，更新定义文件</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="variable">$OutputPath</span>) &#123;</span><br><span class="line">                <span class="variable">$definitionFile</span> = <span class="built_in">Join-Path</span> <span class="literal">-Path</span> <span class="variable">$OutputPath</span> <span class="literal">-ChildPath</span> <span class="string">&quot;<span class="variable">$</span>(<span class="variable">$InfrastructureDefinition</span>.EnvironmentName).json&quot;</span></span><br><span class="line">                <span class="variable">$InfrastructureDefinition</span> | <span class="built_in">ConvertTo-Json</span> <span class="literal">-Depth</span> <span class="number">10</span> | <span class="built_in">Out-File</span> <span class="literal">-FilePath</span> <span class="variable">$definitionFile</span> <span class="literal">-Encoding</span> UTF8</span><br><span class="line">                <span class="built_in">Write-Host</span> <span class="string">&quot;已更新基础设施定义: <span class="variable">$definitionFile</span>&quot;</span> <span class="literal">-ForegroundColor</span> Green</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">return</span> <span class="variable">$InfrastructureDefinition</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span> &#123;</span><br><span class="line">            <span class="built_in">Write-Error</span> <span class="string">&quot;添加网络资源定义时出错: <span class="variable">$_</span>&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>生成部署顺序：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 生成资源部署顺序</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Set-DeploymentOrder</span></span> &#123;</span><br><span class="line">    <span class="keyword">param</span>(</span><br><span class="line">        [<span class="type">Parameter</span>(<span class="type">Mandatory</span>, <span class="type">ValueFromPipeline</span>)]</span><br><span class="line">        [<span class="type">PSObject</span>]<span class="variable">$InfrastructureDefinition</span>,</span><br><span class="line">        </span><br><span class="line">        [<span class="type">switch</span>]<span class="variable">$Validate</span>,</span><br><span class="line">        </span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$OutputPath</span></span><br><span class="line">    )</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">process</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment"># 创建依赖图</span></span><br><span class="line">            <span class="variable">$dependencyGraph</span> = <span class="selector-tag">@</span>&#123;&#125;</span><br><span class="line">            <span class="variable">$resourceList</span> = <span class="selector-tag">@</span>()</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 收集所有资源</span></span><br><span class="line">            <span class="keyword">foreach</span> (<span class="variable">$vmResource</span> <span class="keyword">in</span> <span class="variable">$InfrastructureDefinition</span>.Resources.VirtualMachines) &#123;</span><br><span class="line">                <span class="variable">$resourceList</span> += <span class="variable">$vmResource</span>.Name</span><br><span class="line">                <span class="variable">$dependencyGraph</span>[<span class="variable">$vmResource</span><span class="type">.Name</span>] = <span class="variable">$vmResource</span>.DependsOn</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">foreach</span> (<span class="variable">$netResource</span> <span class="keyword">in</span> <span class="variable">$InfrastructureDefinition</span>.Resources.NetworkResources) &#123;</span><br><span class="line">                <span class="variable">$resourceList</span> += <span class="variable">$netResource</span>.Name</span><br><span class="line">                <span class="variable">$dependencyGraph</span>[<span class="variable">$netResource</span><span class="type">.Name</span>] = <span class="variable">$netResource</span>.DependsOn</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 添加其他资源类型...</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 检测循环依赖</span></span><br><span class="line">            <span class="variable">$visited</span> = <span class="selector-tag">@</span>&#123;&#125;</span><br><span class="line">            <span class="variable">$recStack</span> = <span class="selector-tag">@</span>&#123;&#125;</span><br><span class="line">            </span><br><span class="line">            <span class="function"><span class="keyword">function</span> <span class="title">Test-CyclicDependency</span></span> &#123;</span><br><span class="line">                <span class="keyword">param</span>([<span class="built_in">string</span>]<span class="variable">$Node</span>)</span><br><span class="line">                </span><br><span class="line">                <span class="variable">$visited</span>[<span class="variable">$Node</span>] = <span class="variable">$true</span></span><br><span class="line">                <span class="variable">$recStack</span>[<span class="variable">$Node</span>] = <span class="variable">$true</span></span><br><span class="line">                </span><br><span class="line">                <span class="keyword">foreach</span> (<span class="variable">$neighbor</span> <span class="keyword">in</span> <span class="variable">$dependencyGraph</span>[<span class="variable">$Node</span>]) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (<span class="operator">-not</span> <span class="variable">$visited</span>.ContainsKey(<span class="variable">$neighbor</span>)) &#123;</span><br><span class="line">                        <span class="keyword">if</span> (<span class="built_in">Test-CyclicDependency</span> <span class="literal">-Node</span> <span class="variable">$neighbor</span>) &#123;</span><br><span class="line">                            <span class="keyword">return</span> <span class="variable">$true</span></span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">elseif</span> (<span class="variable">$recStack</span>.ContainsKey(<span class="variable">$neighbor</span>)) &#123;</span><br><span class="line">                        <span class="keyword">return</span> <span class="variable">$true</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                </span><br><span class="line">                <span class="variable">$recStack</span>.Remove(<span class="variable">$Node</span>)</span><br><span class="line">                <span class="keyword">return</span> <span class="variable">$false</span></span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">foreach</span> (<span class="variable">$resource</span> <span class="keyword">in</span> <span class="variable">$resourceList</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="operator">-not</span> <span class="variable">$visited</span>.ContainsKey(<span class="variable">$resource</span>)) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (<span class="built_in">Test-CyclicDependency</span> <span class="literal">-Node</span> <span class="variable">$resource</span>) &#123;</span><br><span class="line">                        <span class="keyword">throw</span> <span class="string">&quot;检测到循环依赖关系。无法确定部署顺序。&quot;</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 拓扑排序</span></span><br><span class="line">            <span class="variable">$visited</span> = <span class="selector-tag">@</span>&#123;&#125;</span><br><span class="line">            <span class="variable">$deploymentOrder</span> = [<span class="type">System.Collections.ArrayList</span>]::new()</span><br><span class="line">            </span><br><span class="line">            <span class="function"><span class="keyword">function</span> <span class="title">Sort-Topology</span></span> &#123;</span><br><span class="line">                <span class="keyword">param</span>([<span class="built_in">string</span>]<span class="variable">$Node</span>)</span><br><span class="line">                </span><br><span class="line">                <span class="variable">$visited</span>[<span class="variable">$Node</span>] = <span class="variable">$true</span></span><br><span class="line">                </span><br><span class="line">                <span class="keyword">foreach</span> (<span class="variable">$neighbor</span> <span class="keyword">in</span> <span class="variable">$dependencyGraph</span>[<span class="variable">$Node</span>]) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (<span class="operator">-not</span> <span class="variable">$visited</span>.ContainsKey(<span class="variable">$neighbor</span>)) &#123;</span><br><span class="line">                        <span class="built_in">Sort-Topology</span> <span class="literal">-Node</span> <span class="variable">$neighbor</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                </span><br><span class="line">                <span class="variable">$deploymentOrder</span>.Add(<span class="variable">$Node</span>) | <span class="built_in">Out-Null</span></span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">foreach</span> (<span class="variable">$resource</span> <span class="keyword">in</span> <span class="variable">$resourceList</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="operator">-not</span> <span class="variable">$visited</span>.ContainsKey(<span class="variable">$resource</span>)) &#123;</span><br><span class="line">                    <span class="built_in">Sort-Topology</span> <span class="literal">-Node</span> <span class="variable">$resource</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 反转列表，因为我们需要先部署没有依赖的资源</span></span><br><span class="line">            [<span class="built_in">Array</span>]::Reverse(<span class="variable">$deploymentOrder</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 更新部署顺序</span></span><br><span class="line">            <span class="variable">$InfrastructureDefinition</span>.DeploymentOrder = <span class="variable">$deploymentOrder</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 验证部署顺序</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="variable">$Validate</span>) &#123;</span><br><span class="line">                <span class="built_in">Write-Host</span> <span class="string">&quot;验证部署顺序...&quot;</span> <span class="literal">-ForegroundColor</span> Yellow</span><br><span class="line">                <span class="variable">$deploymentSet</span> = <span class="selector-tag">@</span>&#123;&#125;</span><br><span class="line">                <span class="variable">$isValid</span> = <span class="variable">$true</span></span><br><span class="line">                </span><br><span class="line">                <span class="keyword">foreach</span> (<span class="variable">$resource</span> <span class="keyword">in</span> <span class="variable">$deploymentOrder</span>) &#123;</span><br><span class="line">                    <span class="keyword">foreach</span> (<span class="variable">$dependency</span> <span class="keyword">in</span> <span class="variable">$dependencyGraph</span>[<span class="variable">$resource</span>]) &#123;</span><br><span class="line">                        <span class="keyword">if</span> (<span class="operator">-not</span> <span class="variable">$deploymentSet</span>.ContainsKey(<span class="variable">$dependency</span>)) &#123;</span><br><span class="line">                            <span class="built_in">Write-Host</span> <span class="string">&quot;错误: 资源 &#x27;<span class="variable">$resource</span>&#x27; 依赖于 &#x27;<span class="variable">$dependency</span>&#x27;，但该资源尚未部署。&quot;</span> <span class="literal">-ForegroundColor</span> Red</span><br><span class="line">                            <span class="variable">$isValid</span> = <span class="variable">$false</span></span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="variable">$deploymentSet</span>[<span class="variable">$resource</span>] = <span class="variable">$true</span></span><br><span class="line">                &#125;</span><br><span class="line">                </span><br><span class="line">                <span class="keyword">if</span> (<span class="variable">$isValid</span>) &#123;</span><br><span class="line">                    <span class="built_in">Write-Host</span> <span class="string">&quot;部署顺序有效。&quot;</span> <span class="literal">-ForegroundColor</span> Green</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="string">&quot;部署顺序无效。请检查资源依赖关系。&quot;</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 如果提供了输出路径，更新定义文件</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="variable">$OutputPath</span>) &#123;</span><br><span class="line">                <span class="variable">$definitionFile</span> = <span class="built_in">Join-Path</span> <span class="literal">-Path</span> <span class="variable">$OutputPath</span> <span class="literal">-ChildPath</span> <span class="string">&quot;<span class="variable">$</span>(<span class="variable">$InfrastructureDefinition</span>.EnvironmentName).json&quot;</span></span><br><span class="line">                <span class="variable">$InfrastructureDefinition</span> | <span class="built_in">ConvertTo-Json</span> <span class="literal">-Depth</span> <span class="number">10</span> | <span class="built_in">Out-File</span> <span class="literal">-FilePath</span> <span class="variable">$definitionFile</span> <span class="literal">-Encoding</span> UTF8</span><br><span class="line">                <span class="built_in">Write-Host</span> <span class="string">&quot;已更新基础设施定义: <span class="variable">$definitionFile</span>&quot;</span> <span class="literal">-ForegroundColor</span> Green</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">return</span> <span class="variable">$InfrastructureDefinition</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span> &#123;</span><br><span class="line">            <span class="built_in">Write-Error</span> <span class="string">&quot;生成部署顺序时出错: <span class="variable">$_</span>&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>部署基础设施资源：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 部署基础设施资源</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Deploy-InfrastructureResource</span></span> &#123;</span><br><span class="line">    <span class="keyword">param</span>(</span><br><span class="line">        [<span class="type">Parameter</span>(<span class="type">Mandatory</span>)]</span><br><span class="line">        [<span class="type">PSObject</span>]<span class="variable">$Resource</span>,</span><br><span class="line">        </span><br><span class="line">        [<span class="type">Parameter</span>(<span class="type">Mandatory</span>)]</span><br><span class="line">        [<span class="type">PSObject</span>]<span class="variable">$InfrastructureDefinition</span>,</span><br><span class="line">        </span><br><span class="line">        [<span class="type">switch</span>]<span class="variable">$WhatIf</span>,</span><br><span class="line">        </span><br><span class="line">        [<span class="type">PSObject</span>]<span class="variable">$DeploymentContext</span> = <span class="selector-tag">@</span>&#123;&#125;</span><br><span class="line">    )</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="variable">$resourceName</span> = <span class="variable">$Resource</span>.Name</span><br><span class="line">        <span class="variable">$resourceType</span> = <span class="variable">$Resource</span>.ResourceType</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">&quot;开始部署资源: <span class="variable">$resourceName</span> (类型: <span class="variable">$resourceType</span>)&quot;</span> <span class="literal">-ForegroundColor</span> Cyan</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">switch</span> (<span class="variable">$resourceType</span>) &#123;</span><br><span class="line">            <span class="string">&quot;VirtualMachine&quot;</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="variable">$WhatIf</span>) &#123;</span><br><span class="line">                    <span class="built_in">Write-Host</span> <span class="string">&quot;[WhatIf] 将创建虚拟机 &#x27;<span class="variable">$resourceName</span>&#x27; (大小: <span class="variable">$</span>(<span class="variable">$Resource</span>.Size), OS: <span class="variable">$</span>(<span class="variable">$Resource</span>.OSType)-<span class="variable">$</span>(<span class="variable">$Resource</span>.OSVersion))&quot;</span> <span class="literal">-ForegroundColor</span> Yellow</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="comment"># 这里是虚拟机部署的实际代码</span></span><br><span class="line">                    <span class="comment"># 示例: 使用 Azure PowerShell 模块创建虚拟机</span></span><br><span class="line">                    <span class="built_in">Write-Host</span> <span class="string">&quot;正在创建虚拟机 &#x27;<span class="variable">$resourceName</span>&#x27;...&quot;</span> <span class="literal">-ForegroundColor</span> White</span><br><span class="line">                    </span><br><span class="line">                    <span class="comment"># 模拟部署</span></span><br><span class="line">                    <span class="built_in">Start-Sleep</span> <span class="literal">-Seconds</span> <span class="number">2</span></span><br><span class="line">                    </span><br><span class="line">                    <span class="comment"># 返回部署结果</span></span><br><span class="line">                    <span class="variable">$deploymentResult</span> = [<span class="type">PSCustomObject</span>]<span class="selector-tag">@</span>&#123;</span><br><span class="line">                        ResourceName = <span class="variable">$resourceName</span></span><br><span class="line">                        ResourceType = <span class="variable">$resourceType</span></span><br><span class="line">                        Status = <span class="string">&quot;Success&quot;</span></span><br><span class="line">                        DeploymentId = [<span class="type">guid</span>]::NewGuid().ToString()</span><br><span class="line">                        DeploymentTime = <span class="built_in">Get-Date</span></span><br><span class="line">                        Properties = <span class="selector-tag">@</span>&#123;</span><br><span class="line">                            IPAddress = <span class="string">&quot;10.0.0.<span class="variable">$</span>((Get-Random -Minimum 2 -Maximum 255))&quot;</span></span><br><span class="line">                            FQDN = <span class="string">&quot;<span class="variable">$resourceName</span>.example.com&quot;</span></span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    </span><br><span class="line">                    <span class="built_in">Write-Host</span> <span class="string">&quot;虚拟机 &#x27;<span class="variable">$resourceName</span>&#x27; 部署成功&quot;</span> <span class="literal">-ForegroundColor</span> Green</span><br><span class="line">                    <span class="keyword">return</span> <span class="variable">$deploymentResult</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="string">&quot;VirtualNetwork&quot;</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="variable">$WhatIf</span>) &#123;</span><br><span class="line">                    <span class="built_in">Write-Host</span> <span class="string">&quot;[WhatIf] 将创建虚拟网络 &#x27;<span class="variable">$resourceName</span>&#x27; (地址空间: <span class="variable">$</span>(<span class="variable">$Resource</span>.AddressSpace))&quot;</span> <span class="literal">-ForegroundColor</span> Yellow</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="comment"># 这里是虚拟网络部署的实际代码</span></span><br><span class="line">                    <span class="built_in">Write-Host</span> <span class="string">&quot;正在创建虚拟网络 &#x27;<span class="variable">$resourceName</span>&#x27;...&quot;</span> <span class="literal">-ForegroundColor</span> White</span><br><span class="line">                    </span><br><span class="line">                    <span class="comment"># 模拟部署</span></span><br><span class="line">                    <span class="built_in">Start-Sleep</span> <span class="literal">-Seconds</span> <span class="number">1</span></span><br><span class="line">                    </span><br><span class="line">                    <span class="comment"># 返回部署结果</span></span><br><span class="line">                    <span class="variable">$deploymentResult</span> = [<span class="type">PSCustomObject</span>]<span class="selector-tag">@</span>&#123;</span><br><span class="line">                        ResourceName = <span class="variable">$resourceName</span></span><br><span class="line">                        ResourceType = <span class="variable">$resourceType</span></span><br><span class="line">                        Status = <span class="string">&quot;Success&quot;</span></span><br><span class="line">                        DeploymentId = [<span class="type">guid</span>]::NewGuid().ToString()</span><br><span class="line">                        DeploymentTime = <span class="built_in">Get-Date</span></span><br><span class="line">                        Properties = <span class="selector-tag">@</span>&#123;</span><br><span class="line">                            AddressSpace = <span class="variable">$Resource</span>.AddressSpace</span><br><span class="line">                            SubnetCount = <span class="variable">$Resource</span>.Subnets.Count</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    </span><br><span class="line">                    <span class="built_in">Write-Host</span> <span class="string">&quot;虚拟网络 &#x27;<span class="variable">$resourceName</span>&#x27; 部署成功&quot;</span> <span class="literal">-ForegroundColor</span> Green</span><br><span class="line">                    <span class="keyword">return</span> <span class="variable">$deploymentResult</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            default &#123;</span><br><span class="line">                <span class="built_in">Write-Warning</span> <span class="string">&quot;不支持的资源类型: <span class="variable">$resourceType</span>&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$WhatIf</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> [<span class="type">PSCustomObject</span>]<span class="selector-tag">@</span>&#123;</span><br><span class="line">                ResourceName = <span class="variable">$resourceName</span></span><br><span class="line">                ResourceType = <span class="variable">$resourceType</span></span><br><span class="line">                Status = <span class="string">&quot;WhatIf&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> &#123;</span><br><span class="line">        <span class="built_in">Write-Error</span> <span class="string">&quot;部署资源 &#x27;<span class="variable">$resourceName</span>&#x27; 时出错: <span class="variable">$_</span>&quot;</span></span><br><span class="line">        <span class="keyword">return</span> [<span class="type">PSCustomObject</span>]<span class="selector-tag">@</span>&#123;</span><br><span class="line">            ResourceName = <span class="variable">$resourceName</span></span><br><span class="line">            ResourceType = <span class="variable">$resourceType</span></span><br><span class="line">            Status = <span class="string">&quot;Failed&quot;</span></span><br><span class="line">            Error = <span class="variable">$_</span>.ToString()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>执行完整基础设施部署：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 部署完整基础设施</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Deploy-Infrastructure</span></span> &#123;</span><br><span class="line">    <span class="keyword">param</span>(</span><br><span class="line">        [<span class="type">Parameter</span>(<span class="type">Mandatory</span>)]</span><br><span class="line">        [<span class="type">PSObject</span>]<span class="variable">$InfrastructureDefinition</span>,</span><br><span class="line">        </span><br><span class="line">        [<span class="type">switch</span>]<span class="variable">$WhatIf</span>,</span><br><span class="line">        </span><br><span class="line">        [<span class="type">switch</span>]<span class="variable">$Force</span>,</span><br><span class="line">        </span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$DeploymentLogPath</span>,</span><br><span class="line">        </span><br><span class="line">        [<span class="type">scriptblock</span>]<span class="variable">$OnSuccessAction</span>,</span><br><span class="line">        </span><br><span class="line">        [<span class="type">scriptblock</span>]<span class="variable">$OnFailureAction</span></span><br><span class="line">    )</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="variable">$environmentName</span> = <span class="variable">$InfrastructureDefinition</span>.EnvironmentName</span><br><span class="line">        <span class="variable">$deploymentResults</span> = <span class="selector-tag">@</span>()</span><br><span class="line">        <span class="variable">$deploymentContext</span> = <span class="selector-tag">@</span>&#123;&#125;</span><br><span class="line">        <span class="variable">$deploymentStart</span> = <span class="built_in">Get-Date</span></span><br><span class="line">        <span class="variable">$deploymentSuccess</span> = <span class="variable">$true</span></span><br><span class="line">        </span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">&quot;开始部署环境: <span class="variable">$environmentName</span>&quot;</span> <span class="literal">-ForegroundColor</span> Cyan</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 检查是否有部署顺序</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$InfrastructureDefinition</span>.DeploymentOrder.Count <span class="operator">-eq</span> <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="built_in">Write-Warning</span> <span class="string">&quot;部署顺序为空。正在尝试生成部署顺序...&quot;</span></span><br><span class="line">            <span class="variable">$InfrastructureDefinition</span> = <span class="built_in">Set-DeploymentOrder</span> <span class="literal">-InfrastructureDefinition</span> <span class="variable">$InfrastructureDefinition</span> <span class="literal">-Validate</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 创建资源映射</span></span><br><span class="line">        <span class="variable">$resourceMap</span> = <span class="selector-tag">@</span>&#123;&#125;</span><br><span class="line">        <span class="keyword">foreach</span> (<span class="variable">$vmResource</span> <span class="keyword">in</span> <span class="variable">$InfrastructureDefinition</span>.Resources.VirtualMachines) &#123;</span><br><span class="line">            <span class="variable">$resourceMap</span>[<span class="variable">$vmResource</span><span class="type">.Name</span>] = <span class="variable">$vmResource</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">foreach</span> (<span class="variable">$netResource</span> <span class="keyword">in</span> <span class="variable">$InfrastructureDefinition</span>.Resources.NetworkResources) &#123;</span><br><span class="line">            <span class="variable">$resourceMap</span>[<span class="variable">$netResource</span><span class="type">.Name</span>] = <span class="variable">$netResource</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 按照部署顺序部署资源</span></span><br><span class="line">        <span class="keyword">foreach</span> (<span class="variable">$resourceName</span> <span class="keyword">in</span> <span class="variable">$InfrastructureDefinition</span>.DeploymentOrder) &#123;</span><br><span class="line">            <span class="variable">$resource</span> = <span class="variable">$resourceMap</span><span class="function">[<span class="variable">$resourceName</span>]</span></span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (<span class="operator">-not</span> <span class="variable">$resource</span>) &#123;</span><br><span class="line">                <span class="built_in">Write-Warning</span> <span class="string">&quot;资源 &#x27;<span class="variable">$resourceName</span>&#x27; 在部署顺序中但未找到资源定义。跳过。&quot;</span></span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="variable">$result</span> = <span class="built_in">Deploy-InfrastructureResource</span> <span class="literal">-Resource</span> <span class="variable">$resource</span> <span class="literal">-InfrastructureDefinition</span> <span class="variable">$InfrastructureDefinition</span> <span class="literal">-WhatIf</span>:<span class="variable">$WhatIf</span> <span class="literal">-DeploymentContext</span> <span class="variable">$deploymentContext</span></span><br><span class="line">            <span class="variable">$deploymentResults</span> += <span class="variable">$result</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 如果部署失败且未强制继续，则终止部署</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="variable">$result</span>.Status <span class="operator">-eq</span> <span class="string">&quot;Failed&quot;</span> <span class="operator">-and</span> <span class="operator">-not</span> <span class="variable">$Force</span>) &#123;</span><br><span class="line">                <span class="built_in">Write-Error</span> <span class="string">&quot;资源 &#x27;<span class="variable">$resourceName</span>&#x27; 部署失败。终止部署。&quot;</span></span><br><span class="line">                <span class="variable">$deploymentSuccess</span> = <span class="variable">$false</span></span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 更新部署上下文</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="variable">$result</span>.Status <span class="operator">-eq</span> <span class="string">&quot;Success&quot;</span>) &#123;</span><br><span class="line">                <span class="variable">$deploymentContext</span>[<span class="variable">$resourceName</span>] = <span class="variable">$result</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="variable">$deploymentEnd</span> = <span class="built_in">Get-Date</span></span><br><span class="line">        <span class="variable">$deploymentDuration</span> = <span class="variable">$deploymentEnd</span> - <span class="variable">$deploymentStart</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 生成部署摘要</span></span><br><span class="line">        <span class="variable">$deploymentSummary</span> = [<span class="type">PSCustomObject</span>]<span class="selector-tag">@</span>&#123;</span><br><span class="line">            EnvironmentName = <span class="variable">$environmentName</span></span><br><span class="line">            StartTime = <span class="variable">$deploymentStart</span></span><br><span class="line">            EndTime = <span class="variable">$deploymentEnd</span></span><br><span class="line">            Duration = <span class="variable">$deploymentDuration</span></span><br><span class="line">            Status = <span class="keyword">if</span> (<span class="variable">$deploymentSuccess</span>) &#123; <span class="string">&quot;Success&quot;</span> &#125; <span class="keyword">else</span> &#123; <span class="string">&quot;Failed&quot;</span> &#125;</span><br><span class="line">            ResourceCount = <span class="variable">$deploymentResults</span>.Count</span><br><span class="line">            SuccessCount = (<span class="variable">$deploymentResults</span> | <span class="built_in">Where-Object</span> &#123; <span class="variable">$_</span>.Status <span class="operator">-eq</span> <span class="string">&quot;Success&quot;</span> &#125;).Count</span><br><span class="line">            FailedCount = (<span class="variable">$deploymentResults</span> | <span class="built_in">Where-Object</span> &#123; <span class="variable">$_</span>.Status <span class="operator">-eq</span> <span class="string">&quot;Failed&quot;</span> &#125;).Count</span><br><span class="line">            WhatIfCount = (<span class="variable">$deploymentResults</span> | <span class="built_in">Where-Object</span> &#123; <span class="variable">$_</span>.Status <span class="operator">-eq</span> <span class="string">&quot;WhatIf&quot;</span> &#125;).Count</span><br><span class="line">            DetailedResults = <span class="variable">$deploymentResults</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 保存部署日志</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$DeploymentLogPath</span>) &#123;</span><br><span class="line">            <span class="variable">$logFile</span> = <span class="built_in">Join-Path</span> <span class="literal">-Path</span> <span class="variable">$DeploymentLogPath</span> <span class="literal">-ChildPath</span> <span class="string">&quot;Deployment_<span class="variable">$environmentName</span>`_<span class="variable">$</span>(Get-Date -Format &#x27;yyyyMMdd_HHmmss&#x27;).json&quot;</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 创建目录（如果不存在）</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="operator">-not</span> (<span class="built_in">Test-Path</span> <span class="literal">-Path</span> <span class="variable">$DeploymentLogPath</span>)) &#123;</span><br><span class="line">                <span class="built_in">New-Item</span> <span class="literal">-Path</span> <span class="variable">$DeploymentLogPath</span> <span class="literal">-ItemType</span> Directory <span class="literal">-Force</span> | <span class="built_in">Out-Null</span></span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="variable">$deploymentSummary</span> | <span class="built_in">ConvertTo-Json</span> <span class="literal">-Depth</span> <span class="number">10</span> | <span class="built_in">Out-File</span> <span class="literal">-FilePath</span> <span class="variable">$logFile</span> <span class="literal">-Encoding</span> UTF8</span><br><span class="line">            <span class="built_in">Write-Host</span> <span class="string">&quot;部署日志已保存至: <span class="variable">$logFile</span>&quot;</span> <span class="literal">-ForegroundColor</span> Green</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 部署成功或失败时执行的操作</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$deploymentSuccess</span> <span class="operator">-and</span> <span class="variable">$OnSuccessAction</span>) &#123;</span><br><span class="line">            &amp; <span class="variable">$OnSuccessAction</span> <span class="literal">-DeploymentSummary</span> <span class="variable">$deploymentSummary</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">elseif</span> (<span class="operator">-not</span> <span class="variable">$deploymentSuccess</span> <span class="operator">-and</span> <span class="variable">$OnFailureAction</span>) &#123;</span><br><span class="line">            &amp; <span class="variable">$OnFailureAction</span> <span class="literal">-DeploymentSummary</span> <span class="variable">$deploymentSummary</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 输出部署摘要</span></span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">&quot;部署摘要:&quot;</span> <span class="literal">-ForegroundColor</span> Cyan</span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">&quot;  环境: <span class="variable">$environmentName</span>&quot;</span> <span class="literal">-ForegroundColor</span> White</span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">&quot;  状态: <span class="variable">$</span>(<span class="variable">$deploymentSummary</span>.Status)&quot;</span> <span class="literal">-ForegroundColor</span> <span class="variable">$</span>(<span class="keyword">if</span> (<span class="variable">$deploymentSummary</span>.Status <span class="operator">-eq</span> <span class="string">&quot;Success&quot;</span>) &#123; <span class="string">&quot;Green&quot;</span> &#125; <span class="keyword">else</span> &#123; <span class="string">&quot;Red&quot;</span> &#125;)</span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">&quot;  持续时间: <span class="variable">$</span>(<span class="variable">$deploymentDuration</span>.TotalMinutes) 分钟&quot;</span> <span class="literal">-ForegroundColor</span> White</span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">&quot;  资源总数: <span class="variable">$</span>(<span class="variable">$deploymentSummary</span>.ResourceCount)&quot;</span> <span class="literal">-ForegroundColor</span> White</span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">&quot;  成功: <span class="variable">$</span>(<span class="variable">$deploymentSummary</span>.SuccessCount)&quot;</span> <span class="literal">-ForegroundColor</span> Green</span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">&quot;  失败: <span class="variable">$</span>(<span class="variable">$deploymentSummary</span>.FailedCount)&quot;</span> <span class="literal">-ForegroundColor</span> <span class="variable">$</span>(<span class="keyword">if</span> (<span class="variable">$deploymentSummary</span>.FailedCount <span class="operator">-gt</span> <span class="number">0</span>) &#123; <span class="string">&quot;Red&quot;</span> &#125; <span class="keyword">else</span> &#123; <span class="string">&quot;White&quot;</span> &#125;)</span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">&quot;  WhatIf: <span class="variable">$</span>(<span class="variable">$deploymentSummary</span>.WhatIfCount)&quot;</span> <span class="literal">-ForegroundColor</span> Yellow</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$deploymentSummary</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> &#123;</span><br><span class="line">        <span class="built_in">Write-Error</span> <span class="string">&quot;部署环境 &#x27;<span class="variable">$environmentName</span>&#x27; 时出错: <span class="variable">$_</span>&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>现在，让我们看一个使用示例：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 定义输出路径</span></span><br><span class="line"><span class="variable">$outputPath</span> = <span class="string">&quot;C:\IaC\Definitions&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建一个新的环境定义</span></span><br><span class="line"><span class="variable">$envDef</span> = <span class="built_in">New-InfrastructureDefinition</span> <span class="literal">-EnvironmentName</span> <span class="string">&quot;DevTest&quot;</span> <span class="literal">-EnvironmentType</span> <span class="string">&quot;Development&quot;</span> <span class="literal">-OutputPath</span> <span class="variable">$outputPath</span> <span class="literal">-Description</span> <span class="string">&quot;开发测试环境&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加网络资源</span></span><br><span class="line"><span class="variable">$subnets</span> = <span class="selector-tag">@</span>(</span><br><span class="line">    [<span class="type">PSCustomObject</span>]<span class="selector-tag">@</span>&#123; Name = <span class="string">&quot;Frontend&quot;</span>; AddressPrefix = <span class="string">&quot;10.0.1.0/24&quot;</span> &#125;,</span><br><span class="line">    [<span class="type">PSCustomObject</span>]<span class="selector-tag">@</span>&#123; Name = <span class="string">&quot;Backend&quot;</span>; AddressPrefix = <span class="string">&quot;10.0.2.0/24&quot;</span> &#125;,</span><br><span class="line">    [<span class="type">PSCustomObject</span>]<span class="selector-tag">@</span>&#123; Name = <span class="string">&quot;Database&quot;</span>; AddressPrefix = <span class="string">&quot;10.0.3.0/24&quot;</span> &#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="variable">$envDef</span> = <span class="built_in">Add-NetworkResource</span> <span class="literal">-InfrastructureDefinition</span> <span class="variable">$envDef</span> <span class="literal">-NetworkName</span> <span class="string">&quot;DevVNet&quot;</span> <span class="literal">-AddressSpace</span> <span class="string">&quot;10.0.0.0/16&quot;</span> <span class="literal">-Subnets</span> <span class="variable">$subnets</span> <span class="literal">-OutputPath</span> <span class="variable">$outputPath</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加虚拟机资源</span></span><br><span class="line"><span class="variable">$envDef</span> = <span class="built_in">Add-VMResource</span> <span class="literal">-InfrastructureDefinition</span> <span class="variable">$envDef</span> <span class="literal">-VMName</span> <span class="string">&quot;WebServer01&quot;</span> <span class="literal">-Size</span> <span class="string">&quot;Standard_B2s&quot;</span> <span class="literal">-OSType</span> <span class="string">&quot;Windows&quot;</span> <span class="literal">-OSVersion</span> <span class="string">&quot;2022-Datacenter&quot;</span> <span class="literal">-NetworkName</span> <span class="string">&quot;DevVNet&quot;</span> <span class="literal">-SubnetName</span> <span class="string">&quot;Frontend&quot;</span> <span class="literal">-DependsOn</span> <span class="selector-tag">@</span>(<span class="string">&quot;DevVNet&quot;</span>) <span class="literal">-OutputPath</span> <span class="variable">$outputPath</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$envDef</span> = <span class="built_in">Add-VMResource</span> <span class="literal">-InfrastructureDefinition</span> <span class="variable">$envDef</span> <span class="literal">-VMName</span> <span class="string">&quot;AppServer01&quot;</span> <span class="literal">-Size</span> <span class="string">&quot;Standard_B2s&quot;</span> <span class="literal">-OSType</span> <span class="string">&quot;Windows&quot;</span> <span class="literal">-OSVersion</span> <span class="string">&quot;2022-Datacenter&quot;</span> <span class="literal">-NetworkName</span> <span class="string">&quot;DevVNet&quot;</span> <span class="literal">-SubnetName</span> <span class="string">&quot;Backend&quot;</span> <span class="literal">-DependsOn</span> <span class="selector-tag">@</span>(<span class="string">&quot;DevVNet&quot;</span>, <span class="string">&quot;WebServer01&quot;</span>) <span class="literal">-OutputPath</span> <span class="variable">$outputPath</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$envDef</span> = <span class="built_in">Add-VMResource</span> <span class="literal">-InfrastructureDefinition</span> <span class="variable">$envDef</span> <span class="literal">-VMName</span> <span class="string">&quot;DbServer01&quot;</span> <span class="literal">-Size</span> <span class="string">&quot;Standard_B2ms&quot;</span> <span class="literal">-OSType</span> <span class="string">&quot;Windows&quot;</span> <span class="literal">-OSVersion</span> <span class="string">&quot;2022-Datacenter&quot;</span> <span class="literal">-NetworkName</span> <span class="string">&quot;DevVNet&quot;</span> <span class="literal">-SubnetName</span> <span class="string">&quot;Database&quot;</span> <span class="literal">-DependsOn</span> <span class="selector-tag">@</span>(<span class="string">&quot;DevVNet&quot;</span>) <span class="literal">-OutputPath</span> <span class="variable">$outputPath</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 生成部署顺序</span></span><br><span class="line"><span class="variable">$envDef</span> = <span class="built_in">Set-DeploymentOrder</span> <span class="literal">-InfrastructureDefinition</span> <span class="variable">$envDef</span> <span class="literal">-Validate</span> <span class="literal">-OutputPath</span> <span class="variable">$outputPath</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 预览部署（WhatIf）</span></span><br><span class="line"><span class="variable">$deploymentPreview</span> = <span class="built_in">Deploy-Infrastructure</span> <span class="literal">-InfrastructureDefinition</span> <span class="variable">$envDef</span> <span class="literal">-WhatIf</span> <span class="literal">-DeploymentLogPath</span> <span class="string">&quot;C:\IaC\Logs&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 实际部署</span></span><br><span class="line"><span class="variable">$deploymentResult</span> = <span class="built_in">Deploy-Infrastructure</span> <span class="literal">-InfrastructureDefinition</span> <span class="variable">$envDef</span> <span class="literal">-DeploymentLogPath</span> <span class="string">&quot;C:\IaC\Logs&quot;</span></span><br></pre></td></tr></table></figure>

<p>这些PowerShell函数提供了一个强大的基础设施即代码解决方案，可以帮助自动化环境部署流程。随着基础设施复杂性的增加，您可以扩展这些函数来支持更多的资源类型和部署场景。结合版本控制系统如Git，这种方法能够确保环境配置的一致性和可重复性，从而提高IT运维的效率和可靠性。 </p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2025-02-27T00:00:00.000Z" title="2025/2/27 08:00:00">2025-02-27</time>发表</span><span class="level-item"><time dateTime="2025-03-25T09:40:56.407Z" title="2025/3/25 17:40:56">2025-03-25</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/powershell/">powershell</a><span> / </span><a class="link-muted" href="/categories/powershell/tip/">tip</a></span><span class="level-item">2 分钟读完 (大约322个字)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2025/02/27/powershell-cloudnative-config/">PowerShell 技能连载 - 云原生配置管理</a></h1><div class="content"><p>在云原生环境中，自动化资源配置管理至关重要。以下脚本实现Kubernetes部署模板生成与应用：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">New-K8sDeployment</span></span> &#123;</span><br><span class="line">    <span class="function">[<span class="type">CmdletBinding</span>()]</span></span><br><span class="line">    <span class="keyword">param</span>(</span><br><span class="line">        [<span class="type">Parameter</span>(<span class="type">Mandatory</span>=<span class="variable">$true</span>)]</span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$AppName</span>,</span><br><span class="line">        </span><br><span class="line">        [<span class="type">ValidateRange</span>(<span class="number">1</span>,<span class="number">10</span>)]</span><br><span class="line">        [<span class="built_in">int</span>]<span class="variable">$Replicas</span> = <span class="number">3</span>,</span><br><span class="line">        </span><br><span class="line">        [<span class="type">ValidateSet</span>(<span class="string">&#x27;development&#x27;</span>,<span class="string">&#x27;production&#x27;</span>)]</span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$Environment</span> = <span class="string">&#x27;production&#x27;</span></span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    <span class="variable">$yaml</span> = <span class="string">@&quot;</span></span><br><span class="line"><span class="string">apiVersion: apps/v1</span></span><br><span class="line"><span class="string">kind: Deployment</span></span><br><span class="line"><span class="string">metadata:</span></span><br><span class="line"><span class="string">  name: <span class="variable">$AppName</span>-<span class="variable">$Environment</span></span></span><br><span class="line"><span class="string">spec:</span></span><br><span class="line"><span class="string">  replicas: <span class="variable">$Replicas</span></span></span><br><span class="line"><span class="string">  selector:</span></span><br><span class="line"><span class="string">    matchLabels:</span></span><br><span class="line"><span class="string">      app: <span class="variable">$AppName</span></span></span><br><span class="line"><span class="string">  template:</span></span><br><span class="line"><span class="string">    metadata:</span></span><br><span class="line"><span class="string">      labels:</span></span><br><span class="line"><span class="string">        app: <span class="variable">$AppName</span></span></span><br><span class="line"><span class="string">        env: <span class="variable">$Environment</span></span></span><br><span class="line"><span class="string">    spec:</span></span><br><span class="line"><span class="string">      containers:</span></span><br><span class="line"><span class="string">      - name: <span class="variable">$AppName</span></span></span><br><span class="line"><span class="string">        image: registry/vichamp/<span class="variable">$AppName:latest</span></span></span><br><span class="line"><span class="string">        resources:</span></span><br><span class="line"><span class="string">          limits:</span></span><br><span class="line"><span class="string">            memory: &quot;512Mi&quot;</span></span><br><span class="line"><span class="string">            cpu: &quot;500m&quot;</span></span><br><span class="line"><span class="string">&quot;@</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="variable">$tempFile</span> = <span class="built_in">New-TemporaryFile</span></span><br><span class="line">        <span class="variable">$yaml</span> | <span class="built_in">Out-File</span> <span class="variable">$tempFile</span>.FullName</span><br><span class="line">        </span><br><span class="line">        kubectl apply <span class="operator">-f</span> <span class="variable">$tempFile</span>.FullName</span><br><span class="line">        </span><br><span class="line">        [<span class="type">PSCustomObject</span>]<span class="selector-tag">@</span>&#123;</span><br><span class="line">            AppName = <span class="variable">$AppName</span></span><br><span class="line">            Environment = <span class="variable">$Environment</span></span><br><span class="line">            Manifest = <span class="variable">$yaml</span></span><br><span class="line">            Status = <span class="string">&#x27;Applied&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> &#123;</span><br><span class="line">        <span class="built_in">Write-Error</span> <span class="string">&quot;Kubernetes部署失败: <span class="variable">$_</span>&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="built_in">Remove-Item</span> <span class="variable">$tempFile</span>.FullName <span class="literal">-ErrorAction</span> SilentlyContinue</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>实现原理：</p>
<ol>
<li>使用here-string动态生成标准YAML部署模板</li>
<li>通过环境参数控制副本数量和部署环境</li>
<li>自动创建临时文件执行kubectl apply命令</li>
<li>返回包含应用状态的定制对象</li>
<li>完善的错误处理与临时文件清理机制</li>
</ol>
<p>使用示例：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">New-K8sDeployment</span> <span class="literal">-AppName</span> <span class="string">&#x27;order-service&#x27;</span> <span class="literal">-Environment</span> <span class="string">&#x27;production&#x27;</span> <span class="literal">-Replicas</span> <span class="number">5</span></span><br></pre></td></tr></table></figure>

<p>最佳实践：</p>
<ol>
<li>与CI&#x2F;CD流水线集成实现自动部署</li>
<li>添加资源请求&#x2F;限制验证逻辑</li>
<li>实现部署历史版本回滚功能</li>
<li>集成Prometheus监控指标</li>
</ol>
<p>注意事项：<br>• 需要配置kubectl访问权限<br>• 建议添加YAML语法验证<br>• 生产环境需设置严格的资源限制</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2025-02-26T00:00:00.000Z" title="2025/2/26 08:00:00">2025-02-26</time>发表</span><span class="level-item"><time dateTime="2025-03-25T07:49:53.312Z" title="2025/3/25 15:49:53">2025-03-25</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/powershell/">powershell</a><span> / </span><a class="link-muted" href="/categories/powershell/tip/">tip</a></span><span class="level-item">4 分钟读完 (大约599个字)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2025/02/26/powershell-excel-processing/">PowerShell 技能连载 - Excel 处理技巧</a></h1><div class="content"><p>在 PowerShell 中处理 Excel 文件是一项常见任务，本文将介绍一些实用的 Excel 处理技巧。</p>
<p>首先，让我们看看基本的 Excel 操作：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建 Excel 信息获取函数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Get-ExcelInfo</span></span> &#123;</span><br><span class="line">    <span class="keyword">param</span>(</span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$ExcelPath</span></span><br><span class="line">    )</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="variable">$excel</span> = <span class="built_in">New-Object</span> <span class="literal">-ComObject</span> Excel.Application</span><br><span class="line">        <span class="variable">$excel</span>.Visible = <span class="variable">$false</span></span><br><span class="line">        <span class="variable">$workbook</span> = <span class="variable">$excel</span>.Workbooks.Open(<span class="variable">$ExcelPath</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="variable">$info</span> = [<span class="type">PSCustomObject</span>]<span class="selector-tag">@</span>&#123;</span><br><span class="line">            FileName = <span class="built_in">Split-Path</span> <span class="variable">$ExcelPath</span> <span class="literal">-Leaf</span></span><br><span class="line">            SheetCount = <span class="variable">$workbook</span>.Sheets.Count</span><br><span class="line">            SheetNames = <span class="variable">$workbook</span>.Sheets | <span class="built_in">ForEach-Object</span> &#123; <span class="variable">$_</span>.Name &#125;</span><br><span class="line">            UsedRange = <span class="variable">$workbook</span>.Sheets(<span class="number">1</span>).UsedRange.Address</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="variable">$workbook</span>.Close(<span class="variable">$false</span>)</span><br><span class="line">        <span class="variable">$excel</span>.Quit()</span><br><span class="line">        [<span class="type">System.Runtime.Interopservices.Marshal</span>]::ReleaseComObject(<span class="variable">$excel</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$info</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> &#123;</span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">&quot;获取 Excel 信息失败：<span class="variable">$_</span>&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Excel 数据导出：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建 Excel 数据导出函数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Export-ExcelData</span></span> &#123;</span><br><span class="line">    <span class="keyword">param</span>(</span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$InputPath</span>,</span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$OutputPath</span>,</span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$SheetName</span>,</span><br><span class="line">        [<span class="built_in">int</span>]<span class="variable">$StartRow</span> = <span class="number">1</span>,</span><br><span class="line">        [<span class="built_in">int</span>]<span class="variable">$EndRow</span></span><br><span class="line">    )</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="variable">$excel</span> = <span class="built_in">New-Object</span> <span class="literal">-ComObject</span> Excel.Application</span><br><span class="line">        <span class="variable">$excel</span>.Visible = <span class="variable">$false</span></span><br><span class="line">        <span class="variable">$workbook</span> = <span class="variable">$excel</span>.Workbooks.Open(<span class="variable">$InputPath</span>)</span><br><span class="line">        <span class="variable">$sheet</span> = <span class="variable">$workbook</span>.Sheets(<span class="variable">$SheetName</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (<span class="operator">-not</span> <span class="variable">$EndRow</span>) &#123;</span><br><span class="line">            <span class="variable">$EndRow</span> = <span class="variable">$sheet</span>.UsedRange.Rows.Count</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="variable">$data</span> = <span class="selector-tag">@</span>()</span><br><span class="line">        <span class="keyword">for</span> (<span class="variable">$row</span> = <span class="variable">$StartRow</span>; <span class="variable">$row</span> <span class="operator">-le</span> <span class="variable">$EndRow</span>; <span class="variable">$row</span>++) &#123;</span><br><span class="line">            <span class="variable">$rowData</span> = <span class="selector-tag">@</span>()</span><br><span class="line">            <span class="keyword">for</span> (<span class="variable">$col</span> = <span class="number">1</span>; <span class="variable">$col</span> <span class="operator">-le</span> <span class="variable">$sheet</span>.UsedRange.Columns.Count; <span class="variable">$col</span>++) &#123;</span><br><span class="line">                <span class="variable">$rowData</span> += <span class="variable">$sheet</span>.Cells(<span class="variable">$row</span>, <span class="variable">$col</span>).Text</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="variable">$data</span> += <span class="variable">$rowData</span> <span class="operator">-join</span> <span class="string">&quot;,&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="variable">$data</span> | <span class="built_in">Out-File</span> <span class="variable">$OutputPath</span> <span class="literal">-Encoding</span> UTF8</span><br><span class="line">        </span><br><span class="line">        <span class="variable">$workbook</span>.Close(<span class="variable">$false</span>)</span><br><span class="line">        <span class="variable">$excel</span>.Quit()</span><br><span class="line">        [<span class="type">System.Runtime.Interopservices.Marshal</span>]::ReleaseComObject(<span class="variable">$excel</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">&quot;数据导出完成：<span class="variable">$OutputPath</span>&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> &#123;</span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">&quot;导出失败：<span class="variable">$_</span>&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Excel 数据导入：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建 Excel 数据导入函数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Import-ExcelData</span></span> &#123;</span><br><span class="line">    <span class="keyword">param</span>(</span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$InputPath</span>,</span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$OutputPath</span>,</span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$SheetName</span> = <span class="string">&quot;Sheet1&quot;</span>,</span><br><span class="line">        [<span class="built_in">string</span>[]]<span class="variable">$Headers</span></span><br><span class="line">    )</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="variable">$excel</span> = <span class="built_in">New-Object</span> <span class="literal">-ComObject</span> Excel.Application</span><br><span class="line">        <span class="variable">$excel</span>.Visible = <span class="variable">$false</span></span><br><span class="line">        <span class="variable">$workbook</span> = <span class="variable">$excel</span>.Workbooks.Add()</span><br><span class="line">        <span class="variable">$sheet</span> = <span class="variable">$workbook</span>.Sheets(<span class="number">1</span>)</span><br><span class="line">        <span class="variable">$sheet</span>.Name = <span class="variable">$SheetName</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 写入表头</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> <span class="operator">-lt</span> <span class="variable">$Headers</span>.Count; <span class="variable">$i</span>++) &#123;</span><br><span class="line">            <span class="variable">$sheet</span>.Cells(<span class="number">1</span>, <span class="variable">$i</span> + <span class="number">1</span>) = <span class="variable">$Headers</span>[<span class="variable">$i</span>]</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 写入数据</span></span><br><span class="line">        <span class="variable">$row</span> = <span class="number">2</span></span><br><span class="line">        <span class="built_in">Get-Content</span> <span class="variable">$InputPath</span> | <span class="built_in">ForEach-Object</span> &#123;</span><br><span class="line">            <span class="variable">$values</span> = <span class="variable">$_</span> <span class="operator">-split</span> <span class="string">&quot;,&quot;</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="variable">$col</span> = <span class="number">0</span>; <span class="variable">$col</span> <span class="operator">-lt</span> <span class="variable">$values</span>.Count; <span class="variable">$col</span>++) &#123;</span><br><span class="line">                <span class="variable">$sheet</span>.Cells(<span class="variable">$row</span>, <span class="variable">$col</span> + <span class="number">1</span>) = <span class="variable">$values</span>[<span class="variable">$col</span>]</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="variable">$row</span>++</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 调整列宽</span></span><br><span class="line">        <span class="variable">$sheet</span>.UsedRange.EntireColumn.AutoFit()</span><br><span class="line">        </span><br><span class="line">        <span class="variable">$workbook</span>.SaveAs(<span class="variable">$OutputPath</span>)</span><br><span class="line">        <span class="variable">$workbook</span>.Close(<span class="variable">$true</span>)</span><br><span class="line">        <span class="variable">$excel</span>.Quit()</span><br><span class="line">        [<span class="type">System.Runtime.Interopservices.Marshal</span>]::ReleaseComObject(<span class="variable">$excel</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">&quot;数据导入完成：<span class="variable">$OutputPath</span>&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> &#123;</span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">&quot;导入失败：<span class="variable">$_</span>&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Excel 数据合并：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建 Excel 数据合并函数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Merge-ExcelData</span></span> &#123;</span><br><span class="line">    <span class="keyword">param</span>(</span><br><span class="line">        [<span class="built_in">string</span>[]]<span class="variable">$InputFiles</span>,</span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$OutputPath</span>,</span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$SheetName</span> = <span class="string">&quot;Sheet1&quot;</span></span><br><span class="line">    )</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="variable">$excel</span> = <span class="built_in">New-Object</span> <span class="literal">-ComObject</span> Excel.Application</span><br><span class="line">        <span class="variable">$excel</span>.Visible = <span class="variable">$false</span></span><br><span class="line">        <span class="variable">$workbook</span> = <span class="variable">$excel</span>.Workbooks.Add()</span><br><span class="line">        <span class="variable">$sheet</span> = <span class="variable">$workbook</span>.Sheets(<span class="number">1</span>)</span><br><span class="line">        <span class="variable">$sheet</span>.Name = <span class="variable">$SheetName</span></span><br><span class="line">        </span><br><span class="line">        <span class="variable">$currentRow</span> = <span class="number">1</span></span><br><span class="line">        <span class="variable">$headersWritten</span> = <span class="variable">$false</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">foreach</span> (<span class="variable">$file</span> <span class="keyword">in</span> <span class="variable">$InputFiles</span>) &#123;</span><br><span class="line">            <span class="variable">$sourceWorkbook</span> = <span class="variable">$excel</span>.Workbooks.Open(<span class="variable">$file</span>)</span><br><span class="line">            <span class="variable">$sourceSheet</span> = <span class="variable">$sourceWorkbook</span>.Sheets(<span class="number">1</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (<span class="operator">-not</span> <span class="variable">$headersWritten</span>) &#123;</span><br><span class="line">                <span class="comment"># 复制表头</span></span><br><span class="line">                <span class="variable">$sourceSheet</span>.Range(<span class="variable">$sourceSheet</span>.UsedRange.Rows(<span class="number">1</span>).Address).Copy(<span class="variable">$sheet</span>.Cells(<span class="variable">$currentRow</span>, <span class="number">1</span>))</span><br><span class="line">                <span class="variable">$headersWritten</span> = <span class="variable">$true</span></span><br><span class="line">                <span class="variable">$currentRow</span>++</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 复制数据</span></span><br><span class="line">            <span class="variable">$lastRow</span> = <span class="variable">$sourceSheet</span>.UsedRange.Rows.Count</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable">$lastRow</span> <span class="operator">-gt</span> <span class="number">1</span>) &#123;</span><br><span class="line">                <span class="variable">$sourceSheet</span>.Range(<span class="variable">$sourceSheet</span>.UsedRange.Rows(<span class="number">2</span>).Address + <span class="string">&quot;:&quot;</span> + <span class="variable">$sourceSheet</span>.UsedRange.Rows(<span class="variable">$lastRow</span>).Address).Copy(<span class="variable">$sheet</span>.Cells(<span class="variable">$currentRow</span>, <span class="number">1</span>))</span><br><span class="line">                <span class="variable">$currentRow</span> += <span class="variable">$lastRow</span> - <span class="number">1</span></span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="variable">$sourceWorkbook</span>.Close(<span class="variable">$false</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 调整列宽</span></span><br><span class="line">        <span class="variable">$sheet</span>.UsedRange.EntireColumn.AutoFit()</span><br><span class="line">        </span><br><span class="line">        <span class="variable">$workbook</span>.SaveAs(<span class="variable">$OutputPath</span>)</span><br><span class="line">        <span class="variable">$workbook</span>.Close(<span class="variable">$true</span>)</span><br><span class="line">        <span class="variable">$excel</span>.Quit()</span><br><span class="line">        [<span class="type">System.Runtime.Interopservices.Marshal</span>]::ReleaseComObject(<span class="variable">$excel</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">&quot;数据合并完成：<span class="variable">$OutputPath</span>&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> &#123;</span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">&quot;合并失败：<span class="variable">$_</span>&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这些技巧将帮助您更有效地处理 Excel 文件。记住，在处理 Excel 时，始终要注意内存管理和资源释放。同时，建议在处理大型 Excel 文件时使用流式处理方式，以提高性能。 </p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2025-02-25T00:00:00.000Z" title="2025/2/25 08:00:00">2025-02-25</time>发表</span><span class="level-item"><time dateTime="2025-03-25T10:13:05.181Z" title="2025/3/25 18:13:05">2025-03-25</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/powershell/">powershell</a><span> / </span><a class="link-muted" href="/categories/powershell/tip/">tip</a></span><span class="level-item">7 分钟读完 (大约990个字)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2025/02/25/powershell-asset-management/">PowerShell 技能连载 - 资产管理</a></h1><div class="content"><p>在系统管理中，资产管理对于确保资源的有效利用和成本控制至关重要。本文将介绍如何使用PowerShell构建一个资产管理系统，包括资产发现、跟踪和优化等功能。</p>
<h2 id="资产发现"><a href="#资产发现" class="headerlink" title="资产发现"></a>资产发现</h2><p>首先，让我们创建一个用于管理资产发现的函数：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Discover-SystemAssets</span></span> &#123;</span><br><span class="line">    <span class="function">[<span class="type">CmdletBinding</span>()]</span></span><br><span class="line">    <span class="keyword">param</span>(</span><br><span class="line">        [<span class="type">Parameter</span>(<span class="type">Mandatory</span> = <span class="variable">$true</span>)]</span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$DiscoveryID</span>,</span><br><span class="line">        </span><br><span class="line">        [<span class="type">Parameter</span>()]</span><br><span class="line">        [<span class="built_in">string</span>[]]<span class="variable">$AssetTypes</span>,</span><br><span class="line">        </span><br><span class="line">        [<span class="type">Parameter</span>()]</span><br><span class="line">        [<span class="type">ValidateSet</span>(<span class="string">&quot;Full&quot;</span>, <span class="string">&quot;Quick&quot;</span>, <span class="string">&quot;Custom&quot;</span>)]</span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$DiscoveryMode</span> = <span class="string">&quot;Full&quot;</span>,</span><br><span class="line">        </span><br><span class="line">        [<span class="type">Parameter</span>()]</span><br><span class="line">        [<span class="built_in">hashtable</span>]<span class="variable">$DiscoveryConfig</span>,</span><br><span class="line">        </span><br><span class="line">        [<span class="type">Parameter</span>()]</span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$LogPath</span></span><br><span class="line">    )</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="variable">$discoverer</span> = [<span class="type">PSCustomObject</span>]<span class="selector-tag">@</span>&#123;</span><br><span class="line">            DiscoveryID = <span class="variable">$DiscoveryID</span></span><br><span class="line">            StartTime = <span class="built_in">Get-Date</span></span><br><span class="line">            DiscoveryStatus = <span class="selector-tag">@</span>&#123;&#125;</span><br><span class="line">            Assets = <span class="selector-tag">@</span>&#123;&#125;</span><br><span class="line">            Issues = <span class="selector-tag">@</span>()</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 获取发现配置</span></span><br><span class="line">        <span class="variable">$config</span> = <span class="built_in">Get-DiscoveryConfig</span> <span class="literal">-DiscoveryID</span> <span class="variable">$DiscoveryID</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 管理发现</span></span><br><span class="line">        <span class="keyword">foreach</span> (<span class="variable">$type</span> <span class="keyword">in</span> <span class="variable">$AssetTypes</span>) &#123;</span><br><span class="line">            <span class="variable">$status</span> = [<span class="type">PSCustomObject</span>]<span class="selector-tag">@</span>&#123;</span><br><span class="line">                <span class="built_in">Type</span> = <span class="variable">$type</span></span><br><span class="line">                Status = <span class="string">&quot;Unknown&quot;</span></span><br><span class="line">                Config = <span class="selector-tag">@</span>&#123;&#125;</span><br><span class="line">                Assets = <span class="selector-tag">@</span>&#123;&#125;</span><br><span class="line">                Issues = <span class="selector-tag">@</span>()</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 应用发现配置</span></span><br><span class="line">            <span class="variable">$typeConfig</span> = Apply<span class="literal">-DiscoveryConfig</span> `</span><br><span class="line">                <span class="literal">-Config</span> <span class="variable">$config</span> `</span><br><span class="line">                <span class="literal">-Type</span> <span class="variable">$type</span> `</span><br><span class="line">                <span class="literal">-Mode</span> <span class="variable">$DiscoveryMode</span> `</span><br><span class="line">                <span class="literal">-Settings</span> <span class="variable">$DiscoveryConfig</span></span><br><span class="line">            </span><br><span class="line">            <span class="variable">$status</span>.Config = <span class="variable">$typeConfig</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 发现系统资产</span></span><br><span class="line">            <span class="variable">$assets</span> = Discover<span class="literal">-AssetInventory</span> `</span><br><span class="line">                <span class="literal">-Type</span> <span class="variable">$type</span> `</span><br><span class="line">                <span class="literal">-Config</span> <span class="variable">$typeConfig</span></span><br><span class="line">            </span><br><span class="line">            <span class="variable">$status</span>.Assets = <span class="variable">$assets</span></span><br><span class="line">            <span class="variable">$discoverer</span>.Assets[<span class="variable">$type</span>] = <span class="variable">$assets</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 检查资产问题</span></span><br><span class="line">            <span class="variable">$issues</span> = Check<span class="literal">-AssetIssues</span> `</span><br><span class="line">                <span class="literal">-Assets</span> <span class="variable">$assets</span> `</span><br><span class="line">                <span class="literal">-Config</span> <span class="variable">$typeConfig</span></span><br><span class="line">            </span><br><span class="line">            <span class="variable">$status</span>.Issues = <span class="variable">$issues</span></span><br><span class="line">            <span class="variable">$discoverer</span>.Issues += <span class="variable">$issues</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 更新发现状态</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="variable">$issues</span>.Count <span class="operator">-gt</span> <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="variable">$status</span>.Status = <span class="string">&quot;Warning&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="variable">$status</span>.Status = <span class="string">&quot;Success&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="variable">$discoverer</span>.DiscoveryStatus[<span class="variable">$type</span>] = <span class="variable">$status</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 记录发现日志</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$LogPath</span>) &#123;</span><br><span class="line">            <span class="variable">$discoverer</span> | <span class="built_in">ConvertTo-Json</span> <span class="literal">-Depth</span> <span class="number">10</span> | <span class="built_in">Out-File</span> <span class="literal">-FilePath</span> <span class="variable">$LogPath</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 更新发现器状态</span></span><br><span class="line">        <span class="variable">$discoverer</span>.EndTime = <span class="built_in">Get-Date</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$discoverer</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> &#123;</span><br><span class="line">        <span class="built_in">Write-Error</span> <span class="string">&quot;资产发现失败：<span class="variable">$_</span>&quot;</span></span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$null</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="资产跟踪"><a href="#资产跟踪" class="headerlink" title="资产跟踪"></a>资产跟踪</h2><p>接下来，创建一个用于管理资产跟踪的函数：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Track-SystemAssets</span></span> &#123;</span><br><span class="line">    <span class="function">[<span class="type">CmdletBinding</span>()]</span></span><br><span class="line">    <span class="keyword">param</span>(</span><br><span class="line">        [<span class="type">Parameter</span>(<span class="type">Mandatory</span> = <span class="variable">$true</span>)]</span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$TrackingID</span>,</span><br><span class="line">        </span><br><span class="line">        [<span class="type">Parameter</span>()]</span><br><span class="line">        [<span class="built_in">string</span>[]]<span class="variable">$TrackingTypes</span>,</span><br><span class="line">        </span><br><span class="line">        [<span class="type">Parameter</span>()]</span><br><span class="line">        [<span class="type">ValidateSet</span>(<span class="string">&quot;Usage&quot;</span>, <span class="string">&quot;Cost&quot;</span>, <span class="string">&quot;Lifecycle&quot;</span>)]</span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$TrackingMode</span> = <span class="string">&quot;Usage&quot;</span>,</span><br><span class="line">        </span><br><span class="line">        [<span class="type">Parameter</span>()]</span><br><span class="line">        [<span class="built_in">hashtable</span>]<span class="variable">$TrackingConfig</span>,</span><br><span class="line">        </span><br><span class="line">        [<span class="type">Parameter</span>()]</span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$ReportPath</span></span><br><span class="line">    )</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="variable">$tracker</span> = [<span class="type">PSCustomObject</span>]<span class="selector-tag">@</span>&#123;</span><br><span class="line">            TrackingID = <span class="variable">$TrackingID</span></span><br><span class="line">            StartTime = <span class="built_in">Get-Date</span></span><br><span class="line">            TrackingStatus = <span class="selector-tag">@</span>&#123;&#125;</span><br><span class="line">            Tracking = <span class="selector-tag">@</span>&#123;&#125;</span><br><span class="line">            Metrics = <span class="selector-tag">@</span>()</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 获取跟踪配置</span></span><br><span class="line">        <span class="variable">$config</span> = <span class="built_in">Get-TrackingConfig</span> <span class="literal">-TrackingID</span> <span class="variable">$TrackingID</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 管理跟踪</span></span><br><span class="line">        <span class="keyword">foreach</span> (<span class="variable">$type</span> <span class="keyword">in</span> <span class="variable">$TrackingTypes</span>) &#123;</span><br><span class="line">            <span class="variable">$status</span> = [<span class="type">PSCustomObject</span>]<span class="selector-tag">@</span>&#123;</span><br><span class="line">                <span class="built_in">Type</span> = <span class="variable">$type</span></span><br><span class="line">                Status = <span class="string">&quot;Unknown&quot;</span></span><br><span class="line">                Config = <span class="selector-tag">@</span>&#123;&#125;</span><br><span class="line">                Tracking = <span class="selector-tag">@</span>&#123;&#125;</span><br><span class="line">                Metrics = <span class="selector-tag">@</span>()</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 应用跟踪配置</span></span><br><span class="line">            <span class="variable">$typeConfig</span> = Apply<span class="literal">-TrackingConfig</span> `</span><br><span class="line">                <span class="literal">-Config</span> <span class="variable">$config</span> `</span><br><span class="line">                <span class="literal">-Type</span> <span class="variable">$type</span> `</span><br><span class="line">                <span class="literal">-Mode</span> <span class="variable">$TrackingMode</span> `</span><br><span class="line">                <span class="literal">-Settings</span> <span class="variable">$TrackingConfig</span></span><br><span class="line">            </span><br><span class="line">            <span class="variable">$status</span>.Config = <span class="variable">$typeConfig</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 跟踪系统资产</span></span><br><span class="line">            <span class="variable">$tracking</span> = Track<span class="literal">-AssetMetrics</span> `</span><br><span class="line">                <span class="literal">-Type</span> <span class="variable">$type</span> `</span><br><span class="line">                <span class="literal">-Config</span> <span class="variable">$typeConfig</span></span><br><span class="line">            </span><br><span class="line">            <span class="variable">$status</span>.Tracking = <span class="variable">$tracking</span></span><br><span class="line">            <span class="variable">$tracker</span>.Tracking[<span class="variable">$type</span>] = <span class="variable">$tracking</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 生成跟踪指标</span></span><br><span class="line">            <span class="variable">$metrics</span> = Generate<span class="literal">-TrackingMetrics</span> `</span><br><span class="line">                <span class="literal">-Tracking</span> <span class="variable">$tracking</span> `</span><br><span class="line">                <span class="literal">-Config</span> <span class="variable">$typeConfig</span></span><br><span class="line">            </span><br><span class="line">            <span class="variable">$status</span>.Metrics = <span class="variable">$metrics</span></span><br><span class="line">            <span class="variable">$tracker</span>.Metrics += <span class="variable">$metrics</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 更新跟踪状态</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="variable">$metrics</span>.Count <span class="operator">-gt</span> <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="variable">$status</span>.Status = <span class="string">&quot;Active&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="variable">$status</span>.Status = <span class="string">&quot;Inactive&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="variable">$tracker</span>.TrackingStatus[<span class="variable">$type</span>] = <span class="variable">$status</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 生成报告</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$ReportPath</span>) &#123;</span><br><span class="line">            <span class="variable">$report</span> = Generate<span class="literal">-TrackingReport</span> `</span><br><span class="line">                <span class="literal">-Tracker</span> <span class="variable">$tracker</span> `</span><br><span class="line">                <span class="literal">-Config</span> <span class="variable">$config</span></span><br><span class="line">            </span><br><span class="line">            <span class="variable">$report</span> | <span class="built_in">ConvertTo-Json</span> <span class="literal">-Depth</span> <span class="number">10</span> | <span class="built_in">Out-File</span> <span class="literal">-FilePath</span> <span class="variable">$ReportPath</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 更新跟踪器状态</span></span><br><span class="line">        <span class="variable">$tracker</span>.EndTime = <span class="built_in">Get-Date</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$tracker</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> &#123;</span><br><span class="line">        <span class="built_in">Write-Error</span> <span class="string">&quot;资产跟踪失败：<span class="variable">$_</span>&quot;</span></span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$null</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="资产优化"><a href="#资产优化" class="headerlink" title="资产优化"></a>资产优化</h2><p>最后，创建一个用于管理资产优化的函数：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Optimize-SystemAssets</span></span> &#123;</span><br><span class="line">    <span class="function">[<span class="type">CmdletBinding</span>()]</span></span><br><span class="line">    <span class="keyword">param</span>(</span><br><span class="line">        [<span class="type">Parameter</span>(<span class="type">Mandatory</span> = <span class="variable">$true</span>)]</span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$OptimizationID</span>,</span><br><span class="line">        </span><br><span class="line">        [<span class="type">Parameter</span>()]</span><br><span class="line">        [<span class="built_in">string</span>[]]<span class="variable">$OptimizationTypes</span>,</span><br><span class="line">        </span><br><span class="line">        [<span class="type">Parameter</span>()]</span><br><span class="line">        [<span class="type">ValidateSet</span>(<span class="string">&quot;Cost&quot;</span>, <span class="string">&quot;Performance&quot;</span>, <span class="string">&quot;Utilization&quot;</span>)]</span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$OptimizationMode</span> = <span class="string">&quot;Cost&quot;</span>,</span><br><span class="line">        </span><br><span class="line">        [<span class="type">Parameter</span>()]</span><br><span class="line">        [<span class="built_in">hashtable</span>]<span class="variable">$OptimizationConfig</span>,</span><br><span class="line">        </span><br><span class="line">        [<span class="type">Parameter</span>()]</span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$ReportPath</span></span><br><span class="line">    )</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="variable">$optimizer</span> = [<span class="type">PSCustomObject</span>]<span class="selector-tag">@</span>&#123;</span><br><span class="line">            OptimizationID = <span class="variable">$OptimizationID</span></span><br><span class="line">            StartTime = <span class="built_in">Get-Date</span></span><br><span class="line">            OptimizationStatus = <span class="selector-tag">@</span>&#123;&#125;</span><br><span class="line">            Optimizations = <span class="selector-tag">@</span>&#123;&#125;</span><br><span class="line">            Actions = <span class="selector-tag">@</span>()</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 获取优化配置</span></span><br><span class="line">        <span class="variable">$config</span> = <span class="built_in">Get-OptimizationConfig</span> <span class="literal">-OptimizationID</span> <span class="variable">$OptimizationID</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 管理优化</span></span><br><span class="line">        <span class="keyword">foreach</span> (<span class="variable">$type</span> <span class="keyword">in</span> <span class="variable">$OptimizationTypes</span>) &#123;</span><br><span class="line">            <span class="variable">$status</span> = [<span class="type">PSCustomObject</span>]<span class="selector-tag">@</span>&#123;</span><br><span class="line">                <span class="built_in">Type</span> = <span class="variable">$type</span></span><br><span class="line">                Status = <span class="string">&quot;Unknown&quot;</span></span><br><span class="line">                Config = <span class="selector-tag">@</span>&#123;&#125;</span><br><span class="line">                Optimizations = <span class="selector-tag">@</span>&#123;&#125;</span><br><span class="line">                Actions = <span class="selector-tag">@</span>()</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 应用优化配置</span></span><br><span class="line">            <span class="variable">$typeConfig</span> = Apply<span class="literal">-OptimizationConfig</span> `</span><br><span class="line">                <span class="literal">-Config</span> <span class="variable">$config</span> `</span><br><span class="line">                <span class="literal">-Type</span> <span class="variable">$type</span> `</span><br><span class="line">                <span class="literal">-Mode</span> <span class="variable">$OptimizationMode</span> `</span><br><span class="line">                <span class="literal">-Settings</span> <span class="variable">$OptimizationConfig</span></span><br><span class="line">            </span><br><span class="line">            <span class="variable">$status</span>.Config = <span class="variable">$typeConfig</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 优化系统资产</span></span><br><span class="line">            <span class="variable">$optimizations</span> = <span class="built_in">Optimize-AssetUsage</span> `</span><br><span class="line">                <span class="literal">-Type</span> <span class="variable">$type</span> `</span><br><span class="line">                <span class="literal">-Config</span> <span class="variable">$typeConfig</span></span><br><span class="line">            </span><br><span class="line">            <span class="variable">$status</span>.Optimizations = <span class="variable">$optimizations</span></span><br><span class="line">            <span class="variable">$optimizer</span>.Optimizations[<span class="variable">$type</span>] = <span class="variable">$optimizations</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 执行优化动作</span></span><br><span class="line">            <span class="variable">$actions</span> = Execute<span class="literal">-OptimizationActions</span> `</span><br><span class="line">                <span class="literal">-Optimizations</span> <span class="variable">$optimizations</span> `</span><br><span class="line">                <span class="literal">-Config</span> <span class="variable">$typeConfig</span></span><br><span class="line">            </span><br><span class="line">            <span class="variable">$status</span>.Actions = <span class="variable">$actions</span></span><br><span class="line">            <span class="variable">$optimizer</span>.Actions += <span class="variable">$actions</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 更新优化状态</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="variable">$actions</span>.Count <span class="operator">-gt</span> <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="variable">$status</span>.Status = <span class="string">&quot;Optimized&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="variable">$status</span>.Status = <span class="string">&quot;NoAction&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="variable">$optimizer</span>.OptimizationStatus[<span class="variable">$type</span>] = <span class="variable">$status</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 生成报告</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$ReportPath</span>) &#123;</span><br><span class="line">            <span class="variable">$report</span> = Generate<span class="literal">-OptimizationReport</span> `</span><br><span class="line">                <span class="literal">-Optimizer</span> <span class="variable">$optimizer</span> `</span><br><span class="line">                <span class="literal">-Config</span> <span class="variable">$config</span></span><br><span class="line">            </span><br><span class="line">            <span class="variable">$report</span> | <span class="built_in">ConvertTo-Json</span> <span class="literal">-Depth</span> <span class="number">10</span> | <span class="built_in">Out-File</span> <span class="literal">-FilePath</span> <span class="variable">$ReportPath</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 更新优化器状态</span></span><br><span class="line">        <span class="variable">$optimizer</span>.EndTime = <span class="built_in">Get-Date</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$optimizer</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> &#123;</span><br><span class="line">        <span class="built_in">Write-Error</span> <span class="string">&quot;资产优化失败：<span class="variable">$_</span>&quot;</span></span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$null</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="使用示例"><a href="#使用示例" class="headerlink" title="使用示例"></a>使用示例</h2><p>以下是如何使用这些函数来管理资产的示例：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 发现系统资产</span></span><br><span class="line"><span class="variable">$discoverer</span> = Discover<span class="literal">-SystemAssets</span> <span class="literal">-DiscoveryID</span> <span class="string">&quot;DISCOVERY001&quot;</span> `</span><br><span class="line">    <span class="literal">-AssetTypes</span> <span class="selector-tag">@</span>(<span class="string">&quot;Hardware&quot;</span>, <span class="string">&quot;Software&quot;</span>, <span class="string">&quot;Network&quot;</span>, <span class="string">&quot;Storage&quot;</span>) `</span><br><span class="line">    <span class="literal">-DiscoveryMode</span> <span class="string">&quot;Full&quot;</span> `</span><br><span class="line">    <span class="literal">-DiscoveryConfig</span> <span class="selector-tag">@</span>&#123;</span><br><span class="line">        <span class="string">&quot;Hardware&quot;</span> = <span class="selector-tag">@</span>&#123;</span><br><span class="line">            <span class="string">&quot;Categories&quot;</span> = <span class="selector-tag">@</span>(<span class="string">&quot;Server&quot;</span>, <span class="string">&quot;Desktop&quot;</span>, <span class="string">&quot;Mobile&quot;</span>)</span><br><span class="line">            <span class="string">&quot;Attributes&quot;</span> = <span class="selector-tag">@</span>(<span class="string">&quot;CPU&quot;</span>, <span class="string">&quot;Memory&quot;</span>, <span class="string">&quot;Storage&quot;</span>)</span><br><span class="line">            <span class="string">&quot;Filter&quot;</span> = <span class="string">&quot;Status = Active&quot;</span></span><br><span class="line">            <span class="string">&quot;Retention&quot;</span> = <span class="number">7</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="string">&quot;Software&quot;</span> = <span class="selector-tag">@</span>&#123;</span><br><span class="line">            <span class="string">&quot;Categories&quot;</span> = <span class="selector-tag">@</span>(<span class="string">&quot;OS&quot;</span>, <span class="string">&quot;Application&quot;</span>, <span class="string">&quot;Driver&quot;</span>)</span><br><span class="line">            <span class="string">&quot;Attributes&quot;</span> = <span class="selector-tag">@</span>(<span class="string">&quot;Version&quot;</span>, <span class="string">&quot;License&quot;</span>, <span class="string">&quot;InstallDate&quot;</span>)</span><br><span class="line">            <span class="string">&quot;Filter&quot;</span> = <span class="string">&quot;Status = Installed&quot;</span></span><br><span class="line">            <span class="string">&quot;Retention&quot;</span> = <span class="number">7</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="string">&quot;Network&quot;</span> = <span class="selector-tag">@</span>&#123;</span><br><span class="line">            <span class="string">&quot;Categories&quot;</span> = <span class="selector-tag">@</span>(<span class="string">&quot;Device&quot;</span>, <span class="string">&quot;Connection&quot;</span>, <span class="string">&quot;Protocol&quot;</span>)</span><br><span class="line">            <span class="string">&quot;Attributes&quot;</span> = <span class="selector-tag">@</span>(<span class="string">&quot;IP&quot;</span>, <span class="string">&quot;MAC&quot;</span>, <span class="string">&quot;Speed&quot;</span>)</span><br><span class="line">            <span class="string">&quot;Filter&quot;</span> = <span class="string">&quot;Status = Connected&quot;</span></span><br><span class="line">            <span class="string">&quot;Retention&quot;</span> = <span class="number">7</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="string">&quot;Storage&quot;</span> = <span class="selector-tag">@</span>&#123;</span><br><span class="line">            <span class="string">&quot;Categories&quot;</span> = <span class="selector-tag">@</span>(<span class="string">&quot;Disk&quot;</span>, <span class="string">&quot;Volume&quot;</span>, <span class="string">&quot;Share&quot;</span>)</span><br><span class="line">            <span class="string">&quot;Attributes&quot;</span> = <span class="selector-tag">@</span>(<span class="string">&quot;Size&quot;</span>, <span class="string">&quot;Free&quot;</span>, <span class="string">&quot;Type&quot;</span>)</span><br><span class="line">            <span class="string">&quot;Filter&quot;</span> = <span class="string">&quot;Status = Online&quot;</span></span><br><span class="line">            <span class="string">&quot;Retention&quot;</span> = <span class="number">7</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125; `</span><br><span class="line">    <span class="literal">-LogPath</span> <span class="string">&quot;C:\Logs\asset_discovery.json&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 跟踪系统资产</span></span><br><span class="line"><span class="variable">$tracker</span> = Track<span class="literal">-SystemAssets</span> <span class="literal">-TrackingID</span> <span class="string">&quot;TRACKING001&quot;</span> `</span><br><span class="line">    <span class="literal">-TrackingTypes</span> <span class="selector-tag">@</span>(<span class="string">&quot;Usage&quot;</span>, <span class="string">&quot;Cost&quot;</span>, <span class="string">&quot;Lifecycle&quot;</span>) `</span><br><span class="line">    <span class="literal">-TrackingMode</span> <span class="string">&quot;Usage&quot;</span> `</span><br><span class="line">    <span class="literal">-TrackingConfig</span> <span class="selector-tag">@</span>&#123;</span><br><span class="line">        <span class="string">&quot;Usage&quot;</span> = <span class="selector-tag">@</span>&#123;</span><br><span class="line">            <span class="string">&quot;Metrics&quot;</span> = <span class="selector-tag">@</span>(<span class="string">&quot;CPU&quot;</span>, <span class="string">&quot;Memory&quot;</span>, <span class="string">&quot;Storage&quot;</span>, <span class="string">&quot;Network&quot;</span>)</span><br><span class="line">            <span class="string">&quot;Threshold&quot;</span> = <span class="number">80</span></span><br><span class="line">            <span class="string">&quot;Interval&quot;</span> = <span class="number">60</span></span><br><span class="line">            <span class="string">&quot;Report&quot;</span> = <span class="variable">$true</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="string">&quot;Cost&quot;</span> = <span class="selector-tag">@</span>&#123;</span><br><span class="line">            <span class="string">&quot;Metrics&quot;</span> = <span class="selector-tag">@</span>(<span class="string">&quot;License&quot;</span>, <span class="string">&quot;Maintenance&quot;</span>, <span class="string">&quot;Support&quot;</span>)</span><br><span class="line">            <span class="string">&quot;Threshold&quot;</span> = <span class="number">1000</span></span><br><span class="line">            <span class="string">&quot;Interval&quot;</span> = <span class="number">30</span></span><br><span class="line">            <span class="string">&quot;Report&quot;</span> = <span class="variable">$true</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="string">&quot;Lifecycle&quot;</span> = <span class="selector-tag">@</span>&#123;</span><br><span class="line">            <span class="string">&quot;Metrics&quot;</span> = <span class="selector-tag">@</span>(<span class="string">&quot;Age&quot;</span>, <span class="string">&quot;Warranty&quot;</span>, <span class="string">&quot;Depreciation&quot;</span>)</span><br><span class="line">            <span class="string">&quot;Threshold&quot;</span> = <span class="number">365</span></span><br><span class="line">            <span class="string">&quot;Interval&quot;</span> = <span class="number">90</span></span><br><span class="line">            <span class="string">&quot;Report&quot;</span> = <span class="variable">$true</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125; `</span><br><span class="line">    <span class="literal">-ReportPath</span> <span class="string">&quot;C:\Reports\asset_tracking.json&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 优化系统资产</span></span><br><span class="line"><span class="variable">$optimizer</span> = <span class="built_in">Optimize-SystemAssets</span> <span class="literal">-OptimizationID</span> <span class="string">&quot;OPTIMIZATION001&quot;</span> `</span><br><span class="line">    <span class="literal">-OptimizationTypes</span> <span class="selector-tag">@</span>(<span class="string">&quot;Cost&quot;</span>, <span class="string">&quot;Performance&quot;</span>, <span class="string">&quot;Utilization&quot;</span>) `</span><br><span class="line">    <span class="literal">-OptimizationMode</span> <span class="string">&quot;Cost&quot;</span> `</span><br><span class="line">    <span class="literal">-OptimizationConfig</span> <span class="selector-tag">@</span>&#123;</span><br><span class="line">        <span class="string">&quot;Cost&quot;</span> = <span class="selector-tag">@</span>&#123;</span><br><span class="line">            <span class="string">&quot;Metrics&quot;</span> = <span class="selector-tag">@</span>(<span class="string">&quot;License&quot;</span>, <span class="string">&quot;Maintenance&quot;</span>, <span class="string">&quot;Support&quot;</span>)</span><br><span class="line">            <span class="string">&quot;Threshold&quot;</span> = <span class="number">1000</span></span><br><span class="line">            <span class="string">&quot;Actions&quot;</span> = <span class="selector-tag">@</span>(<span class="string">&quot;Renew&quot;</span>, <span class="string">&quot;Upgrade&quot;</span>, <span class="string">&quot;Terminate&quot;</span>)</span><br><span class="line">            <span class="string">&quot;Report&quot;</span> = <span class="variable">$true</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="string">&quot;Performance&quot;</span> = <span class="selector-tag">@</span>&#123;</span><br><span class="line">            <span class="string">&quot;Metrics&quot;</span> = <span class="selector-tag">@</span>(<span class="string">&quot;CPU&quot;</span>, <span class="string">&quot;Memory&quot;</span>, <span class="string">&quot;Storage&quot;</span>, <span class="string">&quot;Network&quot;</span>)</span><br><span class="line">            <span class="string">&quot;Threshold&quot;</span> = <span class="number">80</span></span><br><span class="line">            <span class="string">&quot;Actions&quot;</span> = <span class="selector-tag">@</span>(<span class="string">&quot;Scale&quot;</span>, <span class="string">&quot;Upgrade&quot;</span>, <span class="string">&quot;Migrate&quot;</span>)</span><br><span class="line">            <span class="string">&quot;Report&quot;</span> = <span class="variable">$true</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="string">&quot;Utilization&quot;</span> = <span class="selector-tag">@</span>&#123;</span><br><span class="line">            <span class="string">&quot;Metrics&quot;</span> = <span class="selector-tag">@</span>(<span class="string">&quot;Usage&quot;</span>, <span class="string">&quot;Efficiency&quot;</span>, <span class="string">&quot;Availability&quot;</span>)</span><br><span class="line">            <span class="string">&quot;Threshold&quot;</span> = <span class="number">60</span></span><br><span class="line">            <span class="string">&quot;Actions&quot;</span> = <span class="selector-tag">@</span>(<span class="string">&quot;Consolidate&quot;</span>, <span class="string">&quot;Optimize&quot;</span>, <span class="string">&quot;Decommission&quot;</span>)</span><br><span class="line">            <span class="string">&quot;Report&quot;</span> = <span class="variable">$true</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125; `</span><br><span class="line">    <span class="literal">-ReportPath</span> <span class="string">&quot;C:\Reports\asset_optimization.json&quot;</span></span><br></pre></td></tr></table></figure>

<h2 id="最佳实践"><a href="#最佳实践" class="headerlink" title="最佳实践"></a>最佳实践</h2><ol>
<li>实施资产发现</li>
<li>跟踪资产使用</li>
<li>优化资产利用</li>
<li>保持详细的资产记录</li>
<li>定期进行资产评估</li>
<li>实施优化策略</li>
<li>建立成本控制</li>
<li>保持系统文档更新</li>
</ol>
</div></article></div><nav class="pagination" role="navigation" aria-label="pagination"><div class="pagination-previous"><a href="/categories/powershell/">上一页</a></div><div class="pagination-next"><a href="/categories/powershell/page/3/">下一页</a></div><ul class="pagination-list is-hidden-mobile"><li><a class="pagination-link" href="/categories/powershell/">1</a></li><li><a class="pagination-link is-current" href="/categories/powershell/page/2/">2</a></li><li><a class="pagination-link" href="/categories/powershell/page/3/">3</a></li><li><span class="pagination-ellipsis">&hellip;</span></li><li><a class="pagination-link" href="/categories/powershell/page/216/">216</a></li></ul></nav></div><div class="column column-left is-4-tablet is-4-desktop is-4-widescreen  order-1 is-sticky"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar" src="https://www.gravatar.com/avatar/2dd950aaf78f980772660e4a37eb409c?s=128" alt="吴波"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">吴波</p><p class="is-size-6 is-block">Full Stack Developer</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>Fuzhou, China</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">文章</p><a href="/archives"><p class="title">2193</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">分类</p><a href="/categories"><p class="title">63</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">标签</p><a href="/tags"><p class="title">207</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/victorwoo" target="_blank" rel="noopener">关注我</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/victorwoo"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Facebook" href="https://www.facebook.com/vichampcn"><i class="fab fa-facebook"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Twitter" href="https://twitter.com/victorwoo"><i class="fab fa-twitter"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Dribbble" href="https://dribbble.com"><i class="fab fa-dribbble"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="RSS" href="/atom.xml"><i class="fas fa-rss"></i></a></div></div></div><!--!--><div class="card widget" data-type="links"><div class="card-content"><div class="menu"><h3 class="menu-label">链接</h3><ul class="menu-list"><li><a class="level is-mobile" href="https://github.com/PowerShell/PowerShell" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">PowerShell</span></span><span class="level-right"><span class="level-item tag">github.com</span></span></a></li><li><a class="level is-mobile" href="https://learn.microsoft.com/zh-cn/powershell/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">PowerShell 文档</span></span><span class="level-right"><span class="level-item tag">learn.microsoft.com</span></span></a></li><li><a class="level is-mobile" href="https://www.powershellgallery.com/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">PowerShell Gallery</span></span><span class="level-right"><span class="level-item tag">www.powershellgallery.com</span></span></a></li></ul></div></div></div><div class="card widget" data-type="categories"><div class="card-content"><div class="menu"><h3 class="menu-label">分类</h3><ul class="menu-list"><li><a class="level is-mobile" href="/categories/C/"><span class="level-start"><span class="level-item">C#</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/angularjs/"><span class="level-start"><span class="level-item">angularjs</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/career/"><span class="level-start"><span class="level-item">career</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/design/"><span class="level-start"><span class="level-item">design</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/embedded/"><span class="level-start"><span class="level-item">embedded</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/geek/"><span class="level-start"><span class="level-item">geek</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/git/"><span class="level-start"><span class="level-item">git</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/ionic/"><span class="level-start"><span class="level-item">ionic</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/javascript/"><span class="level-start"><span class="level-item">javascript</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li><li><a class="level is-mobile" href="/categories/markdown/"><span class="level-start"><span class="level-item">markdown</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/mongoose/"><span class="level-start"><span class="level-item">mongoose</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/mvp/"><span class="level-start"><span class="level-item">mvp</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/network/"><span class="level-start"><span class="level-item">network</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/node-js/"><span class="level-start"><span class="level-item">node.js</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/nodejs/"><span class="level-start"><span class="level-item">nodejs</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/powershell/"><span class="level-start"><span class="level-item">powershell</span></span><span class="level-end"><span class="level-item tag">2153</span></span></a><ul><li><a class="level is-mobile" href="/categories/powershell/advanced-scripting/"><span class="level-start"><span class="level-item">advanced-scripting</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/powershell/ai/"><span class="level-start"><span class="level-item">ai</span></span><span class="level-end"><span class="level-item tag">7</span></span></a><ul><li><a class="level is-mobile" href="/categories/powershell/ai/automation/"><span class="level-start"><span class="level-item">automation</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/powershell/automation/"><span class="level-start"><span class="level-item">automation</span></span><span class="level-end"><span class="level-item tag">1</span></span></a><ul><li><a class="level is-mobile" href="/categories/powershell/automation/ai/"><span class="level-start"><span class="level-item">ai</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/powershell/azure/"><span class="level-start"><span class="level-item">azure</span></span><span class="level-end"><span class="level-item tag">2</span></span></a><ul><li><a class="level is-mobile" href="/categories/powershell/azure/devops/"><span class="level-start"><span class="level-item">devops</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/powershell/azure/security/"><span class="level-start"><span class="level-item">security</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/powershell/basic/"><span class="level-start"><span class="level-item">basic</span></span><span class="level-end"><span class="level-item tag">28</span></span></a></li><li><a class="level is-mobile" href="/categories/powershell/blockchain/"><span class="level-start"><span class="level-item">blockchain</span></span><span class="level-end"><span class="level-item tag">1</span></span></a><ul><li><a class="level is-mobile" href="/categories/powershell/blockchain/automation/"><span class="level-start"><span class="level-item">automation</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/powershell/cloud/"><span class="level-start"><span class="level-item">cloud</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li><li><a class="level is-mobile" href="/categories/powershell/core-mechanism/"><span class="level-start"><span class="level-item">core-mechanism</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/powershell/cross-platform/"><span class="level-start"><span class="level-item">cross-platform</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/powershell/data/"><span class="level-start"><span class="level-item">data</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/powershell/data-processing/"><span class="level-start"><span class="level-item">data-processing</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/powershell/debugging/"><span class="level-start"><span class="level-item">debugging</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/powershell/development/"><span class="level-start"><span class="level-item">development</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/powershell/devops/"><span class="level-start"><span class="level-item">devops</span></span><span class="level-end"><span class="level-item tag">4</span></span></a><ul><li><a class="level is-mobile" href="/categories/powershell/devops/kubernetes/"><span class="level-start"><span class="level-item">kubernetes</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/powershell/emerging-tech/"><span class="level-start"><span class="level-item">emerging-tech</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/powershell/energy/"><span class="level-start"><span class="level-item">energy</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/powershell/geek/"><span class="level-start"><span class="level-item">geek</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/powershell/iot/"><span class="level-start"><span class="level-item">iot</span></span><span class="level-end"><span class="level-item tag">2</span></span></a><ul><li><a class="level is-mobile" href="/categories/powershell/iot/automation/"><span class="level-start"><span class="level-item">automation</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/powershell/module-system/"><span class="level-start"><span class="level-item">module-system</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/powershell/office/"><span class="level-start"><span class="level-item">office</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li><li><a class="level is-mobile" href="/categories/powershell/office365/"><span class="level-start"><span class="level-item">office365</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/powershell/performance/"><span class="level-start"><span class="level-item">performance</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/powershell/remote-scripting/"><span class="level-start"><span class="level-item">remote-scripting</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/powershell/scripting/"><span class="level-start"><span class="level-item">scripting</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li><li><a class="level is-mobile" href="/categories/powershell/security/"><span class="level-start"><span class="level-item">security</span></span><span class="level-end"><span class="level-item tag">13</span></span></a><ul><li><a class="level is-mobile" href="/categories/powershell/security/automation/"><span class="level-start"><span class="level-item">automation</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/powershell/security/azure/"><span class="level-start"><span class="level-item">azure</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/powershell/security/devops/"><span class="level-start"><span class="level-item">devops</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/powershell/system/"><span class="level-start"><span class="level-item">system</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/powershell/system-administration/"><span class="level-start"><span class="level-item">system-administration</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/powershell/text/"><span class="level-start"><span class="level-item">text</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li><li><a class="level is-mobile" href="/categories/powershell/tip/"><span class="level-start"><span class="level-item">tip</span></span><span class="level-end"><span class="level-item tag">1980</span></span></a></li><li><a class="level is-mobile" href="/categories/powershell/web-services/"><span class="level-start"><span class="level-item">web-services</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/program/"><span class="level-start"><span class="level-item">program</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/server/"><span class="level-start"><span class="level-item">server</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/software-engineering/"><span class="level-start"><span class="level-item">software-engineering</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/text/"><span class="level-start"><span class="level-item">text</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/vim/"><span class="level-start"><span class="level-item">vim</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/visualstudio/"><span class="level-start"><span class="level-item">visualstudio</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/web/"><span class="level-start"><span class="level-item">web</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li></ul></div></div></div><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">最新文章</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2025-03-25T16:00:00.000Z">2025-03-26</time></p><p class="title"><a href="/2025/03/26/blog-index/">PowerShell 博客文章汇总 (2024-04 ~ 2025-03)</a></p><p class="categories"><a href="/categories/powershell/">powershell</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2025-03-25T00:00:00.000Z">2025-03-25</time></p><p class="title"><a href="/2025/03/25/powershell-image-processing/">PowerShell 技能连载 - 图像处理技巧</a></p><p class="categories"><a href="/categories/powershell/">powershell</a> / <a href="/categories/powershell/tip/">tip</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2025-03-24T00:00:00.000Z">2025-03-24</time></p><p class="title"><a href="/2025/03/24/powershell-pipeline-filtering/">PowerShell管道过滤机制实战解析</a></p><p class="categories"><a href="/categories/powershell/">powershell</a> / <a href="/categories/powershell/basic/">basic</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2025-03-21T00:00:00.000Z">2025-03-21</time></p><p class="title"><a href="/2025/03/21/powershell-education-device-sync/">PowerShell 技能连载 - 教育设备同步系统</a></p><p class="categories"><a href="/categories/powershell/">powershell</a> / <a href="/categories/powershell/tip/">tip</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2025-03-20T00:00:00.000Z">2025-03-20</time></p><p class="title"><a href="/2025/03/20/powershell-network-operations/">PowerShell 技能连载 - 网络操作技巧</a></p><p class="categories"><a href="/categories/powershell/">powershell</a> / <a href="/categories/powershell/tip/">tip</a></p></div></article></div></div><div class="card widget" data-type="archives"><div class="card-content"><div class="menu"><h3 class="menu-label">归档</h3><ul class="menu-list"><li><a class="level is-mobile" href="/archives/2025/03/"><span class="level-start"><span class="level-item">三月 2025</span></span><span class="level-end"><span class="level-item tag">16</span></span></a></li><li><a class="level is-mobile" href="/archives/2025/02/"><span class="level-start"><span class="level-item">二月 2025</span></span><span class="level-end"><span class="level-item tag">20</span></span></a></li><li><a class="level is-mobile" href="/archives/2025/01/"><span class="level-start"><span class="level-item">一月 2025</span></span><span class="level-end"><span class="level-item tag">21</span></span></a></li><li><a class="level is-mobile" href="/archives/2024/12/"><span class="level-start"><span class="level-item">十二月 2024</span></span><span class="level-end"><span class="level-item tag">20</span></span></a></li><li><a class="level is-mobile" href="/archives/2024/11/"><span class="level-start"><span class="level-item">十一月 2024</span></span><span class="level-end"><span class="level-item tag">17</span></span></a></li><li><a class="level is-mobile" href="/archives/2024/10/"><span class="level-start"><span class="level-item">十月 2024</span></span><span class="level-end"><span class="level-item tag">20</span></span></a></li><li><a class="level is-mobile" href="/archives/2024/09/"><span class="level-start"><span class="level-item">九月 2024</span></span><span class="level-end"><span class="level-item tag">21</span></span></a></li><li><a class="level is-mobile" href="/archives/2024/08/"><span class="level-start"><span class="level-item">八月 2024</span></span><span class="level-end"><span class="level-item tag">19</span></span></a></li><li><a class="level is-mobile" href="/archives/2024/07/"><span class="level-start"><span class="level-item">七月 2024</span></span><span class="level-end"><span class="level-item tag">18</span></span></a></li><li><a class="level is-mobile" href="/archives/2024/06/"><span class="level-start"><span class="level-item">六月 2024</span></span><span class="level-end"><span class="level-item tag">17</span></span></a></li><li><a class="level is-mobile" href="/archives/2024/05/"><span class="level-start"><span class="level-item">五月 2024</span></span><span class="level-end"><span class="level-item tag">23</span></span></a></li><li><a class="level is-mobile" href="/archives/2024/04/"><span class="level-start"><span class="level-item">四月 2024</span></span><span class="level-end"><span class="level-item tag">25</span></span></a></li><li><a class="level is-mobile" href="/archives/2024/03/"><span class="level-start"><span class="level-item">三月 2024</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li><li><a class="level is-mobile" href="/archives/2024/02/"><span class="level-start"><span class="level-item">二月 2024</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2024/01/"><span class="level-start"><span class="level-item">一月 2024</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/11/"><span class="level-start"><span class="level-item">十一月 2023</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/10/"><span class="level-start"><span class="level-item">十月 2023</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/08/"><span class="level-start"><span class="level-item">八月 2023</span></span><span class="level-end"><span class="level-item tag">8</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/07/"><span class="level-start"><span class="level-item">七月 2023</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/06/"><span class="level-start"><span class="level-item">六月 2023</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/05/"><span class="level-start"><span class="level-item">五月 2023</span></span><span class="level-end"><span class="level-item tag">14</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/04/"><span class="level-start"><span class="level-item">四月 2023</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/03/"><span class="level-start"><span class="level-item">三月 2023</span></span><span class="level-end"><span class="level-item tag">9</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/02/"><span class="level-start"><span class="level-item">二月 2023</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/01/"><span class="level-start"><span class="level-item">一月 2023</span></span><span class="level-end"><span class="level-item tag">12</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/11/"><span class="level-start"><span class="level-item">十一月 2022</span></span><span class="level-end"><span class="level-item tag">8</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/10/"><span class="level-start"><span class="level-item">十月 2022</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/09/"><span class="level-start"><span class="level-item">九月 2022</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/08/"><span class="level-start"><span class="level-item">八月 2022</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/07/"><span class="level-start"><span class="level-item">七月 2022</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/06/"><span class="level-start"><span class="level-item">六月 2022</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/05/"><span class="level-start"><span class="level-item">五月 2022</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/04/"><span class="level-start"><span class="level-item">四月 2022</span></span><span class="level-end"><span class="level-item tag">10</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/03/"><span class="level-start"><span class="level-item">三月 2022</span></span><span class="level-end"><span class="level-item tag">16</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/02/"><span class="level-start"><span class="level-item">二月 2022</span></span><span class="level-end"><span class="level-item tag">10</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/01/"><span class="level-start"><span class="level-item">一月 2022</span></span><span class="level-end"><span class="level-item tag">10</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/12/"><span class="level-start"><span class="level-item">十二月 2021</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/11/"><span class="level-start"><span class="level-item">十一月 2021</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/10/"><span class="level-start"><span class="level-item">十月 2021</span></span><span class="level-end"><span class="level-item tag">10</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/09/"><span class="level-start"><span class="level-item">九月 2021</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/08/"><span class="level-start"><span class="level-item">八月 2021</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/07/"><span class="level-start"><span class="level-item">七月 2021</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/06/"><span class="level-start"><span class="level-item">六月 2021</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/05/"><span class="level-start"><span class="level-item">五月 2021</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/04/"><span class="level-start"><span class="level-item">四月 2021</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/03/"><span class="level-start"><span class="level-item">三月 2021</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/02/"><span class="level-start"><span class="level-item">二月 2021</span></span><span class="level-end"><span class="level-item tag">10</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/01/"><span class="level-start"><span class="level-item">一月 2021</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/12/"><span class="level-start"><span class="level-item">十二月 2020</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/11/"><span class="level-start"><span class="level-item">十一月 2020</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/10/"><span class="level-start"><span class="level-item">十月 2020</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/09/"><span class="level-start"><span class="level-item">九月 2020</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/08/"><span class="level-start"><span class="level-item">八月 2020</span></span><span class="level-end"><span class="level-item tag">10</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/07/"><span class="level-start"><span class="level-item">七月 2020</span></span><span class="level-end"><span class="level-item tag">12</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/06/"><span class="level-start"><span class="level-item">六月 2020</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/05/"><span class="level-start"><span class="level-item">五月 2020</span></span><span class="level-end"><span class="level-item tag">10</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/04/"><span class="level-start"><span class="level-item">四月 2020</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/03/"><span class="level-start"><span class="level-item">三月 2020</span></span><span class="level-end"><span class="level-item tag">12</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/02/"><span class="level-start"><span class="level-item">二月 2020</span></span><span class="level-end"><span class="level-item tag">10</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/01/"><span class="level-start"><span class="level-item">一月 2020</span></span><span class="level-end"><span class="level-item tag">12</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/12/"><span class="level-start"><span class="level-item">十二月 2019</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/11/"><span class="level-start"><span class="level-item">十一月 2019</span></span><span class="level-end"><span class="level-item tag">10</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/10/"><span class="level-start"><span class="level-item">十月 2019</span></span><span class="level-end"><span class="level-item tag">12</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/09/"><span class="level-start"><span class="level-item">九月 2019</span></span><span class="level-end"><span class="level-item tag">10</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/08/"><span class="level-start"><span class="level-item">八月 2019</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/07/"><span class="level-start"><span class="level-item">七月 2019</span></span><span class="level-end"><span class="level-item tag">12</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/06/"><span class="level-start"><span class="level-item">六月 2019</span></span><span class="level-end"><span class="level-item tag">20</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/05/"><span class="level-start"><span class="level-item">五月 2019</span></span><span class="level-end"><span class="level-item tag">23</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/04/"><span class="level-start"><span class="level-item">四月 2019</span></span><span class="level-end"><span class="level-item tag">22</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/03/"><span class="level-start"><span class="level-item">三月 2019</span></span><span class="level-end"><span class="level-item tag">22</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/02/"><span class="level-start"><span class="level-item">二月 2019</span></span><span class="level-end"><span class="level-item tag">20</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/01/"><span class="level-start"><span class="level-item">一月 2019</span></span><span class="level-end"><span class="level-item tag">23</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/12/"><span class="level-start"><span class="level-item">十二月 2018</span></span><span class="level-end"><span class="level-item tag">21</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/11/"><span class="level-start"><span class="level-item">十一月 2018</span></span><span class="level-end"><span class="level-item tag">22</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/10/"><span class="level-start"><span class="level-item">十月 2018</span></span><span class="level-end"><span class="level-item tag">23</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/09/"><span class="level-start"><span class="level-item">九月 2018</span></span><span class="level-end"><span class="level-item tag">20</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/08/"><span class="level-start"><span class="level-item">八月 2018</span></span><span class="level-end"><span class="level-item tag">23</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/07/"><span class="level-start"><span class="level-item">七月 2018</span></span><span class="level-end"><span class="level-item tag">22</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/06/"><span class="level-start"><span class="level-item">六月 2018</span></span><span class="level-end"><span class="level-item tag">21</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/05/"><span class="level-start"><span class="level-item">五月 2018</span></span><span class="level-end"><span class="level-item tag">23</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/04/"><span class="level-start"><span class="level-item">四月 2018</span></span><span class="level-end"><span class="level-item tag">21</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/03/"><span class="level-start"><span class="level-item">三月 2018</span></span><span class="level-end"><span class="level-item tag">22</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/02/"><span class="level-start"><span class="level-item">二月 2018</span></span><span class="level-end"><span class="level-item tag">20</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/01/"><span class="level-start"><span class="level-item">一月 2018</span></span><span class="level-end"><span class="level-item tag">23</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/12/"><span class="level-start"><span class="level-item">十二月 2017</span></span><span class="level-end"><span class="level-item tag">21</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/11/"><span class="level-start"><span class="level-item">十一月 2017</span></span><span class="level-end"><span class="level-item tag">22</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/10/"><span class="level-start"><span class="level-item">十月 2017</span></span><span class="level-end"><span class="level-item tag">22</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/09/"><span class="level-start"><span class="level-item">九月 2017</span></span><span class="level-end"><span class="level-item tag">21</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/08/"><span class="level-start"><span class="level-item">八月 2017</span></span><span class="level-end"><span class="level-item tag">23</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/07/"><span class="level-start"><span class="level-item">七月 2017</span></span><span class="level-end"><span class="level-item tag">21</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/06/"><span class="level-start"><span class="level-item">六月 2017</span></span><span class="level-end"><span class="level-item tag">26</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/05/"><span class="level-start"><span class="level-item">五月 2017</span></span><span class="level-end"><span class="level-item tag">23</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/04/"><span class="level-start"><span class="level-item">四月 2017</span></span><span class="level-end"><span class="level-item tag">20</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/03/"><span class="level-start"><span class="level-item">三月 2017</span></span><span class="level-end"><span class="level-item tag">23</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/02/"><span class="level-start"><span class="level-item">二月 2017</span></span><span class="level-end"><span class="level-item tag">20</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/01/"><span class="level-start"><span class="level-item">一月 2017</span></span><span class="level-end"><span class="level-item tag">22</span></span></a></li><li><a class="level is-mobile" href="/archives/2016/12/"><span class="level-start"><span class="level-item">十二月 2016</span></span><span class="level-end"><span class="level-item tag">24</span></span></a></li><li><a class="level is-mobile" href="/archives/2016/11/"><span class="level-start"><span class="level-item">十一月 2016</span></span><span class="level-end"><span class="level-item tag">22</span></span></a></li><li><a class="level is-mobile" href="/archives/2016/10/"><span class="level-start"><span class="level-item">十月 2016</span></span><span class="level-end"><span class="level-item tag">21</span></span></a></li><li><a class="level is-mobile" href="/archives/2016/09/"><span class="level-start"><span class="level-item">九月 2016</span></span><span class="level-end"><span class="level-item tag">22</span></span></a></li><li><a class="level is-mobile" href="/archives/2016/08/"><span class="level-start"><span class="level-item">八月 2016</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2016/02/"><span class="level-start"><span class="level-item">二月 2016</span></span><span class="level-end"><span class="level-item tag">16</span></span></a></li><li><a class="level is-mobile" href="/archives/2016/01/"><span class="level-start"><span class="level-item">一月 2016</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li><li><a class="level is-mobile" href="/archives/2015/12/"><span class="level-start"><span class="level-item">十二月 2015</span></span><span class="level-end"><span class="level-item tag">8</span></span></a></li><li><a class="level is-mobile" href="/archives/2015/11/"><span class="level-start"><span class="level-item">十一月 2015</span></span><span class="level-end"><span class="level-item tag">15</span></span></a></li><li><a class="level is-mobile" href="/archives/2015/10/"><span class="level-start"><span class="level-item">十月 2015</span></span><span class="level-end"><span class="level-item tag">22</span></span></a></li><li><a class="level is-mobile" href="/archives/2015/09/"><span class="level-start"><span class="level-item">九月 2015</span></span><span class="level-end"><span class="level-item tag">25</span></span></a></li><li><a class="level is-mobile" href="/archives/2015/08/"><span class="level-start"><span class="level-item">八月 2015</span></span><span class="level-end"><span class="level-item tag">22</span></span></a></li><li><a class="level is-mobile" href="/archives/2015/07/"><span class="level-start"><span class="level-item">七月 2015</span></span><span class="level-end"><span class="level-item tag">24</span></span></a></li><li><a class="level is-mobile" href="/archives/2015/06/"><span class="level-start"><span class="level-item">六月 2015</span></span><span class="level-end"><span class="level-item tag">22</span></span></a></li><li><a class="level is-mobile" href="/archives/2015/05/"><span class="level-start"><span class="level-item">五月 2015</span></span><span class="level-end"><span class="level-item tag">21</span></span></a></li><li><a class="level is-mobile" href="/archives/2015/04/"><span class="level-start"><span class="level-item">四月 2015</span></span><span class="level-end"><span class="level-item tag">23</span></span></a></li><li><a class="level is-mobile" href="/archives/2015/03/"><span class="level-start"><span class="level-item">三月 2015</span></span><span class="level-end"><span class="level-item tag">24</span></span></a></li><li><a class="level is-mobile" href="/archives/2015/02/"><span class="level-start"><span class="level-item">二月 2015</span></span><span class="level-end"><span class="level-item tag">23</span></span></a></li><li><a class="level is-mobile" href="/archives/2015/01/"><span class="level-start"><span class="level-item">一月 2015</span></span><span class="level-end"><span class="level-item tag">28</span></span></a></li><li><a class="level is-mobile" href="/archives/2014/12/"><span class="level-start"><span class="level-item">十二月 2014</span></span><span class="level-end"><span class="level-item tag">23</span></span></a></li><li><a class="level is-mobile" href="/archives/2014/11/"><span class="level-start"><span class="level-item">十一月 2014</span></span><span class="level-end"><span class="level-item tag">14</span></span></a></li><li><a class="level is-mobile" href="/archives/2014/10/"><span class="level-start"><span class="level-item">十月 2014</span></span><span class="level-end"><span class="level-item tag">26</span></span></a></li><li><a class="level is-mobile" href="/archives/2014/09/"><span class="level-start"><span class="level-item">九月 2014</span></span><span class="level-end"><span class="level-item tag">26</span></span></a></li><li><a class="level is-mobile" href="/archives/2014/08/"><span class="level-start"><span class="level-item">八月 2014</span></span><span class="level-end"><span class="level-item tag">39</span></span></a></li><li><a class="level is-mobile" href="/archives/2014/07/"><span class="level-start"><span class="level-item">七月 2014</span></span><span class="level-end"><span class="level-item tag">26</span></span></a></li><li><a class="level is-mobile" href="/archives/2014/06/"><span class="level-start"><span class="level-item">六月 2014</span></span><span class="level-end"><span class="level-item tag">23</span></span></a></li><li><a class="level is-mobile" href="/archives/2014/05/"><span class="level-start"><span class="level-item">五月 2014</span></span><span class="level-end"><span class="level-item tag">23</span></span></a></li><li><a class="level is-mobile" href="/archives/2014/04/"><span class="level-start"><span class="level-item">四月 2014</span></span><span class="level-end"><span class="level-item tag">23</span></span></a></li><li><a class="level is-mobile" href="/archives/2014/03/"><span class="level-start"><span class="level-item">三月 2014</span></span><span class="level-end"><span class="level-item tag">22</span></span></a></li><li><a class="level is-mobile" href="/archives/2014/02/"><span class="level-start"><span class="level-item">二月 2014</span></span><span class="level-end"><span class="level-item tag">23</span></span></a></li><li><a class="level is-mobile" href="/archives/2014/01/"><span class="level-start"><span class="level-item">一月 2014</span></span><span class="level-end"><span class="level-item tag">29</span></span></a></li><li><a class="level is-mobile" href="/archives/2013/12/"><span class="level-start"><span class="level-item">十二月 2013</span></span><span class="level-end"><span class="level-item tag">23</span></span></a></li><li><a class="level is-mobile" href="/archives/2013/11/"><span class="level-start"><span class="level-item">十一月 2013</span></span><span class="level-end"><span class="level-item tag">30</span></span></a></li><li><a class="level is-mobile" href="/archives/2013/10/"><span class="level-start"><span class="level-item">十月 2013</span></span><span class="level-end"><span class="level-item tag">29</span></span></a></li><li><a class="level is-mobile" href="/archives/2013/09/"><span class="level-start"><span class="level-item">九月 2013</span></span><span class="level-end"><span class="level-item tag">30</span></span></a></li><li><a class="level is-mobile" href="/archives/2013/08/"><span class="level-start"><span class="level-item">八月 2013</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2013/06/"><span class="level-start"><span class="level-item">六月 2013</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2013/05/"><span class="level-start"><span class="level-item">五月 2013</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2013/03/"><span class="level-start"><span class="level-item">三月 2013</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2012/04/"><span class="level-start"><span class="level-item">四月 2012</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></div></div></div><div class="card widget" data-type="tags"><div class="card-content"><div class="menu"><h3 class="menu-label">标签</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/net/"><span class="tag">.net</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/0day/"><span class="tag">0day</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/C/"><span class="tag">C#</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/QQ/"><span class="tag">QQ</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/acl/"><span class="tag">acl</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ad/"><span class="tag">ad</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ai/"><span class="tag">ai</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ai-optimization/"><span class="tag">ai-optimization</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/angularjs/"><span class="tag">angularjs</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/animation/"><span class="tag">animation</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/apache/"><span class="tag">apache</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/appz/"><span class="tag">appz</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/asciiart/"><span class="tag">asciiart</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/att-ck/"><span class="tag">att&amp;ck</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/automation/"><span class="tag">automation</span><span class="tag">23</span></a></div><div class="control"><a class="tags has-addons" href="/tags/azure/"><span class="tag">azure</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/azure-ad/"><span class="tag">azure-ad</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/azure-functions/"><span class="tag">azure-functions</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/azuread/"><span class="tag">azuread</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/backup/"><span class="tag">backup</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/batch/"><span class="tag">batch</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/bestpractice/"><span class="tag">bestpractice</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/block/"><span class="tag">block</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/blog/"><span class="tag">blog</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/book/"><span class="tag">book</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/breakpoint/"><span class="tag">breakpoint</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/bug/"><span class="tag">bug</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/c/"><span class="tag">c#</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/career/"><span class="tag">career</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/cdn/"><span class="tag">cdn</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/cheatsheet/"><span class="tag">cheatsheet</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/cloud/"><span class="tag">cloud</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/cmd/"><span class="tag">cmd</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/cmdlet/"><span class="tag">cmdlet</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/code-generation/"><span class="tag">code-generation</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/command/"><span class="tag">command</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/community/"><span class="tag">community</span><span class="tag">6</span></a></div><div class="control"><a class="tags has-addons" href="/tags/compliance/"><span class="tag">compliance</span><span class="tag">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/computervision/"><span class="tag">computervision</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/conditional-compilation/"><span class="tag">conditional-compilation</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/container/"><span class="tag">container</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/cost-optimization/"><span class="tag">cost-optimization</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/csharp/"><span class="tag">csharp</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/css/"><span class="tag">css</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/data-structure/"><span class="tag">data-structure</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/data-structures/"><span class="tag">data-structures</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/database/"><span class="tag">database</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/datacenter/"><span class="tag">datacenter</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ddns/"><span class="tag">ddns</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/debugging/"><span class="tag">debugging</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/delicious/"><span class="tag">delicious</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/develop/"><span class="tag">develop</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/device-compliance/"><span class="tag">device-compliance</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/device-health/"><span class="tag">device-health</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/device-management/"><span class="tag">device-management</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/device-monitoring/"><span class="tag">device-monitoring</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/devops/"><span class="tag">devops</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/devsecops/"><span class="tag">devsecops</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/digital-assets/"><span class="tag">digital-assets</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/docker/"><span class="tag">docker</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/dos/"><span class="tag">dos</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/download/"><span class="tag">download</span><span class="tag">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/drone/"><span class="tag">drone</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/dsc/"><span class="tag">dsc</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/dynamic-loading/"><span class="tag">dynamic-loading</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ebook/"><span class="tag">ebook</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ed2k/"><span class="tag">ed2k</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/edge-computing/"><span class="tag">edge-computing</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/embedded/"><span class="tag">embedded</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/encoding/"><span class="tag">encoding</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/energy-optimization/"><span class="tag">energy-optimization</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/error-handling/"><span class="tag">error-handling</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ethereum/"><span class="tag">ethereum</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/excel/"><span class="tag">excel</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/extension/"><span class="tag">extension</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/filesystem-abstraction/"><span class="tag">filesystem-abstraction</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/flow-control/"><span class="tag">flow-control</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/front-end/"><span class="tag">front-end</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/function/"><span class="tag">function</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/functions/"><span class="tag">functions</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/gallery/"><span class="tag">gallery</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/geek/"><span class="tag">geek</span><span class="tag">30</span></a></div><div class="control"><a class="tags has-addons" href="/tags/git/"><span class="tag">git</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/green-computing/"><span class="tag">green-computing</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/gtd/"><span class="tag">gtd</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/guide/"><span class="tag">guide</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/guideline/"><span class="tag">guideline</span><span class="tag">11</span></a></div><div class="control"><a class="tags has-addons" href="/tags/gvim/"><span class="tag">gvim</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/hashtable/"><span class="tag">hashtable</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/healthcheck/"><span class="tag">healthcheck</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/hexo/"><span class="tag">hexo</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/html/"><span class="tag">html</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/hybrid-cloud/"><span class="tag">hybrid-cloud</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/iac/"><span class="tag">iac</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/icon/"><span class="tag">icon</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ics/"><span class="tag">ics</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ide/"><span class="tag">ide</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/industrial-iot/"><span class="tag">industrial-iot</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ionic/"><span class="tag">ionic</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ip/"><span class="tag">ip</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/iso/"><span class="tag">iso</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/javascript/"><span class="tag">javascript</span><span class="tag">7</span></a></div><div class="control"><a class="tags has-addons" href="/tags/jea/"><span class="tag">jea</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/kubernetes/"><span class="tag">kubernetes</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/language/"><span class="tag">language</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/lateral-movement/"><span class="tag">lateral-movement</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/learning/"><span class="tag">learning</span><span class="tag">6</span></a></div><div class="control"><a class="tags has-addons" href="/tags/lesson/"><span class="tag">lesson</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/link/"><span class="tag">link</span><span class="tag">6</span></a></div><div class="control"><a class="tags has-addons" href="/tags/linux/"><span class="tag">linux</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/log-analysis/"><span class="tag">log-analysis</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/loganalysis/"><span class="tag">loganalysis</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/machine-learning/"><span class="tag">machine-learning</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/markdown/"><span class="tag">markdown</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/metaprogramming/"><span class="tag">metaprogramming</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/metaverse/"><span class="tag">metaverse</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/microsoft/"><span class="tag">microsoft</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/microsoft-graph/"><span class="tag">microsoft-graph</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/module/"><span class="tag">module</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/mongodb/"><span class="tag">mongodb</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/mongoose/"><span class="tag">mongoose</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/monthly/"><span class="tag">monthly</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/mqtt/"><span class="tag">mqtt</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/multi-cloud/"><span class="tag">multi-cloud</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/multicloud/"><span class="tag">multicloud</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/multithreading/"><span class="tag">multithreading</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/mvp/"><span class="tag">mvp</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/natural-language-processing/"><span class="tag">natural-language-processing</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/nlp/"><span class="tag">nlp</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/node-js/"><span class="tag">node.js</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/nodejs/"><span class="tag">nodejs</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/nosql/"><span class="tag">nosql</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/oauth2/"><span class="tag">oauth2</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/openai/"><span class="tag">openai</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/optimization/"><span class="tag">optimization</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/oray/"><span class="tag">oray</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/packaging/"><span class="tag">packaging</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/parameters/"><span class="tag">parameters</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/path-handling/"><span class="tag">path-handling</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/picture/"><span class="tag">picture</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/policies/"><span class="tag">policies</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/powershell/"><span class="tag">powershell</span><span class="tag">2080</span></a></div><div class="control"><a class="tags has-addons" href="/tags/powertip/"><span class="tag">powertip</span><span class="tag">1985</span></a></div><div class="control"><a class="tags has-addons" href="/tags/predictive-maintenance/"><span class="tag">predictive-maintenance</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/preface/"><span class="tag">preface</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/privilege-escalation/"><span class="tag">privilege-escalation</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/process-analysis/"><span class="tag">process-analysis</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/productivity/"><span class="tag">productivity</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/proxy/"><span class="tag">proxy</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/psprovider/"><span class="tag">psprovider</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/qq/"><span class="tag">qq</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/red-team/"><span class="tag">red-team</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/reflection/"><span class="tag">reflection</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/regex/"><span class="tag">regex</span><span class="tag">6</span></a></div><div class="control"><a class="tags has-addons" href="/tags/registry/"><span class="tag">registry</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/release/"><span class="tag">release</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/remoting/"><span class="tag">remoting</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/repack/"><span class="tag">repack</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/resource/"><span class="tag">resource</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/resource-orchestration/"><span class="tag">resource-orchestration</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/rest-api/"><span class="tag">rest-api</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/role-capability/"><span class="tag">role-capability</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/runspacepool/"><span class="tag">runspacepool</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/scm/"><span class="tag">scm</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/scope/"><span class="tag">scope</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/script/"><span class="tag">script</span><span class="tag">25</span></a></div><div class="control"><a class="tags has-addons" href="/tags/security/"><span class="tag">security</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/security-monitoring/"><span class="tag">security-monitoring</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/series/"><span class="tag">series</span><span class="tag">1985</span></a></div><div class="control"><a class="tags has-addons" href="/tags/server/"><span class="tag">server</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/serverless/"><span class="tag">serverless</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/skill/"><span class="tag">skill</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/smart-contract/"><span class="tag">smart-contract</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/software/"><span class="tag">software</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/sp1/"><span class="tag">sp1</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/stacktrace/"><span class="tag">stacktrace</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/study/"><span class="tag">study</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/style/"><span class="tag">style</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/supply-chain/"><span class="tag">supply-chain</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/supplychain/"><span class="tag">supplychain</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/switch/"><span class="tag">switch</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/terraform/"><span class="tag">terraform</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/text/"><span class="tag">text</span><span class="tag">9</span></a></div><div class="control"><a class="tags has-addons" href="/tags/text-processing/"><span class="tag">text-processing</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/threat-hunting/"><span class="tag">threat-hunting</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/tip/"><span class="tag">tip</span><span class="tag">1984</span></a></div><div class="control"><a class="tags has-addons" href="/tags/tip%E4%B8%AA/"><span class="tag">tip个</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/tool/"><span class="tag">tool</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/uac/"><span class="tag">uac</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/unmanaged-code/"><span class="tag">unmanaged-code</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/update/"><span class="tag">update</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/variable/"><span class="tag">variable</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/variables/"><span class="tag">variables</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/video/"><span class="tag">video</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/vim/"><span class="tag">vim</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/virtual-environment/"><span class="tag">virtual-environment</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/visualstudio/"><span class="tag">visualstudio</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/vmware/"><span class="tag">vmware</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/vulnerability/"><span class="tag">vulnerability</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/web/"><span class="tag">web</span><span class="tag">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/web3/"><span class="tag">web3</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/window/"><span class="tag">window</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/windows/"><span class="tag">windows</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/xampp/"><span class="tag">xampp</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/xml/"><span class="tag">xml</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/zero-trust/"><span class="tag">zero-trust</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/zerotrust/"><span class="tag">zerotrust</span><span class="tag">2</span></a></div></div></div></div></div><div class="card widget" data-type="subscribe-email"><div class="card-content"><div class="menu"><h3 class="menu-label">订阅更新</h3><form action="https://feedburner.google.com/fb/a/mailverify" method="post" target="popupwindow" onsubmit="window.open(&#039;https://feedburner.google.com/fb/a/mailverify?uri=&#039;,&#039;popupwindow&#039;,&#039;scrollbars=yes,width=550,height=520&#039;);return true"><input type="hidden" value="" name="uri"><input type="hidden" name="loc" value="en_US"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button" type="submit" value="订阅"></div></div></form></div></div></div></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/logo.svg" alt="叹为观止" height="28"></a><p class="is-size-7"><span>&copy; 2025 吴波</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("zh-CN");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "此网站使用Cookie来改善您的体验。",
          dismiss: "知道了！",
          allow: "允许使用Cookie",
          deny: "拒绝",
          link: "了解更多",
          policy: "Cookie政策",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="想要查找什么..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"想要查找什么...","untitled":"(无标题)","posts":"文章","pages":"页面","categories":"分类","tags":"标签"});
        });</script></body></html>